<!DOCTYPE html>
<html lang="ko" style="background:#f5e6d3">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>라디오 엽서 | 클라라 라디오카페</title>
  <meta property="og:type" content="website" />
  <meta property="og:title" content="라디오 엽서 | 클라라 라디오카페" />
  <meta property="og:description" content="라디오와 함께 감성 엽서를 보내세요!" />
  <meta property="og:image" content="https://jaiwshim-project.github.io/37-RadioCafe/digital-screen.jpg" />
  <meta property="og:url" content="https://jaiwshim-project.github.io/37-RadioCafe/radio-postcard.html" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Inter:wght@400;500;600;700&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #f5e6d3;
      --body-out1: #e8d5b0; --body-out2: #d4c09a;
      --body-in1: #FFF8E7; --body-in2: #F5ECD8;
      --accent: #C8A96E;
      --accent-glow: rgba(200,169,110,0.5);
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f5e6d3 0%, #e8d5b7 50%, #f0dcc4 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    body::before {
      content: '';
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(circle at 20% 80%, rgba(200,169,110,0.06) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(200,169,110,0.04) 0%, transparent 50%);
      pointer-events: none; z-index: 0;
    }
    .hidden { display: none !important; }

    /* ── Gift Card Container ── */
    .gift-card {
      background: linear-gradient(145deg, #e8d5b0, #d4c09a);
      border: 1px solid rgba(139,105,20,0.15);
      border-radius: 20px; padding: 24px;
      width: 100%; max-width: 380px;
      text-align: center;
      box-shadow: 0 40px 80px rgba(100,70,30,0.15), 0 0 40px rgba(200,169,110,0.15), inset 0 1px 0 rgba(255,255,255,0.3);
      position: relative; z-index: 1;
    }
    .gift-title {
      font-family: 'Orbitron', monospace; font-size: 13px; font-weight: 700;
      color: #8B6914; letter-spacing: 3px; margin-bottom: 16px;
    }

    /* ── Step Guide ── */
    .gift-guide {
      text-align: left; margin-top: 14px; padding: 12px 14px;
      background: rgba(139,105,20,0.06); border-radius: 10px;
      border-left: 3px solid #C8A96E;
    }
    .gift-guide p {
      font-family: 'Inter', sans-serif; font-size: 13px;
      color: #6a5530; line-height: 1.6;
      margin: 0 0 8px 0;
    }
    .gift-guide p:last-child { margin-bottom: 0; }

    /* ── Buttons ── */
    .gift-btn-row {
      display: flex; gap: 8px; margin-top: 10px;
    }
    .gift-btn-next {
      flex: 1; padding: 12px; border-radius: 12px;
      background: linear-gradient(135deg, #C8A96E, #b89858); border: none;
      color: #fff; font-family: 'Outfit', sans-serif;
      font-size: 14px; font-weight: 700; cursor: pointer;
      transition: all 0.2s;
    }
    .gift-btn-next:disabled { opacity: 0.3; cursor: default; }
    .gift-btn-next:not(:disabled):hover { box-shadow: 0 8px 24px rgba(200,169,110,0.4); }
    .gift-btn-back {
      padding: 12px 16px; border-radius: 12px;
      background: transparent; border: 1px solid rgba(139,105,20,0.2);
      color: #6a5530; font-family: 'Outfit', sans-serif;
      font-size: 14px; font-weight: 600; cursor: pointer;
      transition: all 0.2s;
    }
    .gift-btn-back:hover { border-color: rgba(139,105,20,0.4); color: #8B6914; }

    /* ── Postcard Design Selector ── */
    .postcard-designs {
      display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
      margin-bottom: 14px;
    }
    .design-option {
      position: relative; cursor: pointer;
      border: 2px solid rgba(139,105,20,0.15);
      border-radius: 12px; padding: 10px;
      background: rgba(255,255,255,0.4);
      transition: all 0.3s;
      display: flex; flex-direction: column; align-items: center;
    }
    .design-option:hover { border-color: rgba(200,169,110,0.5); }
    .design-option.selected {
      border-color: #C8A96E;
      background: rgba(200,169,110,0.12);
      box-shadow: 0 0 12px rgba(200,169,110,0.3);
    }
    .design-option .design-label {
      font-family: 'Inter', sans-serif; font-size: 11px;
      color: #6a5530; margin-top: 8px;
    }
    .design-option.selected .design-label { color: #8B6914; font-weight: 600; }

    /* ── Design 1: Vintage Microphone ── */
    .design-vintage1 {
      width: 120px; height: 80px; position: relative;
      background: linear-gradient(135deg, #f5e6d3, #e8d5b7);
      border-radius: 6px; overflow: hidden;
      box-shadow: inset 0 0 20px rgba(139,90,43,0.15);
    }
    .design-vintage1::before {
      content: '';
      position: absolute; top: 12px; left: 50%; transform: translateX(-50%);
      width: 28px; height: 30px;
      background: linear-gradient(180deg, #8B6914, #a07828);
      border-radius: 50% 50% 8px 8px;
      box-shadow: inset 0 -4px 8px rgba(0,0,0,0.2), 0 1px 3px rgba(0,0,0,0.3);
    }
    .design-vintage1::after {
      content: '';
      position: absolute; top: 42px; left: 50%; transform: translateX(-50%);
      width: 6px; height: 22px;
      background: linear-gradient(180deg, #6b5010, #8B6914);
      border-radius: 2px;
      box-shadow: -10px -6px 0 2px rgba(139,105,20,0.15), 10px -6px 0 2px rgba(139,105,20,0.15);
    }
    .dv1-grid {
      position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
      width: 20px; height: 20px;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.2) 2px, rgba(0,0,0,0.2) 3px),
                  repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.2) 2px, rgba(0,0,0,0.2) 3px);
      border-radius: 50%;
      z-index: 1;
    }
    .dv1-base {
      position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%);
      width: 36px; height: 6px;
      background: linear-gradient(180deg, #6b5010, #4a3808);
      border-radius: 3px;
    }
    .dv1-stamp {
      position: absolute; top: 6px; right: 6px;
      width: 18px; height: 22px;
      border: 1.5px dashed rgba(139,105,20,0.4);
      border-radius: 2px;
      background: rgba(232,168,124,0.15);
    }

    /* ── Design 2: Vinyl Record ── */
    .design-vintage2 {
      width: 120px; height: 80px; position: relative;
      background: linear-gradient(135deg, #f0dcc4, #e2c9a5);
      border-radius: 6px; overflow: hidden;
      box-shadow: inset 0 0 20px rgba(139,90,43,0.15);
    }
    .dv2-record {
      position: absolute; top: 50%; left: 38px; transform: translateY(-50%);
      width: 54px; height: 54px; border-radius: 50%;
      background: radial-gradient(circle,
        #e8a87c 6px,
        #2a1c0e 7px, #2a1c0e 10px,
        #1a1209 10.5px, #2a1c0e 12px,
        #1a1209 14px, #2a1c0e 15px,
        #1a1209 17px, #2a1c0e 18px,
        #1a1209 20px, #2a1c0e 21px,
        #1a1209 23px, #2a1c0e 24px,
        #1e140a 25px
      );
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }
    .dv2-record::before {
      content: '';
      position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
      width: 4px; height: 4px; border-radius: 50%;
      background: #fff;
    }
    .dv2-record::after {
      content: '';
      position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
      width: 16px; height: 16px; border-radius: 50%;
      border: 1px solid rgba(232,168,124,0.3);
      background: transparent;
    }
    .dv2-lines {
      position: absolute; top: 10px; right: 8px;
      width: 32px; display: flex; flex-direction: column; gap: 5px;
    }
    .dv2-lines span {
      display: block; height: 2px; border-radius: 1px;
      background: rgba(139,105,20,0.25);
    }
    .dv2-lines span:nth-child(1) { width: 100%; }
    .dv2-lines span:nth-child(2) { width: 80%; }
    .dv2-lines span:nth-child(3) { width: 60%; }
    .dv2-note {
      position: absolute; bottom: 8px; right: 10px;
      font-size: 16px; color: rgba(139,105,20,0.35);
      font-family: serif;
    }

    /* ── Design 3: Retro Radio ── */
    .design-vintage3 {
      width: 120px; height: 80px; position: relative;
      background: linear-gradient(135deg, #eedcc6, #dfc9a8);
      border-radius: 6px; overflow: hidden;
      box-shadow: inset 0 0 20px rgba(139,90,43,0.15);
    }
    .dv3-radio {
      position: absolute; top: 14px; left: 50%; transform: translateX(-50%);
      width: 64px; height: 44px;
      background: linear-gradient(180deg, #8b6914, #6b5010);
      border-radius: 8px 8px 4px 4px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
    }
    .dv3-radio::before {
      content: '';
      position: absolute; top: 5px; left: 6px;
      width: 24px; height: 24px; border-radius: 50%;
      background: radial-gradient(circle, #3a2a1a 40%, #2a1c0e 42%, #3a2a1a 44%, #2a1c0e 60%, #4a3818 100%);
      border: 1.5px solid rgba(232,168,124,0.3);
    }
    .dv3-radio::after {
      content: '';
      position: absolute; top: 6px; right: 6px;
      width: 22px; height: 10px;
      background: rgba(232,168,124,0.2);
      border: 1px solid rgba(232,168,124,0.3);
      border-radius: 3px;
    }
    .dv3-dial1 {
      position: absolute; bottom: 6px; left: 16px;
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle, #e8a87c, #c8884c);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .dv3-dial2 {
      position: absolute; bottom: 6px; right: 16px;
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle, #e8a87c, #c8884c);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .dv3-antenna {
      position: absolute; top: 4px; left: 50%; transform: translateX(-50%);
      width: 2px; height: 14px;
      background: linear-gradient(180deg, rgba(139,105,20,0.3), #8b6914);
      border-radius: 1px;
    }
    .dv3-antenna::after {
      content: '';
      position: absolute; top: -2px; left: -1.5px;
      width: 5px; height: 5px; border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 4px var(--accent-glow);
    }
    .dv3-stamp {
      position: absolute; top: 6px; right: 6px;
      width: 18px; height: 22px;
      border: 1.5px dashed rgba(139,105,20,0.4);
      border-radius: 2px;
      background: rgba(232,168,124,0.15);
    }

    /* ── Design 4: Coffee Cup ── */
    .design-vintage4 {
      width: 120px; height: 80px; position: relative;
      background: linear-gradient(135deg, #f2e0ca, #e5cfb0);
      border-radius: 6px; overflow: hidden;
      box-shadow: inset 0 0 20px rgba(139,90,43,0.15);
    }
    .dv4-saucer {
      position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
      width: 52px; height: 10px;
      background: linear-gradient(180deg, #c8a06e, #a8864e);
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .dv4-cup {
      position: absolute; bottom: 14px; left: 50%; transform: translateX(-50%);
      width: 34px; height: 26px;
      background: linear-gradient(180deg, #f5f0e8, #e8ddd0);
      border-radius: 0 0 10px 10px;
      border: 2px solid #c8a06e;
      border-top: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .dv4-cup::before {
      content: '';
      position: absolute; top: 2px; right: -12px;
      width: 10px; height: 14px;
      border: 2px solid #c8a06e;
      border-left: none;
      border-radius: 0 8px 8px 0;
    }
    .dv4-cup::after {
      content: '';
      position: absolute; top: -2px; left: -2px; right: -2px;
      height: 4px;
      background: linear-gradient(180deg, #c8a06e, #b89050);
      border-radius: 2px 2px 0 0;
    }
    .dv4-coffee {
      position: absolute; bottom: 18px; left: 50%; transform: translateX(-50%);
      width: 26px; height: 14px;
      background: radial-gradient(ellipse, #6b3a10, #4a2808);
      border-radius: 0 0 6px 6px;
    }
    .dv4-steam {
      position: absolute; bottom: 42px; left: 50%; transform: translateX(-50%);
      width: 30px; height: 20px;
      display: flex; justify-content: center; gap: 5px;
    }
    .dv4-steam span {
      display: block; width: 3px; height: 16px;
      background: linear-gradient(180deg, transparent, rgba(139,105,20,0.15), transparent);
      border-radius: 50%;
      animation: steam 2s ease-in-out infinite;
    }
    .dv4-steam span:nth-child(1) { animation-delay: 0s; height: 12px; }
    .dv4-steam span:nth-child(2) { animation-delay: 0.4s; height: 16px; }
    .dv4-steam span:nth-child(3) { animation-delay: 0.8s; height: 12px; }
    @keyframes steam {
      0%, 100% { opacity: 0.3; transform: translateY(0) scaleX(1); }
      50% { opacity: 0.7; transform: translateY(-4px) scaleX(1.5); }
    }
    .dv4-heart {
      position: absolute; top: 8px; right: 10px;
      font-size: 12px; color: rgba(232,168,124,0.5);
    }

    /* ── Step 2: Message Input ── */
    .gift-msg-input {
      width: 100%; padding: 12px; border-radius: 12px;
      border: 2px solid rgba(139,105,20,0.2);
      background: rgba(255,255,255,0.7); color: #3a2a10;
      font-family: 'Inter', sans-serif; font-size: 14px;
      outline: none; resize: none; min-height: 70px;
      margin-bottom: 4px;
    }
    .gift-msg-input:focus { border-color: #C8A96E; }
    .gift-msg-input::placeholder { color: rgba(100,70,30,0.4); }
    .msg-counter {
      text-align: right; font-size: 11px; color: rgba(139,105,20,0.4);
      margin-bottom: 12px; font-family: 'Inter', sans-serif;
    }

    /* ── Link Box ── */
    .gift-link-box {
      display: flex; gap: 8px; margin-bottom: 8px;
    }
    .gift-link-box input {
      flex: 1; padding: 10px 12px; border-radius: 10px;
      border: 2px solid rgba(139,105,20,0.2);
      background: rgba(255,255,255,0.7); color: #3a2a10;
      font-family: 'Inter', sans-serif; font-size: 11px; outline: none;
    }
    .gift-link-box button {
      padding: 10px 16px; border-radius: 10px;
      background: linear-gradient(135deg, #C8A96E, #b89858); border: none;
      color: #fff; font-family: 'Outfit', sans-serif;
      font-size: 13px; font-weight: 700; cursor: pointer;
      transition: all 0.2s; white-space: nowrap;
    }
    .gift-link-box button:hover { box-shadow: 0 8px 24px rgba(200,169,110,0.4); }
    .gift-copied {
      font-family: 'Inter', sans-serif; font-size: 12px;
      color: #8B6914; margin-bottom: 12px;
    }
    .gift-copied.hidden { display: none; }

    /* ── Receiver Mode ── */
    .receiver-card {
      background: linear-gradient(145deg, #e8d5b0, #d4c09a);
      border: 1px solid rgba(139,105,20,0.15);
      border-radius: 20px; padding: 24px;
      width: 100%; max-width: 380px;
      text-align: center;
      box-shadow: 0 40px 80px rgba(100,70,30,0.15), 0 0 40px rgba(200,169,110,0.15), inset 0 1px 0 rgba(255,255,255,0.3);
      perspective: 800px;
      position: relative; z-index: 1;
    }
    .receiver-title {
      font-family: 'Orbitron', monospace; font-size: 13px; font-weight: 700;
      color: #8B6914; letter-spacing: 3px; margin-bottom: 20px;
    }

    /* ── Envelope Animation ── */
    .envelope-wrapper {
      position: relative; width: 220px; height: 160px;
      margin: 0 auto 20px;
    }
    .envelope {
      position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
      width: 200px; height: 130px;
      animation: envelopeSlideUp 0.8s ease-out forwards;
      opacity: 0;
    }
    @keyframes envelopeSlideUp {
      0% { opacity: 0; transform: translateX(-50%) translateY(60px); }
      100% { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    .envelope-body {
      position: absolute; bottom: 0; left: 0; right: 0;
      height: 100px;
      background: linear-gradient(145deg, #c8a06e, #a88040);
      border-radius: 0 0 8px 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 2;
    }
    .envelope-body::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0;
      height: 50px;
      background: linear-gradient(145deg, rgba(0,0,0,0.08), transparent);
    }
    .envelope-flap {
      position: absolute; top: 0; left: 0; right: 0;
      height: 70px;
      background: linear-gradient(180deg, #d4aa6e, #c8a06e);
      clip-path: polygon(0 0, 50% 100%, 100% 0);
      transform-origin: top center;
      z-index: 3;
      animation: flapOpen 0.6s ease-in-out 1s forwards;
    }
    @keyframes flapOpen {
      0% { transform: rotateX(0deg); }
      100% { transform: rotateX(180deg); }
    }
    .envelope-back-flap {
      position: absolute; top: 0; left: 0; right: 0;
      height: 70px;
      background: linear-gradient(180deg, #b8904e, #a88040);
      clip-path: polygon(0 0, 50% 100%, 100% 0);
      z-index: 1;
    }

    /* ── Postcard Slide Out ── */
    .postcard-reveal {
      position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
      width: 180px; height: 110px;
      z-index: 4;
      opacity: 0;
      animation: postcardRise 0.8s ease-out 1.8s forwards;
    }
    @keyframes postcardRise {
      0% { opacity: 0; transform: translateX(-50%) translateY(0); }
      100% { opacity: 1; transform: translateX(-50%) translateY(-90px); }
    }

    /* ── Full-size Postcard (Receiver) ── */
    .postcard-full {
      width: 100%; max-width: 320px;
      margin: 0 auto 16px;
      border-radius: 10px; overflow: hidden;
      opacity: 0;
      animation: postcardFadeIn 0.5s ease-out 2.8s forwards;
    }
    @keyframes postcardFadeIn {
      0% { opacity: 0; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }
    .postcard-full .postcard-art {
      width: 100%; height: 160px; position: relative;
    }
    .postcard-full .postcard-message-area {
      background: linear-gradient(180deg, #f5e6d3, #eedcc6);
      padding: 20px; min-height: 80px;
      border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;
      border: 1px solid rgba(139,105,20,0.2);
      border-top: 2px dashed rgba(139,105,20,0.3);
    }
    .postcard-message-text {
      font-family: 'Inter', sans-serif; font-size: 15px;
      color: #3a2a10; line-height: 1.7;
      min-height: 24px;
    }
    .typewriter-cursor {
      display: inline-block; width: 2px; height: 16px;
      background: #8b6914; margin-left: 2px;
      vertical-align: text-bottom;
      animation: blink 0.6s step-end infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    /* ── Scaled-up postcard art variants ── */
    .postcard-art.art-vintage1 {
      background: linear-gradient(135deg, #f5e6d3, #e8d5b7);
    }
    .postcard-art.art-vintage2 {
      background: linear-gradient(135deg, #f0dcc4, #e2c9a5);
    }
    .postcard-art.art-vintage3 {
      background: linear-gradient(135deg, #eedcc6, #dfc9a8);
    }
    .postcard-art.art-vintage4 {
      background: linear-gradient(135deg, #f2e0ca, #e5cfb0);
    }

    /* Large mic for postcard art */
    .art-mic-body {
      position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
      width: 56px; height: 60px;
      background: linear-gradient(180deg, #8B6914, #a07828);
      border-radius: 50% 50% 16px 16px;
      box-shadow: inset 0 -8px 16px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.3);
    }
    .art-mic-grid {
      position: absolute; top: 26px; left: 50%; transform: translateX(-50%);
      width: 40px; height: 40px;
      background: repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 5px),
                  repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 5px);
      border-radius: 50%;
      z-index: 1;
    }
    .art-mic-stand {
      position: absolute; top: 78px; left: 50%; transform: translateX(-50%);
      width: 10px; height: 44px;
      background: linear-gradient(180deg, #6b5010, #8B6914);
      border-radius: 4px;
    }
    .art-mic-base {
      position: absolute; bottom: 14px; left: 50%; transform: translateX(-50%);
      width: 72px; height: 12px;
      background: linear-gradient(180deg, #6b5010, #4a3808);
      border-radius: 6px;
    }
    .art-stamp {
      position: absolute; top: 12px; right: 12px;
      width: 36px; height: 44px;
      border: 2px dashed rgba(139,105,20,0.4);
      border-radius: 3px;
      background: rgba(232,168,124,0.15);
    }
    .art-postmark {
      position: absolute; top: 18px; left: 14px;
      width: 40px; height: 40px; border-radius: 50%;
      border: 1.5px solid rgba(139,105,20,0.2);
      display: flex; align-items: center; justify-content: center;
    }
    .art-postmark::after {
      content: 'RADIO';
      font-family: 'Orbitron', monospace; font-size: 7px;
      color: rgba(139,105,20,0.3); letter-spacing: 1px;
    }

    /* Large record for postcard art */
    .art-record {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 120px; height: 120px; border-radius: 50%;
      background: radial-gradient(circle,
        #e8a87c 12px,
        #2a1c0e 14px, #2a1c0e 20px,
        #1a1209 21px, #2a1c0e 24px,
        #1a1209 28px, #2a1c0e 30px,
        #1a1209 34px, #2a1c0e 36px,
        #1a1209 40px, #2a1c0e 42px,
        #1a1209 46px, #2a1c0e 48px,
        #1a1209 52px, #2a1c0e 54px,
        #1e140a 56px
      );
      box-shadow: 0 4px 16px rgba(0,0,0,0.4);
      animation: recordSpin 8s linear infinite;
    }
    @keyframes recordSpin {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    .art-record::before {
      content: '';
      position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
      width: 8px; height: 8px; border-radius: 50%;
      background: #fff; z-index: 1;
    }
    .art-record-label {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
      width: 32px; height: 32px; border-radius: 50%;
      border: 1px solid rgba(232,168,124,0.4);
      z-index: 1;
    }

    /* Large radio for postcard art */
    .art-radio-box {
      position: absolute; top: 24px; left: 50%; transform: translateX(-50%);
      width: 130px; height: 90px;
      background: linear-gradient(180deg, #8b6914, #6b5010);
      border-radius: 14px 14px 6px 6px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }
    .art-radio-speaker {
      position: absolute; top: 10px; left: 12px;
      width: 48px; height: 48px; border-radius: 50%;
      background: radial-gradient(circle, #3a2a1a 40%, #2a1c0e 42%, #3a2a1a 44%, #2a1c0e 60%, #4a3818 100%);
      border: 2px solid rgba(232,168,124,0.3);
    }
    .art-radio-display {
      position: absolute; top: 12px; right: 10px;
      width: 50px; height: 22px;
      background: rgba(232,168,124,0.15);
      border: 1.5px solid rgba(232,168,124,0.3);
      border-radius: 4px;
    }
    .art-radio-display::after {
      content: 'FM';
      font-family: 'Orbitron', monospace; font-size: 8px;
      color: rgba(232,168,124,0.5); letter-spacing: 2px;
      display: flex; align-items: center; justify-content: center;
      height: 100%;
    }
    .art-radio-knob1 {
      position: absolute; bottom: 10px; left: 30px;
      width: 20px; height: 20px; border-radius: 50%;
      background: radial-gradient(circle, #e8a87c, #c8884c);
      border: 1.5px solid rgba(255,255,255,0.2);
    }
    .art-radio-knob2 {
      position: absolute; bottom: 10px; right: 30px;
      width: 20px; height: 20px; border-radius: 50%;
      background: radial-gradient(circle, #e8a87c, #c8884c);
      border: 1.5px solid rgba(255,255,255,0.2);
    }
    .art-radio-antenna {
      position: absolute; top: 6px; left: 50%; transform: translateX(-50%);
      width: 3px; height: 24px;
      background: linear-gradient(180deg, rgba(139,105,20,0.3), #8b6914);
      border-radius: 1px;
    }
    .art-radio-antenna::after {
      content: '';
      position: absolute; top: -4px; left: -3px;
      width: 9px; height: 9px; border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 8px var(--accent-glow);
    }

    /* Large coffee for postcard art */
    .art-coffee-saucer {
      position: absolute; bottom: 18px; left: 50%; transform: translateX(-50%);
      width: 100px; height: 18px;
      background: linear-gradient(180deg, #c8a06e, #a8864e);
      border-radius: 50%;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }
    .art-coffee-cup {
      position: absolute; bottom: 26px; left: 50%; transform: translateX(-50%);
      width: 66px; height: 52px;
      background: linear-gradient(180deg, #f5f0e8, #e8ddd0);
      border-radius: 0 0 20px 20px;
      border: 3px solid #c8a06e;
      border-top: none;
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }
    .art-coffee-cup::before {
      content: '';
      position: absolute; top: 6px; right: -22px;
      width: 18px; height: 26px;
      border: 3px solid #c8a06e;
      border-left: none;
      border-radius: 0 14px 14px 0;
    }
    .art-coffee-cup::after {
      content: '';
      position: absolute; top: -4px; left: -3px; right: -3px;
      height: 7px;
      background: linear-gradient(180deg, #c8a06e, #b89050);
      border-radius: 3px 3px 0 0;
    }
    .art-coffee-liquid {
      position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
      width: 52px; height: 28px;
      background: radial-gradient(ellipse, #6b3a10, #4a2808);
      border-radius: 0 0 14px 14px;
    }
    .art-coffee-steam {
      position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 10px;
    }
    .art-coffee-steam span {
      display: block; width: 5px; height: 28px;
      background: linear-gradient(180deg, transparent, rgba(139,105,20,0.12), transparent);
      border-radius: 50%;
      animation: steamLg 2.5s ease-in-out infinite;
    }
    .art-coffee-steam span:nth-child(1) { animation-delay: 0s; height: 22px; }
    .art-coffee-steam span:nth-child(2) { animation-delay: 0.5s; height: 28px; }
    .art-coffee-steam span:nth-child(3) { animation-delay: 1s; height: 22px; }
    @keyframes steamLg {
      0%, 100% { opacity: 0.3; transform: translateY(0) scaleX(1); }
      50% { opacity: 0.8; transform: translateY(-8px) scaleX(1.8); }
    }

    /* ── Receiver Buttons ── */
    .receiver-actions {
      display: flex; flex-direction: column; gap: 8px;
      margin-top: 12px;
      opacity: 0;
      animation: fadeInActions 0.5s ease-out 3.5s forwards;
    }
    @keyframes fadeInActions {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .receiver-chat-btn {
      width: 100%; padding: 12px;
      background: linear-gradient(135deg, #C8A96E, #b89858); border: none;
      border-radius: 12px; color: #fff;
      font-family: 'Outfit', sans-serif; font-size: 14px;
      font-weight: 700; cursor: pointer;
      transition: all 0.2s;
    }
    .receiver-chat-btn:hover { box-shadow: 0 8px 24px rgba(200,169,110,0.4); }

    /* ── Chat Panel (cream/gold theme) ── */
    .chat-panel {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(145deg, #FFF8E7, #F2E8D0);
      border: none; z-index: 100; display: flex; flex-direction: column; overflow: hidden;
    }
    .chat-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; background: rgba(200,169,110,0.12);
      border-bottom: 1px solid rgba(200,169,110,0.25); flex-shrink: 0;
    }
    .chat-header-title { font-family: 'Orbitron', monospace; font-size: 11px; font-weight: 700; color: #8B6914; letter-spacing: 2px; }
    .chat-header-info { font-family: 'Inter', sans-serif; font-size: 11px; color: #6a5530; }
    .chat-back-btn {
      background: none; border: 1px solid rgba(139,105,20,0.4);
      color: #8B6914; font-size: 12px; padding: 4px 10px;
      border-radius: 8px; cursor: pointer; font-family: 'Inter', sans-serif; white-space: nowrap;
    }
    #chatBody { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .chat-nickname-box { padding: 24px 16px; text-align: center; }
    .chat-nickname-box input {
      padding: 12px 16px; border-radius: 10px; border: 1px solid rgba(139,105,20,0.3);
      background: rgba(255,255,255,0.7); color: #3a2a10;
      font-family: 'Inter', sans-serif; font-size: 14px; text-align: center; outline: none; width: 65%;
    }
    .chat-nickname-box input:focus { border-color: #C8A96E; }
    .chat-nickname-box button {
      margin-left: 8px; padding: 12px 20px; border-radius: 10px;
      background: #C8A96E; border: none; color: #fff;
      font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer;
    }
    .chat-messages { flex: 1; overflow-y: auto; padding: 12px 16px; display: flex; flex-direction: column; }
    .chat-messages::-webkit-scrollbar { width: 4px; }
    .chat-messages::-webkit-scrollbar-thumb { background: rgba(200,169,110,0.4); border-radius: 2px; }
    .chat-msg { margin-bottom: 10px; font-family: 'Inter', sans-serif; font-size: 15px; line-height: 1.5; word-break: break-word; display: flex; flex-direction: column; max-width: 78%; }
    .chat-msg.me { align-self: flex-end; align-items: flex-end; }
    .chat-msg.other { align-self: flex-start; align-items: flex-start; }
    .chat-msg-name { font-weight: 700; color: #8B6914; font-size: 13px; margin-bottom: 3px; }
    .chat-msg.me .chat-msg-name { color: #6a5530; }
    .chat-msg-bubble { padding: 8px 14px; border-radius: 14px; line-height: 1.5; color: #3a2a10; }
    .chat-msg.other .chat-msg-bubble { background: rgba(200,169,110,0.15); border: 1px solid rgba(200,169,110,0.2); border-top-left-radius: 4px; }
    .chat-msg.me .chat-msg-bubble { background: #C8A96E; color: #fff; border-top-right-radius: 4px; }
    .chat-msg-system { text-align: center; color: #6a5530; font-size: 13px; font-style: italic; margin: 6px 0; align-self: center; }
    .chat-input-box { display: flex; gap: 8px; padding: 10px 16px; border-top: 1px solid rgba(200,169,110,0.25); }
    .chat-input-box input { flex: 1; padding: 10px 14px; border-radius: 10px; border: 1px solid rgba(139,105,20,0.25); background: rgba(255,255,255,0.7); color: #3a2a10; font-family: 'Inter', sans-serif; font-size: 13px; outline: none; }
    .chat-input-box input:focus { border-color: #C8A96E; }
    .chat-input-box button { padding: 10px 16px; border-radius: 10px; background: #C8A96E; border: none; color: #fff; font-family: 'Outfit', sans-serif; font-size: 13px; font-weight: 700; cursor: pointer; white-space: nowrap; }
  </style>
</head>
<body>

<!-- ============ SENDER MODE ============ -->
<div class="gift-card" id="senderCard" style="display:none;">
  <div class="gift-title">RADIO POSTCARD</div>

  <!-- Step 1: Select Design -->
  <div id="senderStep1">
    <div class="postcard-designs" id="postcardDesigns">
      <!-- Design 1: Vintage Microphone -->
      <div class="design-option" data-design="vintage1" onclick="selectDesign(this)">
        <div class="design-vintage1">
          <div class="dv1-grid"></div>
          <div class="dv1-base"></div>
          <div class="dv1-stamp"></div>
        </div>
        <span class="design-label">빈티지 마이크</span>
      </div>
      <!-- Design 2: Vinyl Record -->
      <div class="design-option" data-design="vintage2" onclick="selectDesign(this)">
        <div class="design-vintage2">
          <div class="dv2-record"></div>
          <div class="dv2-lines">
            <span></span><span></span><span></span>
          </div>
          <div class="dv2-note">&#9835;</div>
        </div>
        <span class="design-label">LP 레코드</span>
      </div>
      <!-- Design 3: Retro Radio -->
      <div class="design-option" data-design="vintage3" onclick="selectDesign(this)">
        <div class="design-vintage3">
          <div class="dv3-antenna"></div>
          <div class="dv3-radio">
            <div class="dv3-dial1"></div>
            <div class="dv3-dial2"></div>
          </div>
          <div class="dv3-stamp"></div>
        </div>
        <span class="design-label">레트로 라디오</span>
      </div>
      <!-- Design 4: Coffee Cup -->
      <div class="design-option" data-design="vintage4" onclick="selectDesign(this)">
        <div class="design-vintage4">
          <div class="dv4-steam">
            <span></span><span></span><span></span>
          </div>
          <div class="dv4-cup">
            <div class="dv4-coffee"></div>
          </div>
          <div class="dv4-saucer"></div>
          <div class="dv4-heart">&#9829;</div>
        </div>
        <span class="design-label">커피 한 잔</span>
      </div>
    </div>
    <div class="gift-guide">
      <p>1. 위 4개의 엽서 디자인 중 하나를 선택하세요.</p>
      <p>2. 아래 '다음' 버튼을 눌러 메시지를 작성하세요.</p>
    </div>
    <div class="gift-btn-row">
      <button class="gift-btn-back" onclick="history.back()">이전</button>
      <button class="gift-btn-next" id="step1NextBtn" disabled onclick="goStep2()">다음</button>
    </div>
  </div>

  <!-- Step 2: Write Message + Link -->
  <div id="senderStep2" class="hidden">
    <div style="font-family:'Inter',sans-serif;font-size:14px;color:var(--accent);font-weight:600;margin-bottom:12px;" id="selectedDesignName"></div>
    <textarea class="gift-msg-input" id="postcardMsgInput" placeholder="엽서에 담을 메시지를 입력하세요..." maxlength="200" oninput="onMsgInput()"></textarea>
    <div class="msg-counter"><span id="msgCount">0</span>/200</div>
    <div class="gift-link-box">
      <input type="text" readonly id="postcardLink">
      <button onclick="copyPostcardLink()">복사</button>
    </div>
    <div class="gift-copied hidden" id="postcardCopied">링크가 복사되었습니다!</div>
    <div class="gift-guide">
      <p>1. 메시지를 입력하세요 (최대 200자).</p>
      <p>2. 복사 버튼을 누르고 카톡이나 문자로 전달하세요.</p>
      <p>3. 상대방이 링크를 열면 엽서가 펼쳐집니다.</p>
    </div>
    <div class="gift-btn-row">
      <button class="gift-btn-back" onclick="goStep1()">이전</button>
    </div>
  </div>
</div>

<!-- ============ RECEIVER MODE ============ -->
<div class="receiver-card" id="receiverCard" style="display:none;">
  <div class="receiver-title">RADIO POSTCARD</div>

  <!-- Envelope Animation -->
  <div class="envelope-wrapper" id="envelopeWrapper">
    <div class="envelope" id="envelope">
      <div class="envelope-back-flap"></div>
      <div class="envelope-flap" id="envelopeFlap"></div>
      <div class="envelope-body"></div>
    </div>
    <div class="postcard-reveal" id="postcardReveal"></div>
  </div>

  <!-- Full Postcard -->
  <div class="postcard-full" id="postcardFull">
    <div class="postcard-art" id="postcardArt"></div>
    <div class="postcard-message-area">
      <div class="postcard-message-text" id="postcardMsgText"></div>
    </div>
  </div>

  <!-- Actions -->
  <div class="receiver-actions" id="receiverActions">
    <button class="receiver-chat-btn" onclick="openChatPanel()">&#128172; 채팅하기</button>
  </div>
</div>

<!-- ============ CHAT PANEL ============ -->
<div class="chat-panel" id="chatPanel" style="display:none;">
  <div class="chat-header">
    <button class="chat-back-btn" onclick="closeChatPanel()">&#9664; 이전</button>
    <span class="chat-header-title">CHAT</span>
    <span class="chat-header-info" id="chatHeaderInfo"></span>
  </div>
  <div id="chatBody">
    <div class="chat-nickname-box" id="chatNicknameBox">
      <input type="text" id="chatNicknameInput" placeholder="닉네임 입력" maxlength="12" onkeydown="if(event.key==='Enter')joinChat()">
      <button onclick="joinChat()">입장</button>
    </div>
    <div class="chat-messages hidden" id="chatMessages"></div>
    <div class="chat-input-box hidden" id="chatInputBox">
      <input type="text" id="chatMsgInput" placeholder="메시지 입력..." maxlength="200" onkeydown="if(event.key==='Enter')sendChatMsg()">
      <button onclick="sendChatMsg()">전송</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1.6.15"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* ── Supabase & Chat ── */
var SUPABASE_URL = 'https://haxcktfnuudlqciyljtp.supabase.co';
var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhheGNrdGZudXVkbHFjaXlsanRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzMDUwNDAsImV4cCI6MjA4NDg4MTA0MH0.suN7BeaHx3MjaNlMDQa0940P-rMl2XPyk4ksoQEU3YM';
var supabaseClient = null;
var chatChannel = null;
var chatRoomId = null;
var chatNickname = '';
var chatActive = false;
var chatPeerCount = 0;

function initSupabase(){
  if(supabaseClient) return;
  if(!window.supabase) return;
  supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
}

function generateRoomId(){
  var chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
  var id = '';
  for(var i = 0; i < 8; i++) id += chars.charAt(Math.floor(Math.random() * chars.length));
  return id;
}

function openChatPanel(){
  initSupabase();
  var panel = document.getElementById('chatPanel');
  panel.style.display = 'flex';
  if(chatNickname){
    document.getElementById('chatNicknameBox').classList.add('hidden');
    document.getElementById('chatMessages').classList.remove('hidden');
    document.getElementById('chatInputBox').classList.remove('hidden');
    if(!chatActive) connectChat();
  }
}

function closeChatPanel(){
  document.getElementById('chatPanel').style.display = 'none';
}

function joinChat(){
  var input = document.getElementById('chatNicknameInput');
  var name = input.value.trim();
  if(!name){ input.focus(); return; }
  chatNickname = name;
  document.getElementById('chatNicknameBox').classList.add('hidden');
  document.getElementById('chatMessages').classList.remove('hidden');
  document.getElementById('chatInputBox').classList.remove('hidden');
  document.getElementById('chatMsgInput').focus();
  connectChat();
}

function connectChat(){
  if(!supabaseClient || !chatRoomId || chatActive) return;
  chatActive = true;
  var channelName = 'listen-' + chatRoomId;
  chatChannel = supabaseClient.channel(channelName, { config: { broadcast: { self: false } } });
  chatChannel.on('broadcast', { event: 'message' }, function(payload){
    addChatMessage(payload.payload.name, payload.payload.text);
  });
  chatChannel.on('broadcast', { event: 'join' }, function(payload){
    chatPeerCount++;
    addSystemMessage(payload.payload.name + '님이 입장했습니다.');
  });
  chatChannel.on('broadcast', { event: 'leave' }, function(payload){
    chatPeerCount = Math.max(0, chatPeerCount - 1);
    addSystemMessage(payload.payload.name + '님이 퇴장했습니다.');
  });
  chatChannel.subscribe(function(status){
    if(status === 'SUBSCRIBED'){
      chatChannel.send({ type: 'broadcast', event: 'join', payload: { name: chatNickname } });
      addSystemMessage('채팅에 연결되었습니다.');
    }
  });
}

function sendChatMsg(){
  var input = document.getElementById('chatMsgInput');
  var text = input.value.trim();
  if(!text || !chatChannel || !chatActive) return;
  chatChannel.send({ type: 'broadcast', event: 'message', payload: { name: chatNickname, text: text } });
  addChatMessage(chatNickname, text, true);
  input.value = '';
  input.focus();
}

function addChatMessage(name, text, isMe){
  var container = document.getElementById('chatMessages');
  var div = document.createElement('div');
  div.className = 'chat-msg ' + (isMe ? 'me' : 'other');
  var nameSpan = document.createElement('div');
  nameSpan.className = 'chat-msg-name';
  nameSpan.textContent = name;
  var bubble = document.createElement('div');
  bubble.className = 'chat-msg-bubble';
  bubble.textContent = text;
  div.appendChild(nameSpan);
  div.appendChild(bubble);
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
}

function addSystemMessage(text){
  var container = document.getElementById('chatMessages');
  var div = document.createElement('div');
  div.className = 'chat-msg-system';
  div.textContent = text;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
}

/* ── Sender Logic ── */
var selectedDesign = '';
var designNames = {
  vintage1: '빈티지 마이크',
  vintage2: 'LP 레코드',
  vintage3: '레트로 라디오',
  vintage4: '커피 한 잔'
};

function selectDesign(el){
  var all = document.querySelectorAll('.design-option');
  all.forEach(function(d){ d.classList.remove('selected'); });
  el.classList.add('selected');
  selectedDesign = el.getAttribute('data-design');
  document.getElementById('step1NextBtn').disabled = false;
}

function goStep2(){
  if(!selectedDesign) return;
  document.getElementById('senderStep1').classList.add('hidden');
  document.getElementById('senderStep2').classList.remove('hidden');
  document.getElementById('selectedDesignName').textContent = designNames[selectedDesign] + ' 엽서';
  updatePostcardLink();
}

function goStep1(){
  document.getElementById('senderStep2').classList.add('hidden');
  document.getElementById('senderStep1').classList.remove('hidden');
}

function onMsgInput(){
  var input = document.getElementById('postcardMsgInput');
  document.getElementById('msgCount').textContent = input.value.length;
  updatePostcardLink();
}

function updatePostcardLink(){
  var msg = document.getElementById('postcardMsgInput').value.trim();
  var base = location.pathname.replace(/[^\/]*$/, '') + 'radio-postcard.html';
  var url = location.origin + base + '?design=' + selectedDesign + '&room=' + chatRoomId;
  if(msg) url += '&msg=' + encodeURIComponent(msg);
  document.getElementById('postcardLink').value = url;
}

function savePostcard(){
  try {
    initSupabase();
    if(!supabaseClient) return;
    var msg = document.getElementById('postcardMsgInput').value.trim();
    supabaseClient.from('postcards').insert({
      room_id: chatRoomId,
      design: selectedDesign,
      message: msg || null
    }).then(function(){});
  } catch(e){}
}

function copyPostcardLink(){
  var input = document.getElementById('postcardLink');
  input.select();
  input.setSelectionRange(0, 99999);
  try {
    navigator.clipboard.writeText(input.value);
  } catch(e){
    document.execCommand('copy');
  }
  var copied = document.getElementById('postcardCopied');
  copied.classList.remove('hidden');
  setTimeout(function(){ copied.classList.add('hidden'); }, 2000);
  savePostcard();
}

/* ── Receiver Logic ── */
function buildPostcardArt(design, container){
  container.innerHTML = '';
  container.className = 'postcard-art';
  if(design === 'vintage1'){
    container.classList.add('art-vintage1');
    container.innerHTML =
      '<div class="art-postmark"></div>' +
      '<div class="art-mic-body"></div>' +
      '<div class="art-mic-grid"></div>' +
      '<div class="art-mic-stand"></div>' +
      '<div class="art-mic-base"></div>' +
      '<div class="art-stamp"></div>';
  } else if(design === 'vintage2'){
    container.classList.add('art-vintage2');
    container.innerHTML =
      '<div class="art-record"><div class="art-record-label"></div></div>' +
      '<div class="art-stamp"></div>';
  } else if(design === 'vintage3'){
    container.classList.add('art-vintage3');
    container.innerHTML =
      '<div class="art-radio-antenna"></div>' +
      '<div class="art-radio-box">' +
        '<div class="art-radio-speaker"></div>' +
        '<div class="art-radio-display"></div>' +
        '<div class="art-radio-knob1"></div>' +
        '<div class="art-radio-knob2"></div>' +
      '</div>' +
      '<div class="art-postmark"></div>';
  } else if(design === 'vintage4'){
    container.classList.add('art-vintage4');
    container.innerHTML =
      '<div class="art-coffee-steam"><span></span><span></span><span></span></div>' +
      '<div class="art-coffee-cup"><div class="art-coffee-liquid"></div></div>' +
      '<div class="art-coffee-saucer"></div>' +
      '<div class="art-stamp"></div>';
  }
}

function buildMiniPostcard(design){
  var div = document.createElement('div');
  div.style.cssText = 'width:100%;height:100%;border-radius:4px;overflow:hidden;position:relative;';
  if(design === 'vintage1'){
    div.style.background = 'linear-gradient(135deg, #f5e6d3, #e8d5b7)';
  } else if(design === 'vintage2'){
    div.style.background = 'linear-gradient(135deg, #f0dcc4, #e2c9a5)';
  } else if(design === 'vintage3'){
    div.style.background = 'linear-gradient(135deg, #eedcc6, #dfc9a8)';
  } else if(design === 'vintage4'){
    div.style.background = 'linear-gradient(135deg, #f2e0ca, #e5cfb0)';
  }
  return div;
}

function typewriterEffect(element, text, callback){
  element.innerHTML = '';
  var cursor = document.createElement('span');
  cursor.className = 'typewriter-cursor';
  element.appendChild(cursor);
  var i = 0;
  var interval = setInterval(function(){
    if(i < text.length){
      element.insertBefore(document.createTextNode(text[i]), cursor);
      i++;
    } else {
      clearInterval(interval);
      setTimeout(function(){
        if(cursor.parentNode) cursor.parentNode.removeChild(cursor);
        if(callback) callback();
      }, 600);
    }
  }, 50);
}

/* ── Init ── */
function init(){
  var params = new URLSearchParams(location.search);
  var design = params.get('design');
  var room = params.get('room');
  var msg = params.get('msg') || '';

  if(design && room){
    /* RECEIVER MODE */
    chatRoomId = room;
    document.getElementById('receiverCard').style.display = '';

    /* Log receiver usage */
    try {
      var uid = localStorage.getItem('radioUsername');
      if(uid){ initSupabase(); if(supabaseClient) supabaseClient.from('feature_usage').insert({user_id:uid, feature:'radio_postcard_received'}).then(function(){}); }
    } catch(e){}

    /* Build mini postcard for envelope reveal */
    var revealEl = document.getElementById('postcardReveal');
    var miniCard = buildMiniPostcard(design);
    revealEl.appendChild(miniCard);

    /* Build full-size postcard art */
    var artEl = document.getElementById('postcardArt');
    buildPostcardArt(design, artEl);

    /* Start typewriter after postcard is revealed */
    var msgText = decodeURIComponent(msg);
    setTimeout(function(){
      var msgEl = document.getElementById('postcardMsgText');
      if(msgText){
        typewriterEffect(msgEl, msgText);
      } else {
        msgEl.textContent = '(메시지가 없습니다)';
        msgEl.style.color = 'rgba(58,42,16,0.4)';
        msgEl.style.fontStyle = 'italic';
      }
    }, 3000);

  } else {
    /* SENDER MODE */
    chatRoomId = generateRoomId();
    document.getElementById('senderCard').style.display = '';
    initSupabase();
  }
}

init();
(function(){ var uid=localStorage.getItem('radioUsername'); if(uid){initSupabase(); if(supabaseClient) supabaseClient.from('feature_usage').insert({user_id:uid,feature:'radio_postcard'}).then(function(){});} })();
// 닉네임 자동 채우기 (발신자만)
(function(){ if(!new URLSearchParams(location.search).get('room')){ var n=localStorage.getItem('radioUsername'); if(n){ var ci=document.getElementById('chatNicknameInput'); if(ci&&!ci.value) ci.value=n; } } })();
</script>
</body>
</html>