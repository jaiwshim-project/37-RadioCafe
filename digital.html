<!DOCTYPE html>
<html lang="ko" style="background:#1a1a2e">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>클라라 라디오카페 | 디지털 라디오</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Inter:wght@400;500;600;700&family=Outfit:wght@400;600;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Inter:wght@400;500;600;700&family=Outfit:wght@400;600;800&display=swap"></noscript>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    /* ============================================
       7 RADIO DESIGN THEMES
       ============================================ */

    /* 1. Wood Classic (우드 클래식) */
    :root, [data-theme="wood"] {
      --bg: #1a1a2e;
      --body-out1: #3a2a1a; --body-out2: #2a1c0e;
      --body-in1: #2c1e10; --body-in2: #1e140a;
      --texture-color: rgba(255,200,100,0.015);
      --accent: #d4a862;
      --accent-glow: rgba(212,168,98,0.5);
      --btn-bg1: #3a2a1a; --btn-bg2: #2a1c10;
      --btn-hi1: #4a3a28; --btn-hi2: #2a1c10;
      --btn-active1: #5a4020; --btn-active2: #3a2a1a;
      --btn-border: #1a120a;
      --speaker-bg: #1a120a; --speaker-border: #0e0a06;
      --mesh-color: rgba(200,180,140,0.12);
      --lcd-bg: #0a1a0a;
      --lcd-text: #55ff55; --lcd-dim: #3abf3a; --lcd-idle: #2a8a2a;
      --lcd-glow: rgba(85,255,85,0.6);
      --screw1: #5a4a38; --screw2: #3a2a1a; --screw-line: #1a120a;
      --label-color: #c8b8a0; --freq-mark: #a08868;
      --tick-color: #8a7a60;
      --needle: #ff3333; --needle-glow: rgba(255,51,51,0.6);
      --led-on: #00ff88; --led-glow: rgba(0,255,136,0.3);
      --knob-ind: #d4a862;
      --footer-color: #a09080; --footer-link: #c8b8a0;
      --antenna1: #8a7a6a; --antenna2: #c0b0a0;
      --preset-num: #c8b8a0; --preset-name: #b0a088;
      --power-icon: #c8b8a0;
      --neon-border: #ff9933; --neon-glow: rgba(255,153,51,0.6);
      --neon-light: rgba(255,180,100,0.35); --neon-light-glow: rgba(255,180,100,0.15);
    }

    /* 2. Retro Cream (레트로 크림) */
    [data-theme="cream"] {
      --bg: #d4c5a9;
      --body-out1: #f5e6c8; --body-out2: #e8d5b0;
      --body-in1: #ede0c8; --body-in2: #e2d1b0;
      --texture-color: rgba(180,140,80,0.03);
      --accent: #8b4513;
      --accent-glow: rgba(139,69,19,0.4);
      --btn-bg1: #e8d5b0; --btn-bg2: #d4c09a;
      --btn-hi1: #f0e0c0; --btn-hi2: #d4c09a;
      --btn-active1: #c9a96e; --btn-active2: #b89858;
      --btn-border: #b89858;
      --speaker-bg: #c9a96e; --speaker-border: #a88640;
      --mesh-color: rgba(100,60,20,0.08);
      --lcd-bg: #2a1a0a;
      --lcd-text: #ffcc55; --lcd-dim: #cc8833; --lcd-idle: #aa6600;
      --lcd-glow: rgba(255,204,85,0.6);
      --screw1: #c9a96e; --screw2: #a88640; --screw-line: #8a6a30;
      --label-color: #5a3e20; --freq-mark: #6a4e30;
      --tick-color: #7a5e40;
      --needle: #cc0000; --needle-glow: rgba(204,0,0,0.5);
      --led-on: #ff6600; --led-glow: rgba(255,102,0,0.3);
      --knob-ind: #8b4513;
      --footer-color: #6a4e30; --footer-link: #5a3e20;
      --antenna1: #a88640; --antenna2: #c9a96e;
      --preset-num: #5a3820; --preset-name: #6a4e30;
      --power-icon: #5a3e20;
      --neon-border: #ff6600; --neon-glow: rgba(255,102,0,0.5);
      --neon-light: rgba(255,140,60,0.3); --neon-light-glow: rgba(255,140,60,0.12);
    }

    /* 3. Midnight Black (미드나잇 블랙) */
    [data-theme="black"] {
      --bg: #0a0a0a;
      --body-out1: #222222; --body-out2: #111111;
      --body-in1: #1a1a1a; --body-in2: #0e0e0e;
      --texture-color: rgba(255,255,255,0.008);
      --accent: #ffffff;
      --accent-glow: rgba(255,255,255,0.3);
      --btn-bg1: #1e1e1e; --btn-bg2: #0e0e0e;
      --btn-hi1: #2a2a2a; --btn-hi2: #151515;
      --btn-active1: #333333; --btn-active2: #1a1a1a;
      --btn-border: #080808;
      --speaker-bg: #0a0a0a; --speaker-border: #050505;
      --mesh-color: rgba(255,255,255,0.04);
      --lcd-bg: #000000;
      --lcd-text: #ffffff; --lcd-dim: #999999; --lcd-idle: #666666;
      --lcd-glow: rgba(255,255,255,0.4);
      --screw1: #2a2a2a; --screw2: #1a1a1a; --screw-line: #080808;
      --label-color: #aaaaaa; --freq-mark: #888888;
      --tick-color: #777777;
      --needle: #ff0044; --needle-glow: rgba(255,0,68,0.6);
      --led-on: #ff0044; --led-glow: rgba(255,0,68,0.3);
      --knob-ind: #ffffff;
      --footer-color: #888888; --footer-link: #aaaaaa;
      --antenna1: #444444; --antenna2: #666666;
      --preset-num: #bbbbbb; --preset-name: #999999;
      --power-icon: #aaaaaa;
      --neon-border: #ff0044; --neon-glow: rgba(255,0,68,0.6);
      --neon-light: rgba(255,80,120,0.3); --neon-light-glow: rgba(255,80,120,0.12);
    }

    /* 4. Military (밀리터리) */
    [data-theme="military"] {
      --bg: #1a2016;
      --body-out1: #4a5540; --body-out2: #354030;
      --body-in1: #3d4a34; --body-in2: #2e3828;
      --texture-color: rgba(100,120,80,0.02);
      --accent: #c8b400;
      --accent-glow: rgba(200,180,0,0.4);
      --btn-bg1: #3d4a34; --btn-bg2: #2e3828;
      --btn-hi1: #4a5a40; --btn-hi2: #354530;
      --btn-active1: #556840; --btn-active2: #3d4a34;
      --btn-border: #1e2818;
      --speaker-bg: #222c1e; --speaker-border: #1a2216;
      --mesh-color: rgba(150,170,120,0.08);
      --lcd-bg: #0a120a;
      --lcd-text: #55ff55; --lcd-dim: #33cc33; --lcd-idle: #22aa22;
      --lcd-glow: rgba(85,255,85,0.6);
      --screw1: #5a6a4a; --screw2: #3d4a34; --screw-line: #1e2818;
      --label-color: #b0c090; --freq-mark: #90a870;
      --tick-color: #80986a;
      --needle: #ff3300; --needle-glow: rgba(255,51,0,0.6);
      --led-on: #33ff33; --led-glow: rgba(51,255,51,0.3);
      --knob-ind: #c8b400;
      --footer-color: #90a870; --footer-link: #b0c090;
      --antenna1: #5a6a4a; --antenna2: #8a9a7a;
      --preset-num: #b8d098; --preset-name: #a0b880;
      --power-icon: #b0c090;
      --neon-border: #39ff14; --neon-glow: rgba(57,255,20,0.5);
      --neon-light: rgba(120,255,80,0.3); --neon-light-glow: rgba(120,255,80,0.12);
    }

    /* 5. Chrome Silver (크롬 실버) */
    [data-theme="silver"] {
      --bg: #2a2a3a;
      --body-out1: #c0c0cc; --body-out2: #9a9aaa;
      --body-in1: #b0b0be; --body-in2: #8a8a9a;
      --texture-color: rgba(255,255,255,0.02);
      --accent: #1a1a2a;
      --accent-glow: rgba(26,26,42,0.3);
      --btn-bg1: #a0a0b0; --btn-bg2: #808090;
      --btn-hi1: #b8b8c8; --btn-hi2: #909098;
      --btn-active1: #7070a0; --btn-active2: #5a5a80;
      --btn-border: #6a6a7a;
      --speaker-bg: #5a5a6a; --speaker-border: #4a4a5a;
      --mesh-color: rgba(200,200,220,0.1);
      --lcd-bg: #0a0a1a;
      --lcd-text: #66ccff; --lcd-dim: #4499dd; --lcd-idle: #2277bb;
      --lcd-glow: rgba(102,204,255,0.6);
      --screw1: #c8c8d8; --screw2: #a0a0b0; --screw-line: #6a6a7a;
      --label-color: #b0b0c0; --freq-mark: #9090a0;
      --tick-color: #8888a0;
      --needle: #ff2222; --needle-glow: rgba(255,34,34,0.6);
      --led-on: #44aaff; --led-glow: rgba(68,170,255,0.3);
      --knob-ind: #1a1a2a;
      --footer-color: #9090a0; --footer-link: #b0b0c0;
      --antenna1: #9a9aaa; --antenna2: #d0d0dd;
      --preset-num: #c0c0d0; --preset-name: #a8a8b8;
      --power-icon: #b0b0c0;
      --neon-border: #4488ff; --neon-glow: rgba(68,136,255,0.5);
      --neon-light: rgba(120,170,255,0.3); --neon-light-glow: rgba(120,170,255,0.12);
    }

    /* 6. Neon Cyber (네온 사이버) */
    [data-theme="cyber"] {
      --bg: #05050f;
      --body-out1: #15152a; --body-out2: #0a0a18;
      --body-in1: #101025; --body-in2: #08081a;
      --texture-color: rgba(0,200,255,0.008);
      --accent: #00e5ff;
      --accent-glow: rgba(0,229,255,0.5);
      --btn-bg1: #12122a; --btn-bg2: #0a0a1a;
      --btn-hi1: #1a1a38; --btn-hi2: #0e0e22;
      --btn-active1: #1a1a48; --btn-active2: #101030;
      --btn-border: #0a0a18;
      --speaker-bg: #08081a; --speaker-border: #050510;
      --mesh-color: rgba(0,229,255,0.06);
      --lcd-bg: #020210;
      --lcd-text: #00ffff; --lcd-dim: #00aacc; --lcd-idle: #0088aa;
      --lcd-glow: rgba(0,255,255,0.7);
      --screw1: #1a1a38; --screw2: #101025; --screw-line: #050510;
      --label-color: #00bbdd; --freq-mark: #0099bb;
      --tick-color: #0088aa;
      --needle: #ff00aa; --needle-glow: rgba(255,0,170,0.7);
      --led-on: #ff00aa; --led-glow: rgba(255,0,170,0.4);
      --knob-ind: #00e5ff;
      --footer-color: #0099bb; --footer-link: #00bbdd;
      --antenna1: #006688; --antenna2: #00aacc;
      --preset-num: #00ccee; --preset-name: #00aacc;
      --power-icon: #00bbdd;
      --neon-border: #00e5ff; --neon-glow: rgba(0,229,255,0.6);
      --neon-light: rgba(80,230,255,0.3); --neon-light-glow: rgba(80,230,255,0.12);
    }

    /* 7. Rose Gold (로즈 골드) */
    [data-theme="rose"] {
      --bg: #1a1018;
      --body-out1: #8a6070; --body-out2: #6a4050;
      --body-in1: #7a5565; --body-in2: #5a3545;
      --texture-color: rgba(255,180,200,0.015);
      --accent: #ffc8d0;
      --accent-glow: rgba(255,200,208,0.4);
      --btn-bg1: #6a4858; --btn-bg2: #5a3545;
      --btn-hi1: #7a5565; --btn-hi2: #5a3a4a;
      --btn-active1: #8a5a6a; --btn-active2: #6a4858;
      --btn-border: #3a2030;
      --speaker-bg: #3a2030; --speaker-border: #2a1520;
      --mesh-color: rgba(255,200,208,0.06);
      --lcd-bg: #120810;
      --lcd-text: #ffaacc; --lcd-dim: #cc6699; --lcd-idle: #aa4477;
      --lcd-glow: rgba(255,170,204,0.6);
      --screw1: #8a6878; --screw2: #6a4858; --screw-line: #3a2030;
      --label-color: #d0a8b8; --freq-mark: #bb88a0;
      --tick-color: #aa7890;
      --needle: #ff4488; --needle-glow: rgba(255,68,136,0.6);
      --led-on: #ff88aa; --led-glow: rgba(255,136,170,0.3);
      --knob-ind: #ffc8d0;
      --footer-color: #bb88a0; --footer-link: #d0a8b8;
      --antenna1: #8a6878; --antenna2: #bb99aa;
      --preset-num: #d8b0c0; --preset-name: #c098a8;
      --power-icon: #d0a8b8;
      --neon-border: #ff44aa; --neon-glow: rgba(255,68,170,0.6);
      --neon-light: rgba(255,130,200,0.3); --neon-light-glow: rgba(255,130,200,0.12);
    }

    /* 8. Maltese (말티즈) */
    [data-theme="maltese"] {
      --bg: #f0ebe5;
      --body-out1: #faf8f5; --body-out2: #f0ece6;
      --body-in1: #f8f5f0; --body-in2: #efe8e0;
      --texture-color: rgba(180,160,140,0.02);
      --accent: #8B5E3C;
      --accent-glow: rgba(139,94,60,0.4);
      --btn-bg1: #f0ebe5; --btn-bg2: #e5ddd5;
      --btn-hi1: #f8f4ee; --btn-hi2: #eae2da;
      --btn-active1: #ddd0c0; --btn-active2: #c8b8a5;
      --btn-border: #c8b8a5;
      --speaker-bg: #d8ccc0; --speaker-border: #bfb0a0;
      --mesh-color: rgba(120,90,60,0.06);
      --lcd-bg: #1a120a;
      --lcd-text: #ffdd88; --lcd-dim: #ccaa55; --lcd-idle: #aa8833;
      --lcd-glow: rgba(255,221,136,0.6);
      --screw1: #d8ccc0; --screw2: #bfb0a0; --screw-line: #a09080;
      --label-color: #6a5040; --freq-mark: #7a6050;
      --tick-color: #8a7060;
      --needle: #cc4422; --needle-glow: rgba(204,68,34,0.5);
      --led-on: #8B5E3C; --led-glow: rgba(139,94,60,0.3);
      --knob-ind: #8B5E3C;
      --footer-color: #7a6050; --footer-link: #5a3e20;
      --antenna1: #c0b0a0; --antenna2: #e0d5ca;
      --preset-num: #5a4030; --preset-name: #6a5040;
      --power-icon: #6a5040;
      --neon-border: #DEB887; --neon-glow: rgba(222,184,135,0.5);
      --neon-light: rgba(222,184,135,0.3); --neon-light-glow: rgba(222,184,135,0.12);
    }

    /* 9. Purple (퍼플 갤럭시) */
    [data-theme="purple"] {
      --bg: #0e0a1a;
      --body-out1: #1e1040; --body-out2: #140a30;
      --body-in1: #180e38; --body-in2: #100828;
      --texture-color: rgba(140,80,220,0.015);
      --accent: #b388ff;
      --accent-glow: rgba(179,136,255,0.5);
      --btn-bg1: #2a1858; --btn-bg2: #1e1040;
      --btn-hi1: #3a2068; --btn-hi2: #2a1858;
      --btn-active1: #4a2888; --btn-active2: #3a1868;
      --btn-border: #1a0e30;
      --speaker-bg: #120a22; --speaker-border: #0a0618;
      --mesh-color: rgba(160,120,255,0.1);
      --lcd-bg: #0a0618;
      --lcd-text: #d0aaff; --lcd-dim: #a880dd; --lcd-idle: #8060bb;
      --lcd-glow: rgba(208,170,255,0.6);
      --screw1: #3a2868; --screw2: #2a1848; --screw-line: #1a0e30;
      --label-color: #c8a8f0; --freq-mark: #a888d0;
      --tick-color: #8868b0;
      --needle: #ff44cc; --needle-glow: rgba(255,68,204,0.6);
      --led-on: #b388ff; --led-glow: rgba(179,136,255,0.3);
      --knob-ind: #b388ff;
      --footer-color: #a088c8; --footer-link: #c8a8f0;
      --antenna1: #6a5888; --antenna2: #9a88b0;
      --preset-num: #5a4030; --preset-name: #6a5040;
      --power-icon: #c8a8f0;
      --neon-border: #9c4dff; --neon-glow: rgba(156,77,255,0.6);
      --neon-light: rgba(179,136,255,0.35); --neon-light-glow: rgba(179,136,255,0.15);
    }

    /* 10. Hot Pink (핫핑크 네온) */
    [data-theme="hotpink"] {
      --bg: #1a0a18;
      --body-out1: #3a1038; --body-out2: #2a0828;
      --body-in1: #2e0c2e; --body-in2: #200820;
      --texture-color: rgba(255,80,180,0.015);
      --accent: #ff69b4;
      --accent-glow: rgba(255,105,180,0.5);
      --btn-bg1: #3a1038; --btn-bg2: #2a0828;
      --btn-hi1: #4a1848; --btn-hi2: #3a1038;
      --btn-active1: #5a2058; --btn-active2: #4a1848;
      --btn-border: #1a0818;
      --speaker-bg: #140810; --speaker-border: #0e060a;
      --mesh-color: rgba(255,100,180,0.1);
      --lcd-bg: #0a0608;
      --lcd-text: #ff88cc; --lcd-dim: #dd66aa; --lcd-idle: #bb4488;
      --lcd-glow: rgba(255,136,204,0.6);
      --screw1: #4a2040; --screw2: #2a1020; --screw-line: #1a0818;
      --label-color: #f0a8d0; --freq-mark: #d888b8;
      --tick-color: #b868a0;
      --needle: #ff1493; --needle-glow: rgba(255,20,147,0.6);
      --led-on: #ff69b4; --led-glow: rgba(255,105,180,0.3);
      --knob-ind: #ff69b4;
      --footer-color: #d888b8; --footer-link: #f0a8d0;
      --antenna1: #8a5878; --antenna2: #b088a0;
      --preset-num: #5a4030; --preset-name: #6a5040;
      --power-icon: #f0a8d0;
      --neon-border: #ff1493; --neon-glow: rgba(255,20,147,0.6);
      --neon-light: rgba(255,105,180,0.35); --neon-light-glow: rgba(255,105,180,0.15);
    }

    /* ============================================
       MATERIAL TEXTURES per theme
       ============================================ */

    /* 1. Wood - 나무결 (Woodgrain) */
    [data-theme="wood"] .radio-inner::before {
      background:
        /* knot */
        radial-gradient(ellipse 18px 30px at 25% 40%, rgba(180,120,50,0.06) 0%, transparent 70%),
        radial-gradient(ellipse 14px 22px at 72% 65%, rgba(180,120,50,0.05) 0%, transparent 70%),
        /* grain lines */
        repeating-linear-gradient(92deg, transparent, transparent 2px, rgba(255,200,100,0.025) 2px, rgba(255,200,100,0.025) 4px),
        repeating-linear-gradient(88deg, transparent, transparent 5px, rgba(200,150,60,0.018) 5px, rgba(200,150,60,0.018) 7px),
        repeating-linear-gradient(90deg, transparent, transparent 11px, rgba(160,100,30,0.02) 11px, rgba(160,100,30,0.02) 12px);
    }
    [data-theme="wood"] .speaker-mesh {
      background-image:
        radial-gradient(circle, rgba(200,180,140,0.14) 1px, transparent 1px);
      background-size: 6px 6px;
    }
    [data-theme="wood"] .radio {
      border-radius: 24px;
      box-shadow:
        0 30px 60px rgba(0,0,0,0.6),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.08);
    }

    /* 2. Cream - 가죽 (Leather) */
    [data-theme="cream"] .radio-inner::before {
      background:
        /* leather pebble bumps */
        radial-gradient(circle 2px at 30% 30%, rgba(120,70,20,0.06), transparent 50%),
        radial-gradient(circle 3px at 70% 60%, rgba(120,70,20,0.05), transparent 50%),
        radial-gradient(circle 2px at 50% 80%, rgba(120,70,20,0.04), transparent 50%),
        /* pebble pattern */
        radial-gradient(ellipse 4px 3px at 20% 20%, rgba(100,50,10,0.04), transparent 70%),
        radial-gradient(ellipse 3px 4px at 60% 40%, rgba(100,50,10,0.035), transparent 70%),
        radial-gradient(ellipse 4px 3px at 80% 70%, rgba(100,50,10,0.04), transparent 70%),
        radial-gradient(ellipse 3px 4px at 40% 90%, rgba(100,50,10,0.03), transparent 70%),
        /* fine grain */
        repeating-linear-gradient(45deg, transparent, transparent 1px, rgba(80,40,10,0.012) 1px, rgba(80,40,10,0.012) 2px),
        repeating-linear-gradient(-45deg, transparent, transparent 1px, rgba(80,40,10,0.01) 1px, rgba(80,40,10,0.01) 2px);
    }
    [data-theme="cream"] .radio {
      border-radius: 28px;
      box-shadow:
        0 30px 60px rgba(80,50,20,0.3),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.3);
    }
    /* Stitching effect */
    [data-theme="cream"] .radio-inner {
      border: 2px solid rgba(139,69,19,0.15);
      outline: 2px dashed rgba(139,69,19,0.12);
      outline-offset: 4px;
    }
    [data-theme="cream"] .speaker-mesh {
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(100,60,20,0.06) 3px, rgba(100,60,20,0.06) 4px),
        repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(100,60,20,0.06) 3px, rgba(100,60,20,0.06) 4px);
      background-size: 4px 4px;
    }

    /* 3. Black - 카본 파이버 (Carbon Fiber) */
    [data-theme="black"] .radio-inner::before {
      background:
        /* carbon weave */
        repeating-linear-gradient(
          45deg,
          transparent, transparent 4px,
          rgba(255,255,255,0.02) 4px, rgba(255,255,255,0.02) 5px
        ),
        repeating-linear-gradient(
          -45deg,
          transparent, transparent 4px,
          rgba(255,255,255,0.015) 4px, rgba(255,255,255,0.015) 5px
        ),
        /* cross-fiber shimmer */
        repeating-linear-gradient(
          45deg,
          rgba(255,255,255,0.01) 0px, transparent 1px,
          transparent 3px, rgba(255,255,255,0.008) 4px
        ),
        repeating-linear-gradient(
          -45deg,
          rgba(255,255,255,0.01) 0px, transparent 1px,
          transparent 3px, rgba(255,255,255,0.008) 4px
        );
      background-size: 8px 8px, 8px 8px, 8px 8px, 8px 8px;
    }
    [data-theme="black"] .radio {
      border-radius: 18px;
      box-shadow:
        0 30px 60px rgba(0,0,0,0.8),
        0 0 10px var(--neon-glow),
        0 0 25px var(--neon-glow),
        inset 0 0 10px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.04);
    }
    [data-theme="black"] .speaker-mesh {
      background-image:
        radial-gradient(circle, rgba(255,255,255,0.06) 0.5px, transparent 0.5px);
      background-size: 4px 4px;
    }
    [data-theme="black"] .screw {
      background: linear-gradient(145deg, #333, #111);
      border-color: #080808;
    }
    [data-theme="black"] .screw::after { background: #050505; }

    /* 4. Military - 캔버스 (Canvas Fabric) */
    [data-theme="military"] .radio-inner::before {
      background:
        /* canvas weave horizontal */
        repeating-linear-gradient(
          0deg,
          transparent, transparent 2px,
          rgba(150,170,120,0.025) 2px, rgba(150,170,120,0.025) 3px,
          transparent 3px, transparent 5px
        ),
        /* canvas weave vertical */
        repeating-linear-gradient(
          90deg,
          transparent, transparent 2px,
          rgba(140,160,110,0.02) 2px, rgba(140,160,110,0.02) 3px,
          transparent 3px, transparent 5px
        ),
        /* coarser fabric overlay */
        repeating-linear-gradient(
          0deg,
          transparent, transparent 8px,
          rgba(100,130,70,0.015) 8px, rgba(100,130,70,0.015) 9px
        ),
        repeating-linear-gradient(
          90deg,
          transparent, transparent 8px,
          rgba(100,130,70,0.012) 8px, rgba(100,130,70,0.012) 9px
        );
    }
    [data-theme="military"] .radio {
      border-radius: 12px;
      box-shadow:
        0 25px 50px rgba(0,0,0,0.5),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.05);
    }
    [data-theme="military"] .radio-inner { border-radius: 10px; }
    [data-theme="military"] .speaker-mesh {
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(150,170,120,0.07) 2px, rgba(150,170,120,0.07) 3px),
        repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(150,170,120,0.07) 2px, rgba(150,170,120,0.07) 3px);
      background-size: 5px 5px;
    }
    [data-theme="military"] .speaker-grille { border-radius: 6px; }
    [data-theme="military"] .lcd-display { border-radius: 4px; }
    [data-theme="military"] .preset-btn { border-radius: 4px; }

    /* 5. Silver - 브러시드 메탈 (Brushed Aluminum) */
    [data-theme="silver"] .radio-inner::before {
      background:
        /* fine brush strokes horizontal */
        repeating-linear-gradient(
          0deg,
          transparent, transparent 1px,
          rgba(255,255,255,0.015) 1px, rgba(255,255,255,0.015) 2px
        ),
        /* slightly thicker brush strokes */
        repeating-linear-gradient(
          2deg,
          transparent, transparent 3px,
          rgba(255,255,255,0.02) 3px, rgba(255,255,255,0.02) 4px
        ),
        /* highlight sheen */
        linear-gradient(
          180deg,
          rgba(255,255,255,0.06) 0%,
          transparent 15%,
          transparent 60%,
          rgba(255,255,255,0.03) 100%
        ),
        /* subtle color variation */
        radial-gradient(ellipse at 30% 0%, rgba(255,255,255,0.04), transparent 50%);
    }
    [data-theme="silver"] .radio {
      border-radius: 20px;
      box-shadow:
        0 30px 60px rgba(0,0,0,0.4),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.3);
    }
    [data-theme="silver"] .radio-inner {
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.15);
    }
    [data-theme="silver"] .speaker-mesh {
      background-image:
        radial-gradient(circle, rgba(200,200,220,0.12) 1px, transparent 1px);
      background-size: 5px 5px;
    }
    [data-theme="silver"] .knob {
      background: linear-gradient(145deg, #c0c0d0, #808090) !important;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.2), inset 0 -2px 4px rgba(0,0,0,0.2);
    }

    /* 6. Cyber - 회로기판 (Circuit Board) */
    [data-theme="cyber"] .radio-inner::before {
      background:
        /* circuit grid */
        repeating-linear-gradient(
          0deg,
          transparent, transparent 19px,
          rgba(0,229,255,0.03) 19px, rgba(0,229,255,0.03) 20px
        ),
        repeating-linear-gradient(
          90deg,
          transparent, transparent 19px,
          rgba(0,229,255,0.03) 19px, rgba(0,229,255,0.03) 20px
        ),
        /* circuit traces */
        linear-gradient(0deg, transparent 48%, rgba(0,229,255,0.015) 49%, rgba(0,229,255,0.015) 51%, transparent 52%),
        linear-gradient(90deg, transparent 28%, rgba(0,229,255,0.01) 29%, rgba(0,229,255,0.01) 31%, transparent 32%),
        linear-gradient(90deg, transparent 68%, rgba(0,229,255,0.012) 69%, rgba(0,229,255,0.012) 71%, transparent 72%),
        /* solder point dots */
        radial-gradient(circle 1px at 20px 20px, rgba(0,229,255,0.04), transparent 2px),
        radial-gradient(circle 1px at 40px 40px, rgba(0,229,255,0.03), transparent 2px);
      background-size: 20px 20px, 20px 20px, 100% 100%, 100% 100%, 100% 100%, 60px 60px, 60px 60px;
    }
    [data-theme="cyber"] .radio {
      border-radius: 16px;
      box-shadow:
        0 30px 60px rgba(0,0,0,0.7),
        0 0 12px var(--neon-glow),
        0 0 30px var(--neon-glow),
        0 0 60px rgba(0,229,255,0.15),
        inset 0 0 12px var(--neon-glow);
    }
    [data-theme="cyber"] .speaker-mesh {
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(0,229,255,0.04) 3px, rgba(0,229,255,0.04) 4px),
        repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(0,229,255,0.04) 3px, rgba(0,229,255,0.04) 4px);
      background-size: 4px 4px;
    }
    [data-theme="cyber"] .speaker-grille {
      box-shadow: inset 0 4px 12px rgba(0,0,0,0.6), 0 0 8px rgba(0,229,255,0.08);
    }
    /* Neon border glow */
    [data-theme="cyber"] .radio-inner::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      border-radius: inherit;
      border: 1px solid rgba(0,229,255,0.06);
      pointer-events: none;
      z-index: 0;
    }

    /* 7. Rose - 대리석 (Marble) */
    [data-theme="rose"] .radio-inner::before {
      background:
        /* marble veins - primary */
        linear-gradient(
          137deg,
          transparent 20%,
          rgba(255,220,230,0.04) 22%, rgba(255,220,230,0.04) 23%,
          transparent 25%,
          transparent 45%,
          rgba(255,200,210,0.035) 47%, rgba(255,200,210,0.035) 48%,
          transparent 50%,
          transparent 70%,
          rgba(255,210,220,0.03) 72%, rgba(255,210,220,0.03) 73%,
          transparent 75%
        ),
        /* marble veins - secondary */
        linear-gradient(
          52deg,
          transparent 10%,
          rgba(255,180,200,0.025) 12%, rgba(255,180,200,0.025) 13%,
          transparent 15%,
          transparent 35%,
          rgba(255,190,210,0.03) 37%, rgba(255,190,210,0.03) 38%,
          transparent 40%,
          transparent 55%,
          rgba(255,200,220,0.02) 57%, rgba(255,200,220,0.02) 58%,
          transparent 60%,
          transparent 80%,
          rgba(255,180,200,0.025) 82%, rgba(255,180,200,0.025) 83%,
          transparent 85%
        ),
        /* fine veins */
        linear-gradient(
          165deg,
          transparent 30%,
          rgba(255,220,230,0.02) 31%, rgba(255,220,230,0.02) 31.5%,
          transparent 32%,
          transparent 60%,
          rgba(255,220,230,0.018) 61%, rgba(255,220,230,0.018) 61.5%,
          transparent 62%
        ),
        /* polished sheen */
        radial-gradient(ellipse at 30% 20%, rgba(255,255,255,0.04), transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(255,255,255,0.03), transparent 40%);
    }
    [data-theme="rose"] .radio {
      border-radius: 26px;
      box-shadow:
        0 30px 60px rgba(40,10,20,0.5),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.12);
    }
    /* Polished marble sheen overlay */
    [data-theme="rose"] .radio-inner {
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
    }
    [data-theme="rose"] .speaker-mesh {
      background-image:
        radial-gradient(circle, rgba(255,200,208,0.08) 1px, transparent 1px);
      background-size: 5px 5px;
    }
    [data-theme="rose"] .speaker-grille {
      border-radius: 16px;
    }

    /* 8. Maltese - 부드러운 털 결 (Soft Fur Texture) */
    [data-theme="maltese"] .radio-inner::before {
      background:
        /* soft wavy fur lines */
        repeating-linear-gradient(
          170deg,
          transparent, transparent 4px,
          rgba(200,180,160,0.025) 4px, rgba(200,180,160,0.025) 5px
        ),
        repeating-linear-gradient(
          175deg,
          transparent, transparent 6px,
          rgba(220,200,180,0.02) 6px, rgba(220,200,180,0.02) 7px
        ),
        repeating-linear-gradient(
          168deg,
          transparent, transparent 8px,
          rgba(180,160,140,0.018) 8px, rgba(180,160,140,0.018) 9px
        ),
        /* fluffy dot highlights */
        radial-gradient(circle 2px at 10px 12px, rgba(255,255,255,0.04), transparent 3px),
        radial-gradient(circle 2px at 30px 25px, rgba(255,255,255,0.03), transparent 3px),
        radial-gradient(circle 2px at 50px 8px, rgba(255,255,255,0.035), transparent 3px);
      background-size: 10px 10px, 14px 14px, 18px 18px, 60px 40px, 60px 40px, 60px 40px;
    }
    [data-theme="maltese"] .radio {
      border-radius: 30px;
      box-shadow:
        0 30px 60px rgba(80,60,40,0.2),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.5);
    }
    [data-theme="maltese"] .radio-inner {
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
    }
    [data-theme="maltese"] .speaker-mesh {
      background-image:
        radial-gradient(circle, rgba(139,94,60,0.05) 1px, transparent 1px);
      background-size: 5px 5px;
    }
    [data-theme="maltese"] .speaker-grille {
      border-radius: 20px;
    }
    [data-theme="maltese"] .screw {
      background: linear-gradient(145deg, #e8ddd0, #c8b8a5);
      border-color: #b0a090;
    }
    /* Maltese face silhouette background */
    [data-theme="maltese"] .radio-inner::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cg fill='none' stroke='rgba(139,94,60,0.05)' stroke-width='1.5'%3E%3C!-- fluffy head outline --%3E%3Cpath d='M60 95 Q50 70 60 55 Q70 40 85 45 Q95 35 105 35 Q115 35 125 45 Q140 40 150 55 Q160 70 150 95' fill='rgba(139,94,60,0.02)'/%3E%3C!-- face --%3E%3Cellipse cx='105' cy='110' rx='42' ry='38' fill='rgba(139,94,60,0.015)'/%3E%3C!-- fluffy cheeks --%3E%3Cpath d='M63 100 Q50 110 55 125 Q60 135 75 130' stroke='rgba(139,94,60,0.04)' fill='rgba(139,94,60,0.015)'/%3E%3Cpath d='M147 100 Q160 110 155 125 Q150 135 135 130' stroke='rgba(139,94,60,0.04)' fill='rgba(139,94,60,0.015)'/%3E%3C!-- floppy ears --%3E%3Cpath d='M65 85 Q40 90 35 115 Q32 140 50 155 Q60 145 68 125' fill='rgba(139,94,60,0.025)' stroke='rgba(139,94,60,0.04)'/%3E%3Cpath d='M145 85 Q170 90 175 115 Q178 140 160 155 Q150 145 142 125' fill='rgba(139,94,60,0.025)' stroke='rgba(139,94,60,0.04)'/%3E%3C!-- eyes --%3E%3Ccircle cx='88' cy='105' r='6' fill='rgba(60,35,15,0.06)'/%3E%3Ccircle cx='122' cy='105' r='6' fill='rgba(60,35,15,0.06)'/%3E%3C!-- eye highlights --%3E%3Ccircle cx='90' cy='103' r='2.5' fill='rgba(255,255,255,0.04)'/%3E%3Ccircle cx='124' cy='103' r='2.5' fill='rgba(255,255,255,0.04)'/%3E%3C!-- nose --%3E%3Cellipse cx='105' cy='118' rx='6' ry='5' fill='rgba(60,35,15,0.06)'/%3E%3C!-- nose highlight --%3E%3Cellipse cx='104' cy='116' rx='2' ry='1.5' fill='rgba(255,255,255,0.03)'/%3E%3C!-- mouth --%3E%3Cpath d='M105 123 Q100 130 93 127' stroke='rgba(139,94,60,0.04)'/%3E%3Cpath d='M105 123 Q110 130 117 127' stroke='rgba(139,94,60,0.04)'/%3E%3C!-- tongue --%3E%3Cellipse cx='105' cy='132' rx='5' ry='6' fill='rgba(255,120,120,0.04)' stroke='rgba(200,80,80,0.04)'/%3E%3C!-- fluffy body tuft --%3E%3Cpath d='M75 145 Q80 160 90 168 Q100 172 110 172 Q120 168 130 160 Q135 145 130 140' stroke='rgba(139,94,60,0.03)' fill='rgba(139,94,60,0.01)'/%3E%3C!-- fur texture lines --%3E%3Cpath d='M70 60 Q68 50 72 48' stroke='rgba(139,94,60,0.03)'/%3E%3Cpath d='M90 42 Q92 34 95 36' stroke='rgba(139,94,60,0.03)'/%3E%3Cpath d='M115 38 Q118 30 120 34' stroke='rgba(139,94,60,0.03)'/%3E%3Cpath d='M140 55 Q143 47 140 45' stroke='rgba(139,94,60,0.03)'/%3E%3C/g%3E%3C/svg%3E") no-repeat center center,
        radial-gradient(ellipse at 50% 0%, rgba(255,255,255,0.05) 0%, transparent 50%),
        radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.08) 100%);
      background-size: 65% auto, 100% 100%, 100% 100%;
      pointer-events: none; z-index: 0; border-radius: inherit;
    }

    /* 9. Purple - 은하 성운 (Galaxy Nebula) */
    [data-theme="purple"] .radio-inner::before {
      background:
        radial-gradient(ellipse 40px 40px at 20% 30%, rgba(156,77,255,0.06) 0%, transparent 70%),
        radial-gradient(ellipse 30px 50px at 75% 60%, rgba(100,60,200,0.05) 0%, transparent 70%),
        radial-gradient(ellipse 50px 30px at 50% 80%, rgba(180,100,255,0.04) 0%, transparent 70%),
        repeating-linear-gradient(135deg, transparent, transparent 3px, rgba(140,80,220,0.02) 3px, rgba(140,80,220,0.02) 4px);
    }
    [data-theme="purple"] .radio {
      border-radius: 24px;
      box-shadow:
        0 30px 60px rgba(0,0,0,0.7),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.06);
    }
    [data-theme="purple"] .radio-inner::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(ellipse at 30% 20%, rgba(156,77,255,0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 70%, rgba(100,60,200,0.06) 0%, transparent 50%),
        radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.15) 100%);
      pointer-events: none; z-index: 0; border-radius: inherit;
    }

    /* 10. Hot Pink - 네온 글로우 (Neon Glow) */
    [data-theme="hotpink"] .radio-inner::before {
      background:
        radial-gradient(ellipse 35px 45px at 25% 35%, rgba(255,20,147,0.05) 0%, transparent 70%),
        radial-gradient(ellipse 45px 35px at 70% 55%, rgba(255,80,180,0.04) 0%, transparent 70%),
        repeating-linear-gradient(160deg, transparent, transparent 4px, rgba(255,80,180,0.015) 4px, rgba(255,80,180,0.015) 5px),
        repeating-linear-gradient(110deg, transparent, transparent 6px, rgba(255,20,147,0.01) 6px, rgba(255,20,147,0.01) 7px);
    }
    [data-theme="hotpink"] .radio {
      border-radius: 24px;
      box-shadow:
        0 30px 60px rgba(0,0,0,0.7),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.06);
    }
    [data-theme="hotpink"] .radio-inner::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(ellipse at 40% 25%, rgba(255,20,147,0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 65% 75%, rgba(255,105,180,0.06) 0%, transparent 50%),
        radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.15) 100%);
      pointer-events: none; z-index: 0; border-radius: inherit;
    }

    /* ============================================
       TEXT READABILITY & VIVID COLORS
       ============================================ */
    :root, [data-theme="wood"] {
      --label-color: #e8d0a8; --freq-mark: #d4b888; --tick-color: #b89868;
      --preset-num: #f0d898; --preset-name: #d8c090;
      --footer-color: #c8b088; --footer-link: #e8c880;
      --power-icon: #e8d0a8;
      --lcd-text: #55ff55; --lcd-dim: #44dd44; --lcd-idle: #33bb33;
      --lcd-glow: rgba(85,255,85,0.7);
    }
    [data-theme="cream"] {
      --label-color: #5a3518; --freq-mark: #704828; --tick-color: #8a5830;
      --preset-num: #4a2810; --preset-name: #5a3818;
      --footer-color: #704828; --footer-link: #4a2810;
      --power-icon: #5a3518;
      --lcd-text: #ffcc55; --lcd-dim: #ddaa33; --lcd-idle: #bb8800;
      --lcd-glow: rgba(255,204,85,0.7);
    }
    [data-theme="black"] {
      --label-color: #cccccc; --freq-mark: #aaaaaa; --tick-color: #888888;
      --preset-num: #dddddd; --preset-name: #bbbbbb;
      --footer-color: #999999; --footer-link: #cccccc;
      --power-icon: #cccccc;
      --lcd-text: #ffffff; --lcd-dim: #bbbbbb; --lcd-idle: #888888;
      --lcd-glow: rgba(255,255,255,0.5);
    }
    [data-theme="military"] {
      --label-color: #c8e098; --freq-mark: #a8c878; --tick-color: #88aa58;
      --preset-num: #d8ee98; --preset-name: #b8d080;
      --footer-color: #a8c878; --footer-link: #c8e098;
      --power-icon: #c8e098;
      --lcd-text: #55ff55; --lcd-dim: #44dd44; --lcd-idle: #33bb33;
      --lcd-glow: rgba(85,255,85,0.7);
    }
    [data-theme="silver"] {
      --label-color: #222238; --freq-mark: #333348; --tick-color: #444458;
      --preset-num: #1a1a30; --preset-name: #333348;
      --footer-color: #444458; --footer-link: #222238;
      --power-icon: #222238;
      --lcd-text: #77ddff; --lcd-dim: #55bbdd; --lcd-idle: #3399bb;
      --lcd-glow: rgba(119,221,255,0.7);
    }
    [data-theme="cyber"] {
      --label-color: #00ddff; --freq-mark: #00bbdd; --tick-color: #0099bb;
      --preset-num: #00eeff; --preset-name: #00ccee;
      --footer-color: #00bbdd; --footer-link: #00eeff;
      --power-icon: #00ddff;
      --lcd-text: #00ffff; --lcd-dim: #00ddee; --lcd-idle: #00bbcc;
      --lcd-glow: rgba(0,255,255,0.8);
    }
    [data-theme="rose"] {
      --label-color: #eec0d0; --freq-mark: #dda8b8; --tick-color: #cc90a0;
      --preset-num: #ffd0dd; --preset-name: #eec0d0;
      --footer-color: #dda8b8; --footer-link: #ffd0dd;
      --power-icon: #eec0d0;
      --lcd-text: #ffbbdd; --lcd-dim: #dd88aa; --lcd-idle: #cc6699;
      --lcd-glow: rgba(255,187,221,0.7);
    }
    [data-theme="maltese"] {
      --label-color: #5a4030; --freq-mark: #6a5040; --tick-color: #7a6050;
      --preset-num: #4a3020; --preset-name: #5a4030;
      --footer-color: #6a5040; --footer-link: #4a3020;
      --power-icon: #5a4030;
      --lcd-text: #ffdd88; --lcd-dim: #ddbb55; --lcd-idle: #ccaa44;
      --lcd-glow: rgba(255,221,136,0.7);
    }
    [data-theme="purple"] {
      --label-color: #d0b8f0; --freq-mark: #b898d8; --tick-color: #9878b8;
      --preset-num: #e0c8ff; --preset-name: #c8a8e8;
      --footer-color: #b898d8; --footer-link: #d0b8f0;
      --power-icon: #d0b8f0;
      --lcd-text: #d0aaff; --lcd-dim: #b088dd; --lcd-idle: #9068bb;
      --lcd-glow: rgba(208,170,255,0.7);
    }
    [data-theme="hotpink"] {
      --label-color: #f0b8d8; --freq-mark: #d898c0; --tick-color: #c080a8;
      --preset-num: #ffc8e0; --preset-name: #f0b0d0;
      --footer-color: #d898c0; --footer-link: #f0b8d8;
      --power-icon: #f0b8d8;
      --lcd-text: #ff99cc; --lcd-dim: #dd77aa; --lcd-idle: #cc5588;
      --lcd-glow: rgba(255,153,204,0.7);
    }

    /* ============================================
       CORE STYLES (using CSS variables)
       ============================================ */
    body {
      background: var(--bg);
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      justify-content: safe center;
      align-items: center;
      font-family: 'Inter', sans-serif;
      padding: 20px;
      overflow-y: auto;
      transition: background 0.6s ease;
    }

    /* === THEME SWITCHER === */
    .theme-switcher {
      display: flex;
      gap: 8px;
      padding: 10px 16px;
      background: rgba(0,0,0,0.2);
      border-radius: 20px 20px 0 0;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.04);
      justify-content: center;
      align-items: center;
    }
    .theme-toggle-btn {
      background: none; border: none; cursor: pointer; padding: 2px;
      color: var(--label-color, #999); font-size: 14px; line-height: 1;
      opacity: 0.6; transition: opacity 0.2s; flex-shrink: 0;
    }
    .theme-toggle-btn:hover { opacity: 1; }
    .theme-dots-wrap {
      display: flex; gap: 8px; justify-content: center; align-items: center;
      overflow: hidden; transition: max-width 0.3s ease, opacity 0.3s ease;
      max-width: 500px; opacity: 1;
    }
    .theme-dots-wrap.hidden {
      max-width: 0; opacity: 0; gap: 0;
    }

    .theme-dot {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.15);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .theme-dot:hover { transform: scale(1.2); }
    .theme-dot.active {
      border-color: #fff;
      transform: scale(1.15);
      box-shadow: 0 2px 12px rgba(255,255,255,0.2);
    }
    .theme-dot.active::after {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 8px; height: 8px;
      background: #fff;
      border-radius: 50%;
    }

    .theme-dot[data-t="wood"]     { background: linear-gradient(135deg, #3a2a1a, #d4a862); }
    .theme-dot[data-t="cream"]    { background: linear-gradient(135deg, #f5e6c8, #8b4513); }
    .theme-dot[data-t="black"]    { background: linear-gradient(135deg, #222, #000); }
    .theme-dot[data-t="military"] { background: linear-gradient(135deg, #4a5540, #c8b400); }
    .theme-dot[data-t="silver"]   { background: linear-gradient(135deg, #c0c0cc, #5a5a6a); }
    .theme-dot[data-t="cyber"]    { background: linear-gradient(135deg, #101025, #00e5ff); }
    .theme-dot[data-t="rose"]     { background: linear-gradient(135deg, #8a6070, #ffc8d0); }
    .theme-dot[data-t="maltese"]  { background: linear-gradient(135deg, #faf8f5, #DEB887); }
    .theme-dot[data-t="purple"]   { background: linear-gradient(135deg, #1e1040, #b388ff); }
    .theme-dot[data-t="hotpink"]  { background: linear-gradient(135deg, #3a1038, #ff69b4); }

    .theme-name {
      font-size: 10px;
      color: rgba(255,255,255,0.6);
      text-align: center;
      margin-bottom: 4px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-family: 'Outfit', sans-serif;
      transition: color 0.3s;
      text-shadow: 0 1px 4px rgba(0,0,0,0.5);
    }

    /* === RADIO BODY === */
    .radio {
      width: 100%;
      max-width: 480px;
      background: linear-gradient(145deg, var(--body-out1), var(--body-out2));
      border-radius: 24px;
      padding: 0;
      border: 2px solid var(--neon-border);
      box-shadow:
        0 30px 60px rgba(0,0,0,0.6),
        0 0 8px var(--neon-glow),
        0 0 20px var(--neon-glow),
        inset 0 0 8px var(--neon-glow),
        inset 0 1px 0 rgba(255,255,255,0.08);
      position: relative;
      transition: all 0.6s ease;
      overflow: hidden;
    }

    .radio-inner {
      background: linear-gradient(180deg, var(--body-in1), var(--body-in2));
      border-radius: 0;
      padding: 20px 20px 16px;
      position: relative;
      overflow: hidden;
      transition: all 0.6s ease;
    }
    .radio-inner::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(ellipse at 50% 0%, rgba(255,255,255,0.04) 0%, transparent 50%),
        radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.15) 100%);
      pointer-events: none; z-index: 0;
      border-radius: inherit;
    }

    .radio-inner::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(
        90deg, transparent, transparent 3px,
        var(--texture-color) 3px, var(--texture-color) 6px
      );
      pointer-events: none;
    }

    /* === BRAND & POWER === */
    .radio-top-row1 {
      display: flex; justify-content: center; align-items: center;
      margin-bottom: 6px; position: relative; z-index: 1;
    }
    .radio-top-row1 .power-btn {
      position: absolute; right: 0;
    }
    .radio-top-row2 {
      display: flex; justify-content: center; align-items: center;
      gap: 8px;
      margin-bottom: 12px; position: relative; z-index: 1;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .brand {
      font-family: 'Outfit', sans-serif; font-size: 22px; font-weight: 800;
      letter-spacing: 3px;
      text-shadow: 0 -1px 0 rgba(0,0,0,0.6), 0 1px 0 rgba(255,255,255,0.08), 0 2px 4px rgba(0,0,0,0.4);
      transition: color 0.6s;
    }
    .brand-clara { color: var(--needle, #ff6b6b); }
    .brand-cafe { color: var(--accent); }
    /* Brand Mascots - hidden by default */
    .brand-mascot {
      display: none;
      flex-shrink: 0;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      transition: all 0.4s ease;
    }
    img.brand-mascot {
      width: 34px; height: 34px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--neon-light);
      box-shadow: 0 0 6px var(--neon-light-glow);
      margin-left: 3px;
    }
    .ctrl-mascot {
      display: none;
      width: 48px; height: 48px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--neon-light);
      box-shadow: 0 0 6px var(--neon-light-glow);
      flex-shrink: 0;
      align-self: center;
    }

    .power-area { display: flex; align-items: center; gap: 10px; }
    .digital-to-analog-btn {
      background: var(--btn-bg); color: var(--accent); border: 1px solid var(--btn-border);
      padding: 5px 10px; border-radius: 12px;
      font-family: 'Orbitron', monospace; font-size: 7px; font-weight: 700;
      cursor: pointer; letter-spacing: 1px; transition: all 0.3s;
    }
    .digital-to-analog-btn:hover {
      background: var(--accent); color: var(--inner-bg);
    }
    .power-btn.on {
      border-color: #ff3333;
      box-shadow: 0 3px 6px rgba(0,0,0,0.4), 0 0 8px rgba(255,51,51,0.5), inset 0 1px 0 rgba(255,255,255,0.08);
      color: #ff3333;
    }
    .power-btn {
      width: 36px; height: 36px; border-radius: 50%;
      background: linear-gradient(145deg, var(--btn-hi1), var(--btn-hi2));
      border: 1px solid var(--neon-light); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--power-icon);
      box-shadow: 0 3px 6px rgba(0,0,0,0.4), 0 0 4px var(--neon-light-glow), inset 0 1px 0 rgba(255,255,255,0.08);
      transition: all 0.15s ease;
    }
    .power-btn:active {
      transform: scale(0.92);
      box-shadow: 0 1px 3px rgba(0,0,0,0.4), inset 0 1px 3px rgba(0,0,0,0.3);
    }

    /* === ANTENNA === */
    .antenna {
      position: absolute; top: -40px; right: 50px;
      width: 3px; height: 44px;
      background: linear-gradient(to top, var(--antenna1), var(--antenna2), var(--antenna1));
      border-radius: 2px; transform-origin: bottom center;
      transition: transform 0.5s ease, background 0.6s;
    }
    .antenna::after {
      content: ''; position: absolute; top: -4px; left: -2px;
      width: 7px; height: 7px;
      background: radial-gradient(circle, #ddd, #999);
      border-radius: 50%;
    }
    .antenna.active { transform: rotate(-15deg); }

    /* === SPEAKER GRILLE === */
    .speaker-grille {
      background: var(--speaker-bg); border-radius: 14px; padding: 16px;
      margin-bottom: 16px; border: 1px solid var(--neon-light);
      box-shadow: inset 0 4px 12px rgba(0,0,0,0.6), inset 0 -2px 6px rgba(0,0,0,0.3), 0 0 6px var(--neon-light-glow), 0 1px 0 rgba(255,255,255,0.04);
      position: relative; z-index: 1; overflow: hidden;
      transition: all 0.6s;
    }
    .speaker-label {
      position: absolute; top: 6px; left: 50%; transform: translateX(-50%);
      font-family: 'Orbitron', monospace; font-size: 6px; letter-spacing: 4px;
      color: var(--mesh-color); text-transform: uppercase; z-index: 2;
      opacity: 0.7; pointer-events: none;
    }
    .speaker-mesh {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.12) 2px, rgba(0,0,0,0.12) 3px),
        radial-gradient(circle, var(--mesh-color) 1px, transparent 1px);
      background-size: 100% 5px, 6px 6px;
      pointer-events: none;
    }
    .eq-container {
      display: flex; align-items: flex-end; justify-content: center;
      gap: 3px; height: 50px; position: relative; z-index: 1;
    }
    .eq-bar {
      width: 5px; height: 6px; background: var(--accent);
      border-radius: 2px; transition: height 0.15s ease, background 0.6s; opacity: 0.3;
    }
    .eq-bar.playing {
      opacity: 1; animation: eqBounce 0.6s ease-in-out infinite alternate;
      box-shadow: 0 0 6px var(--accent-glow);
    }
    @keyframes eqBounce { 0%{height:6px} 50%{height:40px} 100%{height:12px} }
    .eq-bar:nth-child(1).playing{animation-duration:.52s;animation-delay:0s}
    .eq-bar:nth-child(2).playing{animation-duration:.63s;animation-delay:.08s}
    .eq-bar:nth-child(3).playing{animation-duration:.48s;animation-delay:.03s}
    .eq-bar:nth-child(4).playing{animation-duration:.57s;animation-delay:.12s}
    .eq-bar:nth-child(5).playing{animation-duration:.65s;animation-delay:.05s}
    .eq-bar:nth-child(6).playing{animation-duration:.5s;animation-delay:.1s}
    .eq-bar:nth-child(7).playing{animation-duration:.6s;animation-delay:.02s}
    .eq-bar:nth-child(8).playing{animation-duration:.53s;animation-delay:.14s}
    .eq-bar:nth-child(9).playing{animation-duration:.62s;animation-delay:.07s}
    .eq-bar:nth-child(10).playing{animation-duration:.47s;animation-delay:.11s}
    .eq-bar:nth-child(11).playing{animation-duration:.58s;animation-delay:.04s}
    .eq-bar:nth-child(12).playing{animation-duration:.55s;animation-delay:.09s}
    .eq-bar:nth-child(13).playing{animation-duration:.61s;animation-delay:.01s}
    .eq-bar:nth-child(14).playing{animation-duration:.49s;animation-delay:.13s}
    .eq-bar:nth-child(15).playing{animation-duration:.56s;animation-delay:.06s}
    .eq-bar:nth-child(16).playing{animation-duration:.64s;animation-delay:.08s}

    /* === LCD DISPLAY === */
    .lcd-display {
      background: var(--lcd-bg); border-radius: 10px; padding: 14px 18px;
      margin-bottom: 16px;
      border: 1px solid var(--neon-light);
      box-shadow: inset 0 3px 10px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.4), 0 0 6px var(--neon-light-glow), 0 1px 0 rgba(255,255,255,0.06);
      position: relative; z-index: 1; min-height: 90px;
      display: flex; flex-direction: column; justify-content: center;
      transition: all 0.6s;
    }
    .lcd-display::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, transparent 30%, transparent 80%, rgba(0,0,0,0.1) 100%);
      pointer-events: none; border-radius: 7px; z-index: 2;
    }
    .lcd-display::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 1px, rgba(0,0,0,0.08) 1px, rgba(0,0,0,0.08) 2px);
      pointer-events: none; border-radius: 7px;
    }
    .on-air-dot {
      display: inline-block; width: 6px; height: 6px; border-radius: 50%;
      background: #ff3333; margin-right: 6px; vertical-align: middle;
      animation: onAirPulse 1s ease-in-out infinite;
      box-shadow: 0 0 4px #ff3333, 0 0 8px rgba(255,51,51,0.4);
    }
    @keyframes onAirPulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .lcd-idle {
      text-align: center; color: var(--lcd-idle);
      font-family: 'Orbitron', monospace; font-size: 14px;
      letter-spacing: 2px; position: relative; z-index: 1;
      transition: color 0.6s;
      text-shadow: 0 0 8px var(--lcd-glow);
    }
    .lcd-active { position: relative; z-index: 1; display: none; }
    .lcd-active.visible { display: block; }
    .lcd-idle.hidden { display: none; }
    .lcd-provider {
      font-family: 'Orbitron', monospace; font-size: 9px;
      color: var(--lcd-dim); letter-spacing: 3px;
      text-transform: uppercase; margin-bottom: 4px; transition: color 0.6s;
    }
    .lcd-name {
      font-family: 'Orbitron', monospace; font-size: 16px; font-weight: 700;
      color: var(--lcd-text); text-shadow: 0 0 10px var(--lcd-glow);
      margin-bottom: 2px; white-space: nowrap; overflow: hidden; transition: color 0.6s;
    }
    .lcd-freq {
      font-family: 'Orbitron', monospace; font-size: 26px; font-weight: 900;
      color: var(--lcd-text); text-shadow: 0 0 15px var(--lcd-glow);
      letter-spacing: 2px; transition: color 0.6s;
    }
    .lcd-status {
      font-family: 'Orbitron', monospace; font-size: 8px;
      color: var(--lcd-dim); letter-spacing: 2px; margin-top: 4px;
      display: flex; justify-content: space-between; align-items: center;
      transition: color 0.6s;
    }
    .lcd-signal { display: flex; gap: 2px; align-items: flex-end; }
    .lcd-signal-bar {
      width: 3px; background: var(--lcd-dim);
      border-radius: 1px; transition: all 0.5s ease;
    }
    .lcd-signal-bar.active { background: var(--lcd-text); }

    /* === TUNING DIAL === */
    .tuning-section {
      background: linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));
      border-radius: 10px; padding: 12px 16px; margin-bottom: 16px;
      border: 1px solid var(--neon-light);
      box-shadow: 0 0 6px var(--neon-light-glow);
      position: relative; z-index: 1;
    }
    .tuning-label {
      font-size: 8px; color: var(--label-color); letter-spacing: 3px;
      text-transform: uppercase; margin-bottom: 8px; font-weight: 600;
      transition: color 0.6s;
    }
    .freq-band {
      position: relative; height: 28px; background: var(--speaker-bg);
      border-radius: 4px; overflow: hidden;
      border: 1px solid var(--speaker-border);
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.5);
      transition: all 0.6s;
    }
    .freq-band::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 40%;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), transparent);
      pointer-events: none; z-index: 1;
    }
    .freq-ticks {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
    }
    .freq-tick {
      position: absolute; bottom: 0; width: 1px; background: var(--tick-color); opacity: 0.4;
    }
    .freq-tick.major { height: 10px; opacity: 0.7; }
    .freq-tick.minor { height: 5px; }
    .freq-marks {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      display: flex; justify-content: space-between; align-items: center; padding: 0 8px;
    }
    .freq-mark {
      font-family: 'Orbitron', monospace; font-size: 7px;
      color: var(--freq-mark); position: relative; transition: color 0.6s;
    }
    .freq-mark::before {
      content: ''; position: absolute; top: -8px; left: 50%;
      width: 1px; height: 5px; background: var(--tick-color);
    }
    .tuning-needle {
      position: absolute; top: 2px; width: 2px; height: 24px;
      background: var(--needle); box-shadow: 0 0 6px var(--needle-glow), 0 0 12px var(--needle-glow);
      border-radius: 1px; left: 20%;
      transition: left 0.6s cubic-bezier(0.34,1.56,0.64,1), background 0.6s;
      z-index: 2;
    }
    .tuning-needle::after {
      content: ''; position: absolute; top: -2px; left: -2px;
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--needle); box-shadow: 0 0 4px var(--needle-glow);
    }

    /* === PRESET BUTTONS === */
    .preset-section { margin-bottom: 16px; position: relative; z-index: 1; }
    .preset-label {
      font-size: 8px; color: var(--label-color); letter-spacing: 3px;
      text-transform: uppercase; margin-bottom: 8px; font-weight: 600;
      transition: color 0.6s;
    }
    .preset-scroll {
      overflow-y: auto; overflow-x: hidden;
      max-height: 200px;
      scrollbar-width: thin;
      scrollbar-color: var(--btn-border) transparent;
      padding-right: 2px;
    }
    .preset-scroll::-webkit-scrollbar { width: 3px; }
    .preset-scroll::-webkit-scrollbar-track { background: transparent; }
    .preset-scroll::-webkit-scrollbar-thumb { background: var(--btn-border); border-radius: 2px; }
    .preset-buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-auto-rows: 1fr;
      gap: 3px;
    }
    .preset-btn {
      background: linear-gradient(180deg, var(--btn-bg1), var(--btn-bg2));
      border: 2.5px solid var(--neon-light); border-radius: 6px;
      padding: 4px 4px 3px; cursor: pointer; text-align: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.3), 0 0 4px var(--neon-light-glow), inset 0 1px 0 rgba(255,255,255,0.06);
      transition: all 0.15s ease;
    }
    .preset-btn:active {
      transform: translateY(2px);
      box-shadow: 0 1px 2px rgba(0,0,0,0.3), inset 0 1px 3px rgba(0,0,0,0.3);
    }
    .preset-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.08);
    }
    .preset-btn.active {
      background: linear-gradient(180deg, var(--btn-active1), var(--btn-active2));
      border-color: var(--accent);
      box-shadow: 0 3px 8px rgba(0,0,0,0.3), 0 0 12px var(--accent-glow), inset 0 1px 0 rgba(255,255,255,0.1);
      animation: presetPulse 2s ease-in-out infinite;
    }
    @keyframes presetPulse {
      0%,100%{box-shadow: 0 3px 8px rgba(0,0,0,0.3), 0 0 12px var(--accent-glow), inset 0 1px 0 rgba(255,255,255,0.1);}
      50%{box-shadow: 0 3px 8px rgba(0,0,0,0.3), 0 0 20px var(--accent-glow), inset 0 1px 0 rgba(255,255,255,0.1);}
    }
    .preset-btn.active .preset-num { color: var(--accent); }
    .preset-btn.active .preset-name { color: var(--accent); }
    .preset-btn.preset-special {
      border-color: rgba(255, 180, 50, 0.7);
      box-shadow: 0 3px 6px rgba(0,0,0,0.3), 0 0 8px rgba(255,180,50,0.25), inset 0 1px 0 rgba(255,255,255,0.08);
    }
    .preset-btn.preset-foreign {
      border-color: rgba(80, 180, 255, 0.5);
      box-shadow: 0 3px 6px rgba(0,0,0,0.3), 0 0 4px rgba(80,180,255,0.15), inset 0 1px 0 rgba(255,255,255,0.06);
    }
    .preset-btn.preset-empty { opacity: 0.35; cursor: default; border-style: dashed; }
    .preset-btn.preset-empty:hover { transform: none; box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.06); }
    .preset-btn.preset-empty:active { transform: none; }
    .preset-num {
      font-family: 'Orbitron', monospace; font-size: 9px; font-weight: 700;
      color: var(--preset-num); display: block; line-height: 1.1; transition: color 0.3s;
    }
    .preset-name {
      font-size: 7px; font-weight: 600; color: var(--preset-name);
      letter-spacing: 0.3px; white-space: nowrap; overflow: hidden;
      text-overflow: ellipsis; line-height: 1.1; transition: color 0.6s;
    }
    .preset-tarot-cards { font-size: 14px; letter-spacing: -2px; }
    .preset-lucky7 { font-family: 'Orbitron', monospace; font-size: 16px; font-weight: 900; color: var(--accent); }

    /* === ANNIVERSARY SECTION === */
    .anniversary-section {
      margin-bottom: 10px; position: relative; z-index: 1;
      margin-top: 16px; padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.08);
    }
    .anniversary-label {
      font-family: 'Orbitron', monospace; font-size: 8px; font-weight: 600;
      color: var(--label-color); letter-spacing: 3px; margin-bottom: 6px;
      transition: color 0.6s;
    }
    .anniversary-panel {
      background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.15));
      border: 1px solid var(--neon-light); border-radius: 10px;
      padding: 10px 12px;
      box-shadow: 0 0 6px var(--neon-light-glow), inset 0 2px 6px rgba(0,0,0,0.3);
    }
    .anniversary-list { display: flex; flex-direction: column; gap: 4px; }
    .anniversary-item {
      display: flex; align-items: center; gap: 6px;
      padding: 4px 6px; border-radius: 6px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.05);
    }
    .anniversary-item .anniv-name {
      font-family: 'Inter', sans-serif; font-size: 10px; font-weight: 600;
      color: var(--lcd-text, #e0e0e0); flex: 1; min-width: 0;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .anniversary-item .anniv-date {
      font-family: 'Orbitron', monospace; font-size: 8px;
      color: var(--preset-name, #999); opacity: 0.7; flex-shrink: 0;
    }
    .anniversary-item .anniv-dday {
      font-family: 'Orbitron', monospace; font-size: 10px; font-weight: 700;
      flex-shrink: 0; min-width: 48px; text-align: right;
    }
    .anniv-dday.future { color: var(--accent); }
    .anniv-dday.today { color: var(--needle, #ff6b6b); text-shadow: 0 0 6px var(--needle-glow, rgba(255,100,100,0.5)); }
    .anniv-dday.past { color: var(--preset-name, #999); opacity: 0.5; }
    .anniversary-item .anniv-del {
      background: none; border: none; color: var(--preset-name, #999);
      font-size: 12px; cursor: pointer; padding: 0 2px; opacity: 0.5;
      transition: opacity 0.2s;
    }
    .anniversary-item .anniv-del:hover { opacity: 1; color: var(--needle, #ff6b6b); }
    .anniversary-item.bday-anniv { flex-wrap: wrap; }
    .anniversary-item.bday-anniv .anniv-name { flex: none; }
    .anniversary-item.bday-anniv .anniv-bday-date { font-family: 'Inter', sans-serif; font-size: 9px; color: var(--lcd-text, #e0e0e0); white-space: nowrap; }
    .anniversary-item.bday-anniv .anniv-bday-sep { color: rgba(255,255,255,0.15); font-size: 9px; }
    .anniversary-item.bday-anniv .anniv-dday { min-width: auto; font-size: 9px; }
    .anniversary-item.bday-anniv .anniv-bday-lived { font-family: 'Inter', sans-serif; font-size: 9px; color: var(--lcd-text, #e0e0e0); white-space: nowrap; margin-left: auto; }
    .anniversary-add-row {
      display: flex; gap: 3px; margin-top: 5px; align-items: center;
    }
    .anniversary-add-row input[type="text"] {
      width: 58px; min-width: 0; flex-shrink: 1; padding: 3px 4px; font-size: 9px;
      font-family: 'Inter', sans-serif;
      background: rgba(0,0,0,0.3); border: 1px solid var(--neon-light);
      border-radius: 3px; color: var(--lcd-text, #e0e0e0); outline: none;
    }
    .anniv-type-select {
      padding: 3px 1px; font-size: 8px; font-family: 'Inter', sans-serif;
      background: rgba(0,0,0,0.3); border: 1px solid var(--neon-light);
      border-radius: 3px; color: var(--lcd-text, #e0e0e0); outline: none;
      cursor: pointer; flex-shrink: 0;
    }
    .anniv-date-field {
      width: 28px; padding: 3px 1px; font-size: 8px; text-align: center;
      font-family: 'Orbitron', monospace;
      background: rgba(0,0,0,0.3); border: 1px solid var(--neon-light);
      border-radius: 3px; color: var(--lcd-text, #e0e0e0); outline: none;
    }
    .anniv-date-field::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .anniv-date-field::placeholder { color: rgba(255,255,255,0.3); font-size: 8px; }
    .anniversary-add-row button {
      background: linear-gradient(180deg, var(--btn-bg1), var(--btn-bg2));
      border: 1px solid var(--neon-light); border-radius: 3px;
      color: var(--accent); font-size: 12px; font-weight: 700;
      width: 22px; height: 22px; cursor: pointer; padding: 0;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .anniversary-add-row button:active { transform: scale(0.95); }
    .anniv-cal-select, .dash-cal-select {
      padding: 3px 2px; font-size: 9px; font-family: 'Inter', sans-serif;
      background: rgba(0,0,0,0.3); border: 1px solid var(--neon-light);
      border-radius: 4px; color: var(--lcd-text, #e0e0e0); outline: none;
      cursor: pointer; flex-shrink: 0;
    }
    .dash-cal-select { padding: 5px 4px; font-size: 11px; border-radius: 6px; }
    .anniv-cal-tag {
      font-size: 7px; padding: 1px 3px; border-radius: 2px;
      background: rgba(255,255,255,0.1); color: var(--accent, #d4af69);
      margin-left: 2px; vertical-align: middle; font-family: 'Inter', sans-serif;
    }
    .anniv-type-icon { font-size: 10px; margin-right: 2px; flex-shrink: 0; }
    .anniversary-empty {
      font-size: 9px; color: var(--preset-name, #999); opacity: 0.5;
      text-align: center; padding: 4px 0;
      font-family: 'Inter', sans-serif;
    }
    .anniversary-add-row.hidden { display: none; }

    /* Anniversary User Row */
    .anniv-user-row {
      display: flex; gap: 6px; align-items: center; margin-bottom: 8px;
    }
    .anniv-user-row .anniv-user-name {
      font-family: 'Inter', sans-serif; font-size: 11px; font-weight: 700;
      color: var(--accent); flex: 1;
    }
    .anniv-user-row button {
      background: linear-gradient(180deg, var(--btn-bg1), var(--btn-bg2));
      border: 1px solid var(--neon-light); border-radius: 4px;
      font-size: 8px; font-weight: 700; padding: 3px 7px; cursor: pointer;
      font-family: 'Orbitron', monospace; white-space: nowrap;
    }
    .anniv-user-row button:active { transform: scale(0.95); }
    .anniv-user-row .anniv-dash-btn { color: var(--needle, #ff6b6b); }
    .anniv-user-row.hidden { display: none; }

    /* Birthday Info */
    .anniv-birthday-info {
      display: none; margin-bottom: 6px; padding: 6px 8px;
      background: rgba(0,0,0,0.2); border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.05);
      align-items: center; gap: 6px;
    }
    .anniv-birthday-info.visible { display: flex; }
    .anniv-bday-icon { font-size: 12px; flex-shrink: 0; }
    .anniv-bday-date {
      font-size: 10px; color: var(--lcd-text, #e0e0e0);
      font-family: 'Inter', sans-serif; white-space: nowrap;
    }
    .anniv-bday-sep { color: rgba(255,255,255,0.15); font-size: 10px; }
    .anniv-bday-dday {
      font-size: 11px; font-weight: 700; color: var(--accent, #d4af69);
      font-family: 'Orbitron', monospace; white-space: nowrap;
    }
    .anniv-bday-dday.today { color: var(--needle, #ff6b6b); text-shadow: 0 0 8px var(--needle, #ff6b6b); }
    .anniv-bday-lived {
      font-family: 'Inter', sans-serif; font-size: 10px;
      color: var(--lcd-text, #e0e0e0); white-space: nowrap; margin-left: auto;
    }

    /* Dashboard Modal */
    .dashboard-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); z-index: 9999;
      justify-content: center; align-items: center;
    }
    .dashboard-overlay.visible { display: flex; }
    .dashboard-modal {
      background: linear-gradient(160deg, var(--body-from, #2a2218), var(--body-to, #1a150e));
      border: 2px solid var(--accent); border-radius: 16px;
      padding: 20px; width: 90%; max-width: 360px; max-height: 80vh;
      overflow-y: auto; position: relative;
      box-shadow: 0 0 30px rgba(0,0,0,0.6), 0 0 15px var(--accent-glow);
    }
    .dashboard-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 16px; padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .dashboard-title {
      font-family: 'Orbitron', monospace; font-size: 14px; font-weight: 700;
      color: var(--accent); letter-spacing: 2px;
    }
    .dashboard-close {
      background: none; border: none; color: var(--preset-name, #999);
      font-size: 20px; cursor: pointer; padding: 0 4px;
    }
    .dashboard-close:hover { color: var(--needle, #ff6b6b); }
    .dashboard-user-info {
      margin-bottom: 16px; padding: 10px 12px; border-radius: 8px;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
    }
    .dashboard-user-name {
      font-family: 'Outfit', sans-serif; font-size: 16px; font-weight: 700;
      color: var(--lcd-text, #e0e0e0); margin-bottom: 2px;
    }
    .dashboard-user-email {
      font-family: 'Inter', sans-serif; font-size: 10px;
      color: var(--preset-name, #999); opacity: 0.7;
    }
    .dashboard-section-title {
      font-family: 'Orbitron', monospace; font-size: 9px; font-weight: 600;
      color: var(--label-color); letter-spacing: 2px; margin-bottom: 8px;
    }
    .dashboard-anniv-list { display: flex; flex-direction: column; gap: 6px; }
    .dashboard-anniv-item {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 10px; border-radius: 8px;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
    }
    .dashboard-anniv-item.nearest {
      border-color: var(--accent);
      box-shadow: 0 0 8px var(--accent-glow);
    }
    .dashboard-anniv-item .dash-name {
      font-family: 'Inter', sans-serif; font-size: 12px; font-weight: 600;
      color: var(--lcd-text, #e0e0e0); flex: 1;
    }
    .dashboard-anniv-item .dash-date {
      font-family: 'Orbitron', monospace; font-size: 9px;
      color: var(--preset-name, #999); opacity: 0.7;
    }
    .dashboard-anniv-item .dash-dday {
      font-family: 'Orbitron', monospace; font-size: 12px; font-weight: 700;
      min-width: 56px; text-align: right;
    }
    .dashboard-empty {
      font-size: 11px; color: var(--preset-name, #999); opacity: 0.6;
      text-align: center; padding: 16px 0; font-family: 'Inter', sans-serif;
    }
    .dashboard-anniv-item .dash-del {
      background: none; border: none; color: var(--preset-name, #999);
      font-size: 14px; cursor: pointer; padding: 0 2px; opacity: 0.4;
      transition: opacity 0.2s; flex-shrink: 0;
    }
    .dashboard-anniv-item .dash-del:hover { opacity: 1; color: var(--needle, #ff6b6b); }
    .dashboard-anniv-item.bday-anniv { flex-wrap: wrap; }
    .dashboard-anniv-item.bday-anniv .dash-name { flex: none; }
    .dashboard-anniv-item.bday-anniv .anniv-bday-date { font-family: 'Inter', sans-serif; font-size: 10px; color: var(--lcd-text, #e0e0e0); white-space: nowrap; }
    .dashboard-anniv-item.bday-anniv .anniv-bday-sep { color: rgba(255,255,255,0.15); font-size: 10px; }
    .dashboard-anniv-item.bday-anniv .dash-dday { min-width: auto; font-size: 10px; text-align: left; }
    .dashboard-anniv-item.bday-anniv .anniv-bday-lived { font-family: 'Inter', sans-serif; font-size: 10px; color: var(--lcd-text, #e0e0e0); white-space: nowrap; margin-left: auto; }
    .dashboard-add-row {
      display: flex; gap: 4px; margin-top: 10px; padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,0.06); align-items: center;
    }
    .dashboard-add-row input[type="text"] {
      width: 70px; min-width: 0; flex-shrink: 1; padding: 5px 6px; font-size: 11px;
      font-family: 'Inter', sans-serif;
      background: rgba(0,0,0,0.3); border: 1px solid var(--neon-light);
      border-radius: 4px; color: var(--lcd-text, #e0e0e0); outline: none;
    }
    .dash-type-select {
      padding: 5px 2px; font-size: 10px; font-family: 'Inter', sans-serif;
      background: rgba(0,0,0,0.3); border: 1px solid var(--neon-light);
      border-radius: 4px; color: var(--lcd-text, #e0e0e0); outline: none;
      cursor: pointer; flex-shrink: 0;
    }
    .dash-date-field {
      width: 34px; padding: 5px 2px; font-size: 10px; text-align: center;
      font-family: 'Orbitron', monospace;
      background: rgba(0,0,0,0.3); border: 1px solid var(--neon-light);
      border-radius: 4px; color: var(--lcd-text, #e0e0e0); outline: none;
    }
    .dash-date-field::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .dash-date-field::placeholder { color: rgba(255,255,255,0.3); font-size: 10px; }
    .dashboard-add-row button {
      background: linear-gradient(180deg, var(--btn-bg1), var(--btn-bg2));
      border: 1px solid var(--neon-light); border-radius: 6px;
      color: var(--accent); font-size: 18px; font-weight: 700;
      width: 34px; height: 34px; cursor: pointer; padding: 0;
      display: flex; align-items: center; justify-content: center;
    }
    .dashboard-add-row button:active { transform: scale(0.95); }
    .dashboard-add-row.hidden { display: none; }

    /* === Fortune Modal === */
    .fortune-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.75); z-index: 9999;
      justify-content: center; align-items: center;
    }
    .fortune-overlay.visible { display: flex; }
    .fortune-modal {
      background: linear-gradient(160deg, var(--body-from, #2a2218), var(--body-to, #1a150e));
      border: 2px solid var(--accent); border-radius: 18px;
      padding: 22px 18px; width: 92%; max-width: 370px; max-height: 85vh;
      overflow-y: auto; position: relative;
      box-shadow: 0 0 40px rgba(0,0,0,0.6), 0 0 20px var(--accent-glow);
    }
    .fortune-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 14px; padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .fortune-title {
      font-family: 'Orbitron', monospace; font-size: 13px; font-weight: 700;
      color: var(--accent); letter-spacing: 2px;
    }
    .fortune-close {
      background: none; border: none; color: var(--preset-name, #999);
      font-size: 22px; cursor: pointer; padding: 0 4px;
    }
    .fortune-close:hover { color: var(--needle, #ff6b6b); }
    .fortune-date {
      text-align: center; font-family: 'Inter', sans-serif; font-size: 11px;
      color: var(--preset-name, #999); margin-bottom: 14px; opacity: 0.8;
    }
    .fortune-zodiac-box {
      display: flex; align-items: center; justify-content: center; gap: 16px;
      padding: 14px; margin-bottom: 14px; border-radius: 12px;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
    }
    .fortune-zodiac-item {
      display: flex; flex-direction: column; align-items: center; gap: 4px;
    }
    .fortune-zodiac-emoji { font-size: 28px; }
    .fortune-zodiac-name {
      font-family: 'Outfit', sans-serif; font-size: 12px; font-weight: 600;
      color: var(--lcd-text, #e0e0e0);
    }
    .fortune-zodiac-sub {
      font-family: 'Inter', sans-serif; font-size: 9px;
      color: var(--preset-name, #999); opacity: 0.7;
    }
    .fortune-score-wrap {
      text-align: center; margin-bottom: 16px;
    }
    .fortune-score-bar {
      width: 100%; height: 8px; border-radius: 4px;
      background: rgba(255,255,255,0.08); overflow: hidden; margin-top: 6px;
    }
    .fortune-score-fill {
      height: 100%; border-radius: 4px;
      background: linear-gradient(90deg, var(--accent), var(--needle, #ff6b6b));
      transition: width 0.8s ease;
    }
    .fortune-score-label {
      font-family: 'Orbitron', monospace; font-size: 10px; font-weight: 600;
      color: var(--accent); letter-spacing: 1px;
    }
    .fortune-score-num {
      font-family: 'Orbitron', monospace; font-size: 22px; font-weight: 700;
      color: var(--lcd-text, #e0e0e0); margin: 4px 0;
    }
    .fortune-categories {
      display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px;
    }
    .fortune-cat-card {
      padding: 12px; border-radius: 10px;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
    }
    .fortune-cat-header {
      display: flex; align-items: center; gap: 6px; margin-bottom: 6px;
    }
    .fortune-cat-icon { font-size: 14px; }
    .fortune-cat-title {
      font-family: 'Outfit', sans-serif; font-size: 11px; font-weight: 700;
      color: var(--accent); letter-spacing: 1px;
    }
    .fortune-cat-text {
      font-family: 'Inter', sans-serif; font-size: 12px; line-height: 1.6;
      color: var(--lcd-text, #e0e0e0); opacity: 0.9;
    }
    .fortune-lucky-row {
      display: flex; gap: 8px;
    }
    .fortune-lucky-card {
      flex: 1; padding: 10px; border-radius: 10px; text-align: center;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
    }
    .fortune-lucky-label {
      font-family: 'Outfit', sans-serif; font-size: 9px; font-weight: 600;
      color: var(--preset-name, #999); letter-spacing: 1px; margin-bottom: 4px;
    }
    .fortune-lucky-value {
      font-family: 'Orbitron', monospace; font-size: 16px; font-weight: 700;
      color: var(--lcd-text, #e0e0e0);
    }
    .fortune-lucky-color-dot {
      display: inline-block; width: 14px; height: 14px; border-radius: 50%;
      vertical-align: middle; margin-right: 4px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .fortune-login-msg {
      text-align: center; padding: 30px 10px;
      font-family: 'Inter', sans-serif; font-size: 13px;
      color: var(--preset-name, #999); line-height: 1.8;
    }

    /* === Tarot Modal === */
    .tarot-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 9999;
      justify-content: center; align-items: center;
    }
    .tarot-overlay.visible { display: flex; }
    .tarot-modal {
      background: linear-gradient(160deg, #1a1028, #0e0a18);
      border: 2px solid #9b59b6; border-radius: 18px;
      padding: 22px 18px; width: 92%; max-width: 370px; max-height: 85vh;
      overflow-y: auto; position: relative;
      box-shadow: 0 0 40px rgba(155,89,182,0.3), 0 0 20px rgba(155,89,182,0.15);
    }
    .tarot-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 14px; padding-bottom: 10px;
      border-bottom: 1px solid rgba(155,89,182,0.2);
    }
    .tarot-title {
      font-family: 'Orbitron', monospace; font-size: 13px; font-weight: 700;
      color: #9b59b6; letter-spacing: 2px;
    }
    .tarot-close {
      background: none; border: none; color: #777;
      font-size: 22px; cursor: pointer; padding: 0 4px;
    }
    .tarot-close:hover { color: #e74c3c; }
    .tarot-date {
      text-align: center; font-family: 'Inter', sans-serif; font-size: 11px;
      color: #888; margin-bottom: 16px;
    }
    .tarot-spread { display: flex; gap: 10px; justify-content: center; margin-bottom: 18px; }
    .tarot-card-slot { flex: 1; max-width: 100px; text-align: center; }
    .tarot-card {
      width: 100%; aspect-ratio: 2/3; border-radius: 10px;
      background: linear-gradient(145deg, #2d1f4e, #1a1030);
      border: 2px solid #9b59b6;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 8px 4px; margin-bottom: 6px;
      box-shadow: 0 4px 15px rgba(155,89,182,0.25);
    }
    .tarot-card-num {
      font-family: 'Orbitron', monospace; font-size: 9px; font-weight: 600;
      color: rgba(155,89,182,0.6); margin-bottom: 4px;
    }
    .tarot-card-symbol { font-size: 28px; margin-bottom: 4px; }
    .tarot-card-name {
      font-family: 'Outfit', sans-serif; font-size: 9px; font-weight: 600;
      color: #d4b6e8; text-align: center; line-height: 1.2;
    }
    .tarot-card-position {
      font-family: 'Orbitron', monospace; font-size: 8px; font-weight: 600;
      color: #9b59b6; letter-spacing: 1px;
    }
    .tarot-readings { display: flex; flex-direction: column; gap: 10px; }
    .tarot-reading-card {
      padding: 12px; border-radius: 10px;
      background: rgba(155,89,182,0.06); border: 1px solid rgba(155,89,182,0.12);
    }
    .tarot-reading-header { display: flex; align-items: center; gap: 6px; margin-bottom: 6px; }
    .tarot-reading-pos {
      font-family: 'Orbitron', monospace; font-size: 9px; font-weight: 600;
      color: #9b59b6; letter-spacing: 1px;
    }
    .tarot-reading-name {
      font-family: 'Outfit', sans-serif; font-size: 11px; font-weight: 700; color: #d4b6e8;
    }
    .tarot-reading-text {
      font-family: 'Inter', sans-serif; font-size: 12px; line-height: 1.6; color: #ccc; opacity: 0.9;
    }
    .tarot-login-msg {
      text-align: center; padding: 30px 10px;
      font-family: 'Inter', sans-serif; font-size: 13px; color: #888; line-height: 1.8;
    }

    /* === CONTROL PANEL === */
    .control-panel {
      display: flex; align-items: center; justify-content: space-between;
      gap: 16px; position: relative; z-index: 1;
    }
    .knob-area { display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .knob-label {
      font-size: 7px; color: var(--preset-num); letter-spacing: 2px;
      text-transform: uppercase; font-weight: 600; transition: color 0.6s;
    }
    .knob-container { position: relative; width: 56px; height: 56px; }
    .knob-marks { position: absolute; top: 0; left: 0; right: 0; bottom: 0; }
    .knob-tick {
      position: absolute; width: 1px; height: 5px;
      background: var(--tick-color); top: 2px; left: 50%;
      transform-origin: 0 26px; transition: background 0.6s;
    }
    .knob {
      width: 48px; height: 48px; border-radius: 50%;
      background:
        repeating-conic-gradient(from 0deg, rgba(255,255,255,0.03) 0deg 6deg, transparent 6deg 12deg),
        linear-gradient(145deg, var(--btn-hi1), var(--btn-hi2));
      border: 1px solid var(--neon-light);
      box-shadow: 0 4px 8px rgba(0,0,0,0.4), 0 0 4px var(--neon-light-glow), inset 0 2px 0 rgba(255,255,255,0.06), inset 0 -2px 4px rgba(0,0,0,0.3);
      position: absolute; top: 4px; left: 4px;
      cursor: pointer; transition: transform 0.1s ease;
    }
    .knob-indicator {
      position: absolute; top: 6px; left: 50%; transform: translateX(-50%);
      width: 2px; height: 10px; background: var(--knob-ind);
      border-radius: 1px; transition: background 0.6s;
    }

    /* Play Button */
    .play-btn-container { display: flex; flex-direction: column; align-items: center; gap: 6px; }
    .play-btn {
      width: 64px; height: 64px; border-radius: 50%;
      background: linear-gradient(145deg, var(--btn-active1), var(--btn-bg2));
      border: 2px solid var(--neon-light);
      box-shadow: 0 6px 12px rgba(0,0,0,0.5), 0 0 8px var(--neon-light-glow), inset 0 2px 0 rgba(255,255,255,0.08), inset 0 -2px 4px rgba(0,0,0,0.3);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      color: var(--accent); transition: all 0.15s ease;
    }
    .play-btn:active {
      transform: scale(0.93);
      box-shadow: 0 2px 6px rgba(0,0,0,0.5), inset 0 2px 4px rgba(0,0,0,0.3);
    }
    .play-btn.playing {
      box-shadow: 0 6px 12px rgba(0,0,0,0.5), 0 0 20px var(--accent-glow), inset 0 2px 0 rgba(255,255,255,0.08);
    }
    .play-btn svg { fill: var(--accent); transition: fill 0.6s; }

    @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
    .spin { animation: spin 1s linear infinite; }

    /* === EQ PANEL === */
    .eq-toggle-btn {
      width: 48px; height: 48px; border-radius: 50%;
      background: linear-gradient(145deg, var(--btn-hi1), var(--btn-hi2));
      border: 1px solid var(--neon-light); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--accent); font-family: 'Orbitron', monospace; font-size: 8px; font-weight: 700;
      letter-spacing: 1px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.4), 0 0 4px var(--neon-light-glow);
      transition: all 0.2s ease;
    }
    .eq-toggle-btn:active { transform: scale(0.92); }
    .eq-toggle-btn.active {
      background: linear-gradient(145deg, var(--btn-active1), var(--btn-active2));
      box-shadow: 0 3px 6px rgba(0,0,0,0.4), 0 0 8px var(--accent-glow);
    }

    .eq-panel {
      background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.15));
      border: 1px solid var(--neon-light);
      border-radius: 12px; padding: 14px 16px; margin-bottom: 12px;
      position: relative; z-index: 1;
      box-shadow: 0 0 6px var(--neon-light-glow), inset 0 2px 6px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }
    .eq-panel-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 12px;
    }
    .eq-panel-title {
      font-family: 'Orbitron', monospace; font-size: 8px; font-weight: 700;
      color: var(--label-color); letter-spacing: 3px; text-transform: uppercase;
    }
    .eq-reset-btn {
      font-family: 'Orbitron', monospace; font-size: 7px; font-weight: 600;
      color: var(--accent); background: transparent;
      border: 1px solid var(--neon-light); border-radius: 4px;
      padding: 3px 8px; cursor: pointer; letter-spacing: 1px;
      transition: all 0.2s;
    }
    .eq-reset-btn:hover { background: rgba(255,255,255,0.05); }

    /* EQ Vertical Sliders */
    .eq-sliders {
      display: flex; justify-content: space-around; align-items: flex-end;
      gap: 4px; margin-bottom: 14px; padding: 0 8px;
    }
    .eq-slider-group {
      display: flex; flex-direction: column; align-items: center; gap: 6px;
    }
    .eq-slider-wrap {
      width: 28px; height: 100px; position: relative;
      display: flex; align-items: center; justify-content: center;
    }
    .eq-slider-wrap input[type="range"] {
      -webkit-appearance: none; appearance: none;
      width: 90px; height: 4px;
      background: linear-gradient(90deg, var(--neon-light-glow), var(--accent), var(--neon-light-glow));
      border-radius: 2px; outline: none;
      transform: rotate(-90deg);
      transform-origin: center center;
    }
    .eq-slider-wrap input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 16px; height: 16px;
      background: var(--accent); border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 6px var(--accent-glow), 0 2px 4px rgba(0,0,0,0.4);
    }
    .eq-freq-label {
      font-family: 'Orbitron', monospace; font-size: 7px;
      color: var(--freq-mark); letter-spacing: 0.5px;
    }
    .eq-db-label {
      font-family: 'Orbitron', monospace; font-size: 7px;
      color: var(--lcd-dim); min-width: 30px; text-align: center;
    }

    /* Horizontal Controls (Woofer, Virtualizer) */
    .eq-extra-controls {
      display: flex; flex-direction: column; gap: 10px;
    }
    .eq-control-row {
      display: flex; align-items: center; gap: 10px;
    }
    .eq-control-label {
      font-family: 'Orbitron', monospace; font-size: 7px; font-weight: 600;
      color: var(--label-color); letter-spacing: 2px;
      min-width: 72px; text-transform: uppercase;
    }
    .eq-h-slider {
      -webkit-appearance: none; appearance: none;
      flex: 1; height: 4px;
      background: linear-gradient(90deg, var(--speaker-border), var(--accent));
      border-radius: 2px; outline: none;
    }
    .eq-h-slider::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 14px; height: 14px;
      background: var(--accent); border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 6px var(--accent-glow), 0 2px 4px rgba(0,0,0,0.4);
    }
    .eq-h-value {
      font-family: 'Orbitron', monospace; font-size: 8px;
      color: var(--lcd-text); min-width: 28px; text-align: right;
      text-shadow: 0 0 4px var(--lcd-glow);
    }

    /* === PHOTO UPLOAD (in-radio) === */
    .photo-upload-btn {
      display: none;
      width: 30px; height: 30px;
      border-radius: 50%;
      background: var(--accent-muted);
      border: 2px dashed var(--neon-light);
      color: var(--text-dim);
      font-size: 18px; line-height: 1;
      cursor: pointer;
      flex-shrink: 0;
      align-self: center;
      margin-left: 3px;
      transition: all 0.3s ease;
    }
    .photo-upload-btn:hover {
      background: var(--neon-light);
      color: var(--player-bg);
      box-shadow: 0 0 8px var(--neon-light-glow);
    }
    .photo-upload-btn.has-photos { display: flex; align-items: center; justify-content: center; }
    .brand-photos { display: contents; }
    .ctrl-photos { display: contents; }

    /* === PHOTO LIGHTBOX === */
    .photo-lightbox {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
      z-index: 9999; align-items: center; justify-content: center;
      cursor: pointer;
    }
    .photo-lightbox.visible { display: flex; }
    .photo-lightbox img {
      max-width: 85%; max-height: 85%;
      border-radius: 16px; object-fit: contain;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6), 0 0 12px var(--neon-glow);
      border: 2px solid var(--neon-border);
      animation: lightboxIn 0.3s ease;
    }
    @keyframes lightboxIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* === SCREWS === */
    .screw {
      position: absolute; width: 10px; height: 10px; border-radius: 50%;
      background: linear-gradient(145deg, var(--screw1), var(--screw2));
      border: 1px solid var(--btn-border);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.1); z-index: 2;
      transition: all 0.6s;
    }
    .screw::after {
      content: ''; position: absolute; top: 4px; left: 1px;
      width: 8px; height: 1px; background: var(--screw-line);
      transition: background 0.6s;
    }
    .screw-tl{top:12px;left:12px} .screw-tr{top:12px;right:12px}
    .screw-bl{bottom:12px;left:12px} .screw-br{bottom:12px;right:12px}

    /* === FOOTER === */
    .radio-footer {
      text-align: center; margin-top: 10px; padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.05);
      position: relative; z-index: 1;
    }
    .footer-text {
      font-size: 9px; color: var(--footer-color);
      letter-spacing: 1px; transition: color 0.6s;
      font-weight: 500;
    }
    .footer-text a { color: var(--footer-link); text-decoration: none; transition: color 0.6s; }
    .footer-text a:hover { color: var(--accent); }

    /* === ERROR === */
    .error-msg {
      font-family: 'Orbitron', monospace; font-size: 9px;
      color: #ff4b4b; text-align: center; margin-top: 8px;
      display: none; position: relative; z-index: 1;
    }
    .error-msg.visible { display: block; }

    /* ============================================
       RESPONSIVE - MOBILE FIRST
       ============================================ */

    /* Desktop: 라디오 body 둥글게 */
    @media (min-width: 481px) {
      .radio { padding: 6px; border-radius: 24px; }
      .radio-inner { border-radius: 20px; padding: 24px 20px 20px; }
      .radio-inner::before { border-radius: 20px; }
      .theme-switcher { border-radius: 20px 20px 0 0; }
      .theme-name { margin-bottom: 6px; }
    }

    /* Tablet */
    @media (max-width: 540px) {
      body { padding: 10px; }
      .radio { max-width: 100%; }
    }

    /* === Mobile (phones) === */
    @media (max-width: 480px) {
      body {
        padding: 0;
        justify-content: flex-start;
        min-height: 100vh;
        min-height: 100dvh;
      }

      /* Theme switcher: 라디오 안에 붙이기 */
      .theme-name { font-size: 0; height: 0; margin: 0; overflow: hidden; }
      .theme-switcher {
        margin: 0;
        padding: 8px 12px;
        border-radius: 0;
        background: rgba(0,0,0,0.25);
        border: none;
        border-bottom: 1px solid rgba(255,255,255,0.04);
        justify-content: center;
        gap: 10px;
        width: 100%;
      }
      .theme-dot {
        width: 32px; height: 32px;
        flex-shrink: 0;
      }

      /* Radio body: 풀 화면 */
      .radio {
        max-width: 100%;
        border-radius: 0;
        padding: 0;
        border-width: 2px 0;
        box-shadow:
          0 0 8px var(--neon-glow),
          inset 0 0 8px var(--neon-glow);
        min-height: 100vh;
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
      }
      .radio-inner {
        border-radius: 0;
        padding: 14px 16px 16px;
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      .radio-inner::before { border-radius: 0; }

      /* Antenna 숨김 */
      .antenna { display: none; }

      /* Screws 숨김 */
      .screw { display: none; }

      /* Brand */
      .radio-top-row1 { margin-bottom: 4px; }
      .radio-top-row2 { margin-bottom: 8px; padding-bottom: 8px; }
      .brand { font-size: 18px; letter-spacing: 2px; }
      .power-btn { width: 38px; height: 38px; }

      /* Speaker: 컴팩트 */
      .speaker-grille {
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 10px;
      }
      .eq-container { height: 36px; gap: 2px; }
      .eq-bar { width: 4px; }

      /* LCD: 컴팩트 */
      .lcd-display {
        padding: 10px 14px;
        margin-bottom: 10px;
        min-height: 74px;
        border-radius: 8px;
      }
      .lcd-name { font-size: 13px; }
      .lcd-freq { font-size: 22px; }
      .lcd-provider { font-size: 8px; margin-bottom: 2px; }
      .lcd-status { font-size: 7px; margin-top: 3px; }

      /* Tuning: 컴팩트 */
      .tuning-section {
        padding: 8px 14px;
        margin-bottom: 10px;
        border-radius: 8px;
      }
      .tuning-label { margin-bottom: 6px; }
      .freq-band { height: 22px; }
      .tuning-needle { height: 18px; top: 2px; }
      .freq-mark { font-size: 6px; }

      /* Preset: flex-grow로 남은 공간 활용 */
      .preset-section {
        margin-bottom: 10px;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }
      .preset-label { margin-bottom: 6px; }
      .preset-scroll { flex: 1; min-height: 0; }
      .preset-buttons {
        gap: 3px;
        grid-template-columns: repeat(5, 1fr);
      }
      .preset-btn {
        padding: 3px 3px 2px;
        border-radius: 5px;
        min-width: auto;
      }
      .eq-panel { padding: 10px 12px; margin-bottom: 8px; }
      .eq-slider-wrap { height: 80px; }
      .eq-slider-wrap input[type="range"] { width: 70px; }
      .preset-num { font-size: 10px; }
      .preset-name { font-size: 6.5px; }

      /* Controls: 컴팩트 */
      .control-panel { gap: 8px; }
      .knob-container { width: 50px; height: 50px; }
      .knob { width: 42px; height: 42px; top: 4px; left: 4px; }
      .knob-indicator { top: 5px; height: 9px; }
      .knob-tick { height: 4px; }
      .knob-label { font-size: 6px; }
      .play-btn { width: 58px; height: 58px; border-width: 2px; }
      .play-btn svg { width: 24px; height: 24px; }

      /* Footer: 컴팩트 */
      .radio-footer { margin-top: 8px; padding-top: 8px; }
      .footer-text { font-size: 8px; }
    }

    /* === Small phones (SE, mini 등) === */
    @media (max-width: 380px) {
      .radio-inner { padding: 10px 12px 12px; }
      .brand { font-size: 16px; }
      .speaker-grille { padding: 8px; margin-bottom: 8px; }
      .eq-container { height: 30px; }
      .lcd-display { padding: 8px 12px; margin-bottom: 8px; min-height: 66px; }
      .lcd-freq { font-size: 19px; }
      .lcd-name { font-size: 11px; }
      .tuning-section { padding: 6px 12px; margin-bottom: 8px; }
      .freq-band { height: 20px; }
      .tuning-needle { height: 16px; }
      .preset-section { margin-bottom: 8px; }
      .preset-buttons { gap: 2px; grid-template-columns: repeat(5, 1fr); }
      .preset-btn { padding: 3px 2px 2px; min-width: auto; }
      .preset-num { font-size: 9px; }
      .preset-name { font-size: 5.5px; }
      .anniversary-panel { padding: 8px 10px; }
      .anniversary-item .anniv-name { font-size: 9px; }
      .anniversary-item .anniv-dday { font-size: 9px; min-width: 42px; }
      .anniversary-add-row input[type="text"] { font-size: 9px; }
      .control-panel { gap: 6px; }
      .knob-container { width: 44px; height: 44px; }
      .knob { width: 38px; height: 38px; top: 3px; left: 3px; }
      .play-btn { width: 52px; height: 52px; }
      .theme-dot { width: 28px; height: 28px; }
      .theme-switcher { gap: 6px; padding: 6px 8px; }
    }

    /* === Very small phones === */
    @media (max-width: 340px) {
      .theme-dot { width: 24px; height: 24px; }
      .theme-switcher { gap: 5px; }
      .brand { font-size: 14px; }
      .lcd-freq { font-size: 17px; }
      .play-btn { width: 48px; height: 48px; }
      .knob-container { width: 40px; height: 40px; }
      .knob { width: 34px; height: 34px; top: 3px; left: 3px; }
      .preset-buttons { gap: 2px; grid-template-columns: repeat(5, 1fr); }
      .preset-btn { min-width: auto; padding: 2px 2px 1px; }
    }

    /* Landscape phone */
    @media (max-height: 500px) and (orientation: landscape) {
      body { justify-content: flex-start; }
      .radio { min-height: auto; }
      .radio-inner { min-height: auto; flex: none; }
      .speaker-grille { padding: 6px; margin-bottom: 6px; }
      .eq-container { height: 24px; }
      .lcd-display { min-height: 58px; padding: 6px 12px; margin-bottom: 6px; }
      .lcd-freq { font-size: 18px; }
      .tuning-section { padding: 4px 12px; margin-bottom: 6px; }
      .preset-section { margin-bottom: 6px; }
      .eq-panel { padding: 8px 10px; margin-bottom: 4px; }
      .eq-slider-wrap { height: 60px; }
      .eq-slider-wrap input[type="range"] { width: 50px; }
      .eq-extra-controls { gap: 4px; }
      .control-panel { gap: 6px; }
      .knob-container { width: 40px; height: 40px; }
      .knob { width: 34px; height: 34px; top: 3px; left: 3px; }
      .play-btn { width: 48px; height: 48px; }
      .radio-footer { display: none; }
    }

    /* Touch: 터치 타겟 최소 크기 보장 */
    @media (pointer: coarse) {
      .preset-btn { min-height: 28px; }
      .power-btn { width: 40px; height: 40px; }
      .play-btn { min-width: 52px; min-height: 52px; }
      .theme-dot { min-width: 28px; min-height: 28px; }
    }

  </style>
  <script defer src="https://cdn.jsdelivr.net/npm/hls.js@1.6.15"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- Theme Name (desktop only) -->
<div class="theme-name" id="themeName">WOOD CLASSIC</div>

<div class="radio" id="radioBody">
  <div class="antenna" id="antenna"></div>

  <!-- Theme Switcher: 라디오 본체 안 상단 -->
  <div class="theme-switcher" id="themeSwitcher">
    <button class="theme-toggle-btn" id="themeToggleBtn" onclick="toggleThemeDots()" title="테마 감추기">◀</button>
    <div class="theme-dots-wrap" id="themeDotsWrap">
      <div class="theme-dot active" data-t="wood" title="우드 클래식 · 나무결" onclick="setTheme('wood')"></div>
      <div class="theme-dot" data-t="cream" title="레트로 크림 · 가죽" onclick="setTheme('cream')"></div>
      <div class="theme-dot" data-t="black" title="미드나잇 블랙 · 카본파이버" onclick="setTheme('black')"></div>
      <div class="theme-dot" data-t="military" title="밀리터리 · 캔버스" onclick="setTheme('military')"></div>
      <div class="theme-dot" data-t="silver" title="크롬 실버 · 브러시드메탈" onclick="setTheme('silver')"></div>
      <div class="theme-dot" data-t="cyber" title="네온 사이버 · 회로기판" onclick="setTheme('cyber')"></div>
      <div class="theme-dot" data-t="rose" title="로즈 골드 · 대리석" onclick="setTheme('rose')"></div>
      <div class="theme-dot" data-t="maltese" title="말티즈 · 털 결" onclick="setTheme('maltese')"></div>
      <div class="theme-dot" data-t="purple" title="퍼플 갤럭시 · 성운" onclick="setTheme('purple')"></div>
      <div class="theme-dot" data-t="hotpink" title="핫핑크 네온 · 글로우" onclick="setTheme('hotpink')"></div>
    </div>
  </div>

  <div class="radio-inner">
    <div class="screw screw-tl"></div>
    <div class="screw screw-tr"></div>
    <div class="screw screw-bl"></div>
    <div class="screw screw-br"></div>

    <!-- Brand & Power (1줄) -->
    <div class="radio-top-row1">
      <div class="brand"><span class="brand-clara">클라라</span> <span class="brand-cafe">라디오카페</span></div>
      <button class="power-btn" id="powerBtn" title="전원">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M12 2v10"/><path d="M18.4 6.6a9 9 0 1 1-12.8 0"/></svg>
      </button>
    </div>
    <!-- Photos & Mode Switch (2줄) -->
    <div class="radio-top-row2">
      <button class="photo-upload-btn" id="photoUploadBtn" onclick="reopenPhotoSelect()" title="사진 변경">+</button>
      <span class="brand-photos" id="brandPhotos"></span>
      <button class="digital-to-analog-btn" onclick="if(currentStation)localStorage.setItem('radio-switch-station',currentStation.id);document.body.style.visibility='hidden';location.href='analog.html'" title="아날로그 모드">ANALOG ▸</button>
    </div>

    <!-- Speaker Grille -->
    <div class="speaker-grille">
      <div class="speaker-label">STEREO</div>
      <div class="speaker-mesh"></div>
      <div class="eq-container" id="equalizer"></div>
    </div>

    <!-- LCD Display -->
    <div class="lcd-display">
      <div class="lcd-idle" id="lcdIdle"><span style="display:block;margin-bottom:2px"><span id="lcdDate" style="font-size:11px;font-weight:600;color:var(--needle,#ff6b6b);opacity:0.85"></span> <span id="lcdLunar" style="font-size:10px;font-weight:500;color:var(--accent,#d4a574);opacity:0.75"></span></span><span id="lcdClock" style="font-size:22px;font-weight:700;display:block;margin-bottom:4px"></span><span style="font-size:9px;opacity:0.6;letter-spacing:3px">SELECT STATION</span></div>
      <div class="lcd-active" id="lcdActive">
        <div class="lcd-provider" id="lcdProvider"></div>
        <div class="lcd-name" id="lcdName"></div>
        <div class="lcd-freq" id="lcdFreq"></div>
        <div class="lcd-status">
          <span id="lcdStatusText"><span class="on-air-dot" id="onAirDot" style="display:none"></span>PLAYING</span>
          <div class="lcd-signal" id="lcdSignal">
            <div class="lcd-signal-bar" style="height:4px"></div>
            <div class="lcd-signal-bar" style="height:7px"></div>
            <div class="lcd-signal-bar" style="height:10px"></div>
            <div class="lcd-signal-bar" style="height:13px"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tuning Dial -->
    <div class="tuning-section">
      <div class="tuning-label">FM TUNING</div>
      <div class="freq-band">
        <div class="freq-ticks" id="freqTicks"></div>
        <div class="freq-marks">
          <span class="freq-mark">88</span><span class="freq-mark">92</span>
          <span class="freq-mark">96</span><span class="freq-mark">100</span>
          <span class="freq-mark">104</span><span class="freq-mark">108</span>
        </div>
        <div class="tuning-needle" id="tuningNeedle"></div>
      </div>
    </div>

    <!-- Preset Station Buttons -->
    <div class="preset-section">
      <div class="preset-label">PRESET STATIONS</div>
      <div class="preset-scroll">
        <div class="preset-buttons" id="presetButtons"></div>
      </div>
    </div>

    <!-- EQ Panel -->
    <div class="eq-panel" id="eqPanel" style="display:none">
      <div class="eq-panel-header">
        <span class="eq-panel-title">EQUALIZER</span>
        <button class="eq-reset-btn" onclick="resetEQ()">RESET</button>
      </div>
      <div class="eq-sliders">
        <div class="eq-slider-group">
          <div class="eq-db-label" id="eqDb0">0</div>
          <div class="eq-slider-wrap"><input type="range" min="-12" max="12" value="0" data-eq="0" oninput="updateEQ(0,this.value)"></div>
          <span class="eq-freq-label">60</span>
        </div>
        <div class="eq-slider-group">
          <div class="eq-db-label" id="eqDb1">0</div>
          <div class="eq-slider-wrap"><input type="range" min="-12" max="12" value="0" data-eq="1" oninput="updateEQ(1,this.value)"></div>
          <span class="eq-freq-label">230</span>
        </div>
        <div class="eq-slider-group">
          <div class="eq-db-label" id="eqDb2">0</div>
          <div class="eq-slider-wrap"><input type="range" min="-12" max="12" value="0" data-eq="2" oninput="updateEQ(2,this.value)"></div>
          <span class="eq-freq-label">910</span>
        </div>
        <div class="eq-slider-group">
          <div class="eq-db-label" id="eqDb3">0</div>
          <div class="eq-slider-wrap"><input type="range" min="-12" max="12" value="0" data-eq="3" oninput="updateEQ(3,this.value)"></div>
          <span class="eq-freq-label">3.6k</span>
        </div>
        <div class="eq-slider-group">
          <div class="eq-db-label" id="eqDb4">0</div>
          <div class="eq-slider-wrap"><input type="range" min="-12" max="12" value="0" data-eq="4" oninput="updateEQ(4,this.value)"></div>
          <span class="eq-freq-label">14k</span>
        </div>
      </div>
      <div class="eq-extra-controls">
        <div class="eq-control-row">
          <span class="eq-control-label">BASS BOOST</span>
          <input type="range" class="eq-h-slider" id="wooferSlider" min="0" max="12" value="0" step="0.5" oninput="updateWoofer(this.value)">
          <span class="eq-h-value" id="wooferValue">0</span>
        </div>
        <div class="eq-control-row">
          <span class="eq-control-label">VIRTUAL</span>
          <input type="range" class="eq-h-slider" id="virtualizerSlider" min="0" max="100" value="0" oninput="updateVirtualizer(this.value)">
          <span class="eq-h-value" id="virtualizerValue">0</span>
        </div>
      </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
      <div class="knob-area">
        <div class="knob-container" id="knobContainer">
          <div class="knob-marks" id="knobMarks"></div>
          <div class="knob" id="volumeKnob" title="볼륨 조절"><div class="knob-indicator"></div></div>
        </div>
        <div class="knob-label">VOLUME</div>
      </div>
      <span class="ctrl-photos" id="ctrlPhotoLeft"></span>
      <div class="play-btn-container">
        <button class="play-btn" id="playBtn" onclick="togglePlay()">
          <svg id="playIcon" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="7,3 21,12 7,21"/></svg>
          <svg id="pauseIcon" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="none" style="display:none"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
          <svg id="loaderIcon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" style="display:none" class="spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
        </button>
      </div>
      <span class="ctrl-photos" id="ctrlPhotoRight"></span>
      <div class="knob-area">
        <button class="eq-toggle-btn" id="eqToggleBtn" onclick="toggleEqPanel()" title="이퀄라이저">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>
        </button>
        <div class="knob-label">EQ</div>
      </div>
    </div>

    <!-- Anniversary Section -->
    <div class="anniversary-section">
      <div class="anniversary-label">ANNIVERSARY</div>
      <div class="anniversary-panel">
        <div class="anniv-user-row" id="annivUserRow">
          <span class="anniv-user-name" id="annivUserName"></span>
          <button class="anniv-dash-btn" onclick="openDashboard()">DASHBOARD</button>
        </div>
        <div class="anniv-birthday-info" id="annivBirthdayInfo"></div>
        <div class="anniversary-list" id="anniversaryList"></div>
        <div class="anniversary-add-row" id="anniversaryAddRow">
          <input type="text" id="annivNameInput" placeholder="기념일 이름" maxlength="12" autocomplete="off">
          <select id="annivTypeSelect" class="anniv-type-select"><option value="birthday">생일</option><option value="wedding">결혼기념일</option><option value="meeting">만난 날</option></select>
          <input type="number" id="annivYearInput" class="anniv-date-field" placeholder="년" min="1920" max="2030" inputmode="numeric">
          <input type="number" id="annivMonthInput" class="anniv-date-field" placeholder="월" min="1" max="12" inputmode="numeric">
          <input type="number" id="annivDayInput" class="anniv-date-field" placeholder="일" min="1" max="31" inputmode="numeric">
          <select id="annivCalSelect" class="anniv-cal-select"><option value="solar">양력</option><option value="lunar">음력</option></select>
          <button onclick="addAnniversary()">+</button>
        </div>
      </div>
    </div>

    <div class="error-msg" id="errorMsg"></div>

    <!-- Photo Lightbox -->
    <div class="photo-lightbox" id="photoLightbox" onclick="closeLightbox()">
      <img id="lightboxImg" src="" alt="">
    </div>

    <div class="radio-footer">
      <div class="footer-text">&copy; 2026 <a href="about.html"><strong>Hyein Cho</strong></a></div>
    </div>
  </div>
</div>

<!-- Dashboard Modal -->
<div class="dashboard-overlay" id="dashboardOverlay" onclick="if(event.target===this)closeDashboard()">
  <div class="dashboard-modal">
    <div class="dashboard-header">
      <span class="dashboard-title">MY DASHBOARD</span>
      <button class="dashboard-close" onclick="closeDashboard()">&times;</button>
    </div>
    <div class="dashboard-user-info">
      <div class="dashboard-user-name" id="dashUserName"></div>
      <div class="dashboard-user-email" id="dashUserEmail"></div>
    </div>
    <div class="dashboard-section-title">ANNIVERSARIES</div>
    <div class="dashboard-anniv-list" id="dashAnnivList"></div>
    <div class="dashboard-add-row" id="dashAddRow">
      <input type="text" id="dashAnnivNameInput" placeholder="기념일 이름" maxlength="12" autocomplete="off">
      <select id="dashAnnivTypeSelect" class="dash-type-select"><option value="birthday">생일</option><option value="wedding">결혼기념일</option><option value="meeting">만난 날</option></select>
      <input type="number" id="dashAnnivYearInput" class="dash-date-field" placeholder="년" min="1920" max="2030" inputmode="numeric">
      <input type="number" id="dashAnnivMonthInput" class="dash-date-field" placeholder="월" min="1" max="12" inputmode="numeric">
      <input type="number" id="dashAnnivDayInput" class="dash-date-field" placeholder="일" min="1" max="31" inputmode="numeric">
      <select id="dashAnnivCalSelect" class="dash-cal-select"><option value="solar">양력</option><option value="lunar">음력</option></select>
      <button onclick="addAnniversaryFromDash()">+</button>
    </div>
  </div>
</div>

<!-- Fortune Modal -->
<div class="fortune-overlay" id="fortuneOverlay" onclick="if(event.target===this)closeFortune()">
  <div class="fortune-modal">
    <div class="fortune-header">
      <span class="fortune-title">TODAY'S FORTUNE</span>
      <button class="fortune-close" onclick="closeFortune()">&times;</button>
    </div>
    <div id="fortuneContent"></div>
  </div>
</div>

<!-- Tarot Modal -->
<div class="tarot-overlay" id="tarotOverlay" onclick="if(event.target===this)closeTarot()">
  <div class="tarot-modal">
    <div class="tarot-header">
      <span class="tarot-title">TAROT READING</span>
      <button class="tarot-close" onclick="closeTarot()">&times;</button>
    </div>
    <div id="tarotContent"></div>
  </div>
</div>

<script>
  // === Station Data ===
  var STATIONS = [
    {id:'kbs-1fm',name:'KBS 클래식FM',url:'',apiUrl:'https://cfpwwwapi.kbs.co.kr/api/v1/landing/live/channel_code/24',freq:'93.1 MHz',freqNum:93.1,logoText:'KBS 클래식',provider:'KBS'},
    {id:'ebs-fm',name:'EBS FM',url:'https://ebsonair.ebs.co.kr/fmradiofamilypc/familypc1m/playlist.m3u8',freq:'104.5 MHz',freqNum:104.5,logoText:'EBS',provider:'EBS'},
    {id:'gwangju-mbc-fm',name:'광주MBC FM',url:'https://media.kjmbc.co.kr/hls/fmlive/GWANGJU-MBC-FM/playlist.m3u8',freq:'93.9 MHz',freqNum:93.9,logoText:'MBC',provider:'MBC'},
    {id:'ytn-radio',name:'YTN 라디오',url:'https://radiolive.ytn.co.kr/radio/_definst_/20211118_fmlive/playlist.m3u8',freq:'94.5 MHz',freqNum:94.5,logoText:'YTN',provider:'YTN'},
    {id:'tbs-fm',name:'TBS FM',url:'https://cdnfm.tbs.seoul.kr/tbs/_definst_/tbs_fm_web_360.smil/playlist.m3u8',freq:'95.1 MHz',freqNum:95.1,logoText:'TBS',provider:'TBS'},
    {id:'febc',name:'극동방송',url:'http://mlive2.febc.net:1935/live/seoulfm/playlist.m3u8',freq:'106.9 MHz',freqNum:106.9,logoText:'극동',provider:'FEBC'},
    {id:'tbn',name:'TBN 교통방송',url:'http://radio2.tbn.or.kr:1935/gyeongin/myStream/playlist.m3u8',freq:'95.1 MHz',freqNum:95.1,logoText:'TBN 교통방송',provider:'TBN'},
    {id:'obs',name:'OBS 라디오',url:'https://vod3.obs.co.kr:444/live/obsstream1/radio.stream/playlist.m3u8',freq:'99.9 MHz',freqNum:99.9,logoText:'OBS',provider:'OBS'},
    {id:'tarot',name:'타로 점보기',url:'',freq:'타로',freqNum:0,logoText:'타로 점보기',provider:'CLARA',isTarot:true},
    {id:'fortune',name:'오늘의 운세',url:'',freq:'운세',freqNum:0,logoText:'오늘의 운세',provider:'CLARA',isFortune:true},
    {id:'wqxr',name:'WQXR',url:'https://stream.wqxr.org/wqxr',freq:'미국',freqNum:0,logoText:'WQXR',provider:'WQXR',flag:'us'},
    {id:'ottava',name:'OTTAVA',url:'https://sslv.smartstream.ne.jp/ottava/_definst_/live01/chunklist.m3u8',freq:'일본',freqNum:0,logoText:'OTTAVA',provider:'OTTAVA',flag:'jp'},
    {id:'france-musique',name:'France Musique',url:'https://stream.radiofrance.fr/francemusique/francemusique.m3u8',freq:'프랑스',freqNum:0,logoText:'France M',provider:'Radio France',flag:'fr'},
    {id:'br-klassik',name:'BR Klassik',url:'https://dispatcher.rndfnk.com/br/brklassik/live/mp3/high',freq:'독일',freqNum:0,logoText:'BR Klassik',provider:'BR',flag:'de'},
    {id:'classic-fm',name:'Classic FM',url:'http://media-the.musicradio.com/ClassicFMMP3',freq:'영국',freqNum:0,logoText:'Classic FM',provider:'Global',flag:'gb'}
  ];

  // === Theme Names ===
  var THEME_NAMES = {
    wood: 'WOOD CLASSIC \u00b7 \ub098\ubb34\uacb0',
    cream: 'RETRO CREAM \u00b7 \uac00\uc8fd',
    black: 'MIDNIGHT BLACK \u00b7 \uce74\ubcf8\ud30c\uc774\ubc84',
    military: 'MILITARY \u00b7 \uce94\ubc84\uc2a4',
    silver: 'CHROME SILVER \u00b7 \ube0c\ub7ec\uc2dc\ub4dc\uba54\ud0c8',
    cyber: 'NEON CYBER \u00b7 \ud68c\ub85c\uae30\ud310',
    rose: 'ROSE GOLD \u00b7 \ub300\ub9ac\uc11d',
    maltese: 'MALTESE \u00b7 \ud138 \uacb0'
  };

  // === State ===
  var currentStation = null;
  var audio = null;
  var hlsInstance = null;
  var isPlaying = false;
  var isLoading = false;
  var volume = 0.8;
  var knobAngle = -135 + (0.8 * 270);
  var isPowered = false;
  var currentTheme = 'wood';

  // === Theme ===
  function toggleThemeDots() {
    var wrap = document.getElementById('themeDotsWrap');
    var btn = document.getElementById('themeToggleBtn');
    wrap.classList.toggle('hidden');
    var hidden = wrap.classList.contains('hidden');
    btn.textContent = hidden ? '▶' : '◀';
    btn.title = hidden ? '테마 보이기' : '테마 감추기';
  }
  function setTheme(name) {
    currentTheme = name;
    document.getElementById('radioBody').setAttribute('data-theme', name);
    document.body.setAttribute('data-theme', name);
    document.getElementById('themeName').textContent = THEME_NAMES[name] || name.toUpperCase();
    document.querySelectorAll('.theme-dot').forEach(function(d) {
      d.classList.toggle('active', d.getAttribute('data-t') === name);
    });
    try { localStorage.setItem('k-radio-theme', name); } catch(e) {}
  }

  // === Supabase ===
  var SUPABASE_URL = 'https://haxcktfnuudlqciyljtp.supabase.co';
  var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhheGNrdGZudXVkbHFjaXlsanRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzMDUwNDAsImV4cCI6MjA4NDg4MTA0MH0.suN7BeaHx3MjaNlMDQa0940P-rMl2XPyk4ksoQEU3YM';
  var supabase;
  var BUCKET_NAME = 'photo-albums';

  // === Init ===
  async function init() {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
      global: { fetch: function(url, opts) { opts = opts || {}; opts.cache = 'no-store'; return fetch(url, opts); } }
    });
    // Restore saved theme (default: purple)
    setTheme('purple');
    try {
      var saved = localStorage.getItem('k-radio-theme');
      if (saved && THEME_NAMES[saved]) setTheme(saved);
    } catch(e) {}

    // 클라우드에서 방송국 데이터 로드 시도
    try {
      var r = await supabase.storage.from(BUCKET_NAME).download('_system/stations.json');
      if (r.data) {
        var text = await r.data.text();
        var cloudStations = JSON.parse(text);
        if (cloudStations && cloudStations.length > 0) {
          STATIONS = cloudStations;
        }
      }
    } catch(e) { /* 기본 하드코딩 방송국 사용 */ }

    renderPresets();
    renderEqualizer();
    renderKnobMarks();
    renderFreqTicks();
    updateKnobVisual();
    setupKnobDrag();
    updateClock();
    setInterval(updateClock, 1000);
    loadSavedPhotos();
    loadAnniversaries();

    // 기념일 자동 로그인: sessionStorage에서 사용자명 가져오기
    var storedUser = sessionStorage.getItem('radioUsername');
    if (storedUser && !annivLoggedUser) {
      annivLoggedUser = storedUser;
      loadAnniversariesFromCloud(storedUser).then(function(data){
        anniversaries = data;
        try { localStorage.setItem('radio-anniversaries', JSON.stringify(anniversaries)); } catch(e) {}
        updateAnnivUI();
        renderAnniversaries();
      });
    }
    updateAnnivUI();

    // Background playback: resume audio context when returning from background
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible') {
        if (audioCtx && audioCtx.state === 'suspended') {
          audioCtx.resume();
        }
        if (isPlaying) requestWakeLock();
      }
    });

    // 모드 전환 시 이전 채널 자동 재생
    var switchStation = localStorage.getItem('radio-switch-station');
    if (switchStation) {
      localStorage.removeItem('radio-switch-station');
      selectStation(switchStation);
    }
  }

  // === Render ===
  function renderPresets() {
    var c = document.getElementById('presetButtons');
    c.innerHTML = STATIONS.map(function(s,i) {
      var cat = s.isTarot || s.isFortune ? ' preset-special' : s.flag ? ' preset-foreign' : '';
      var cls = 'preset-btn' + cat + (s.empty ? ' preset-empty' : '');
      var nameHtml;
      if(s.empty) nameHtml='';
      else if(s.isTarot) nameHtml='<span class="preset-tarot-cards">🂠🂠🂠</span>';
      else if(s.isFortune) nameHtml='<span class="preset-lucky7">7</span>';
      else if(s.flag) nameHtml='<img src="https://flagcdn.com/24x18/'+s.flag+'.png" alt="'+s.flag+'" style="height:13px;vertical-align:middle;">';
      else nameHtml=s.name.replace(/\s+/g,' ').split(' ')[0];
      return '<button class="'+cls+'" data-id="'+s.id+'" onclick="selectStation(\''+s.id+'\')">' +
        '<span class="preset-num">'+s.logoText+'</span>' +
        '<span class="preset-name">'+nameHtml+'</span></button>';
    }).join('');
  }
  function renderEqualizer() {
    var h=''; for(var i=0;i<16;i++) h+='<div class="eq-bar"></div>';
    document.getElementById('equalizer').innerHTML=h;
  }
  function renderKnobMarks() {
    var h=''; for(var i=0;i<11;i++){var a=-135+(i*27);
    h+='<div class="knob-tick" style="transform:rotate('+a+'deg)"></div>';}
    document.getElementById('knobMarks').innerHTML=h;
  }

  // === Freq Ticks ===
  function renderFreqTicks(){
    var el=document.getElementById('freqTicks');if(!el)return;
    var h='';
    for(var f=88;f<=108;f+=0.5){
      var pct=((f-88)/20)*90+5;
      var cls=f%2===0?'freq-tick major':'freq-tick minor';
      h+='<div class="'+cls+'" style="left:'+pct+'%"></div>';
    }
    el.innerHTML=h;
  }

  // === Lunar Calendar ===
  var LUNAR_DATA = [
    0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
    0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
    0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
    0x06566,0x0d4a0,0x0ea50,0x16a95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
    0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,
    0x06ca0,0x0b550,0x15355,0x04da0,0x0a5b0,0x14573,0x052b0,0x0a9a8,0x0e950,0x06aa0,
    0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,
    0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b6a0,0x195a6,
    0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,
    0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x05ac0,0x0ab60,0x096d5,0x092e0,
    0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,
    0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,
    0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,
    0x05aa0,0x076a3,0x096d0,0x04afb,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,
    0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0,
    0x14b63,0x09370,0x049f8,0x04970,0x064b0,0x168a6,0x0ea50,0x06aa0,0x1a6c4,0x0aae0,
    0x092e0,0x0d2e3,0x0c960,0x0d557,0x0d4a0,0x0da50,0x05d55,0x056a0,0x0a6d0,0x055d4,
    0x052d0,0x0a9b8,0x0a950,0x0b4a0,0x0b6a6,0x0ad50,0x055a0,0x0aba4,0x0a5b0,0x052b0,
    0x0b273,0x06930,0x07337,0x06aa0,0x0ad50,0x14b55,0x04b60,0x0a570,0x054e4,0x0d160,
    0x0e968,0x0d520,0x0daa0,0x16aa6,0x056d0,0x04ae0,0x0a9d4,0x0a4d0,0x0d150,0x0f252,
    0x0d520
  ];
  var LUNAR_START_YEAR = 1900;

  function lunarYearDays(y) {
    var i, sum = 348;
    for (i = 0x8000; i > 0x8; i >>= 1) sum += (LUNAR_DATA[y - LUNAR_START_YEAR] & i) ? 1 : 0;
    return sum + leapDaysInLunarYear(y);
  }
  function leapMonthInLunarYear(y) { return LUNAR_DATA[y - LUNAR_START_YEAR] & 0xf; }
  function leapDaysInLunarYear(y) { return leapMonthInLunarYear(y) ? ((LUNAR_DATA[y - LUNAR_START_YEAR] & 0x10000) ? 30 : 29) : 0; }
  function lunarMonthDays(y, m) { return (LUNAR_DATA[y - LUNAR_START_YEAR] & (0x10000 >> m)) ? 30 : 29; }

  function solarToLunar(year, month, day) {
    var baseDate = new Date(1900, 0, 31);
    var targetDate = new Date(year, month - 1, day);
    var offset = Math.floor((targetDate - baseDate) / 86400000);
    var i, leap, temp, isLeap = false, lunarYear, lunarMonth, lunarDay;
    for (i = LUNAR_START_YEAR; i < 2101 && offset > 0; i++) {
      temp = lunarYearDays(i);
      offset -= temp;
    }
    if (offset < 0) { offset += temp; i--; }
    lunarYear = i;
    leap = leapMonthInLunarYear(lunarYear);
    isLeap = false;
    for (i = 1; i < 13 && offset > 0; i++) {
      if (leap > 0 && i === (leap + 1) && !isLeap) {
        --i; isLeap = true;
        temp = leapDaysInLunarYear(lunarYear);
      } else { temp = lunarMonthDays(lunarYear, i); }
      if (isLeap && i === (leap + 1)) isLeap = false;
      offset -= temp;
    }
    if (offset === 0 && leap > 0 && i === leap + 1) {
      if (isLeap) { isLeap = false; } else { isLeap = true; --i; }
    }
    if (offset < 0) { offset += temp; --i; }
    lunarMonth = i;
    lunarDay = offset + 1;
    return { year: lunarYear, month: lunarMonth, day: lunarDay, isLeap: isLeap };
  }

  // === Clock ===
  var cachedLunarDate = '';
  var cachedLunarDay = -1;

  function updateClock(){
    var now=new Date();
    var h=String(now.getHours()).padStart(2,'0');
    var m=String(now.getMinutes()).padStart(2,'0');
    var s=String(now.getSeconds()).padStart(2,'0');
    var el=document.getElementById('lcdClock');
    if(el) el.textContent=h+':'+m+':'+s;
    var dateEl=document.getElementById('lcdDate');
    if(dateEl) dateEl.textContent=now.getFullYear()+'년 '+(now.getMonth()+1)+'월 '+now.getDate()+'일';
    // 음력: 하루에 한 번만 계산
    var today=now.getDate();
    if(cachedLunarDay!==today){
      cachedLunarDay=today;
      try{
        var l=solarToLunar(now.getFullYear(),now.getMonth()+1,now.getDate());
        cachedLunarDate='(음력 '+(l.isLeap?'윤':'')+l.month+'월 '+l.day+'일)';
      }catch(e){cachedLunarDate='';}
    }
    var lunarEl=document.getElementById('lcdLunar');
    if(lunarEl) lunarEl.textContent=cachedLunarDate;
  }

  // === Anniversary ===
  var anniversaries = [];
  var annivLoggedUser = null;
  var annivUsersCache = null;

  // Cloud: load users.json (same as index.html)
  async function loadAnnivUsers() {
    if (annivUsersCache) return annivUsersCache;
    try {
      var r = await supabase.storage.from(BUCKET_NAME).download('_system/users.json');
      if (r.data) {
        annivUsersCache = JSON.parse(await r.data.text());
        return annivUsersCache;
      }
    } catch(e) {}
    return {};
  }

  // Cloud: save anniversaries per user
  async function saveAnniversariesToCloud() {
    if (!annivLoggedUser) return;
    try {
      var blob = new Blob([JSON.stringify(anniversaries)], { type: 'application/json' });
      var result = await supabase.storage.from(BUCKET_NAME).upload(
        '_system/anniversaries/' + annivLoggedUser + '.json', blob, { upsert: true }
      );
      if(result.error) console.log('기념일 클라우드 저장 실패:', result.error.message);
    } catch(e) { console.log('기념일 클라우드 저장 예외:', e); }
  }

  // Cloud: load anniversaries per user
  async function loadAnniversariesFromCloud(nickname) {
    try {
      var r = await supabase.storage.from(BUCKET_NAME).download(
        '_system/anniversaries/' + nickname + '.json'
      );
      if (r.data) {
        var arr = JSON.parse(await r.data.text());
        if (Array.isArray(arr) && arr.length > 0) return arr;
      }
    } catch(e) {}
    // 클라우드 데이터가 없으면 로컬 데이터 확인
    try {
      var local = JSON.parse(localStorage.getItem('radio-anniversaries'));
      if (local && Array.isArray(local) && local.length > 0) {
        return local;
      }
    } catch(e) {}
    return [];
  }

  function updateAnnivUI() {
    var userRow = document.getElementById('annivUserRow');
    var bdayInfo = document.getElementById('annivBirthdayInfo');
    if (annivLoggedUser) {
      userRow.classList.remove('hidden');
      document.getElementById('annivUserName').textContent = annivLoggedUser + '님';
      renderBirthdayInfo();
    } else {
      if(bdayInfo) bdayInfo.classList.remove('visible');
    }
  }

  async function renderBirthdayInfo(){
    var loggedUser = annivLoggedUser || sessionStorage.getItem('radioUsername');
    if(!loggedUser) return;
    var users = await loadAnnivUsers();
    var ud = users[loggedUser];
    if(!ud || !ud.birthYear) return;

    var by=ud.birthYear, bm=ud.birthMonth, bd=ud.birthDay, bc=ud.birthCalendar;
    var now=new Date(); var today=new Date(now.getFullYear(),now.getMonth(),now.getDate());

    var thisYearBday;
    var bdayLabel;
    if(bc==='lunar'){
      var solar=lunarToSolar(now.getFullYear(),bm,bd);
      thisYearBday=new Date(solar.year,solar.month-1,solar.day);
      bdayLabel=now.getFullYear()+'년 '+solar.month+'월 '+solar.day+'일 (음력 '+bm+'월 '+bd+'일)';
    } else {
      thisYearBday=new Date(now.getFullYear(),bm-1,bd);
      bdayLabel=now.getFullYear()+'년 '+bm+'월 '+bd+'일';
    }

    var nextBday=thisYearBday;
    if(thisYearBday<today){
      if(bc==='lunar'){
        var solarNext=lunarToSolar(now.getFullYear()+1,bm,bd);
        nextBday=new Date(solarNext.year,solarNext.month-1,solarNext.day);
        bdayLabel=(now.getFullYear()+1)+'년 '+solarNext.month+'월 '+solarNext.day+'일 (음력 '+bm+'월 '+bd+'일)';
      } else {
        nextBday=new Date(now.getFullYear()+1,bm-1,bd);
        bdayLabel=(now.getFullYear()+1)+'년 '+bm+'월 '+bd+'일';
      }
    }

    var diffMs=nextBday.getTime()-today.getTime();
    var daysLeft=Math.round(diffMs/86400000);
    var ddayText, isToday=false;
    if(daysLeft===0){ ddayText='TODAY'; isToday=true; }
    else { ddayText='D-'+daysLeft; }

    var birthSolar;
    if(bc==='lunar'){
      var bs=lunarToSolar(by,bm,bd);
      birthSolar=new Date(bs.year,bs.month-1,bs.day);
    } else {
      birthSolar=new Date(by,bm-1,bd);
    }
    var livedDays=Math.floor((today.getTime()-birthSolar.getTime())/86400000);

    var html='<span class="anniv-bday-icon">🎂</span>';
    html+='<span class="anniv-bday-date">'+bdayLabel+'</span>';
    html+='<span class="anniv-bday-sep">|</span>';
    html+='<span class="anniv-bday-dday'+(isToday?' today':'')+'">'+ddayText+'</span>';
    html+='<span class="anniv-bday-sep">|</span>';
    html+='<span class="anniv-bday-lived">태어난 지 '+livedDays.toLocaleString()+'일</span>';

    var bdayInfo=document.getElementById('annivBirthdayInfo');
    if(bdayInfo){ bdayInfo.innerHTML=html; bdayInfo.classList.add('visible'); }
  }

  function loadAnniversaries() {
    try {
      var saved = JSON.parse(localStorage.getItem('radio-anniversaries'));
      if (saved && Array.isArray(saved)) anniversaries = saved;
    } catch(e) {}
    renderAnniversaries();
  }

  function saveAnniversaries() {
    try { localStorage.setItem('radio-anniversaries', JSON.stringify(anniversaries)); } catch(e) {}
    saveAnniversariesToCloud();
  }

  function addAnniversary() {
    if (anniversaries.length >= 5) return;
    var nameEl = document.getElementById('annivNameInput');
    var typeEl = document.getElementById('annivTypeSelect');
    var yEl = document.getElementById('annivYearInput');
    var mEl = document.getElementById('annivMonthInput');
    var dEl = document.getElementById('annivDayInput');
    var calEl = document.getElementById('annivCalSelect');
    var name = nameEl.value.trim();
    var type = typeEl ? typeEl.value : 'birthday';
    var y = parseInt(yEl.value), m = parseInt(mEl.value), d = parseInt(dEl.value);
    var cal = calEl ? calEl.value : 'solar';
    if (!name || !y || !m || !d || m<1||m>12||d<1||d>31) return;
    var date = y+'-'+String(m).padStart(2,'0')+'-'+String(d).padStart(2,'0');
    anniversaries.push({ name: name, type: type, date: date, calendar: cal });
    saveAnniversaries();
    renderAnniversaries();
    nameEl.value=''; yEl.value=''; mEl.value=''; dEl.value='';
    if(typeEl) typeEl.value='birthday';
    if(calEl) calEl.value='solar';
  }

  function removeAnniversary(idx) {
    anniversaries.splice(idx, 1);
    saveAnniversaries();
    renderAnniversaries();
  }

  function calcDday(dateStr) {
    var today = new Date(); today.setHours(0,0,0,0);
    var target = new Date(dateStr + 'T00:00:00');
    var diff = Math.round((target - today) / 86400000);
    var text, cls;
    if (diff > 0) { text = 'D-' + diff; cls = 'future'; }
    else if (diff === 0) { text = 'D-DAY'; cls = 'today'; }
    else { text = 'D+' + Math.abs(diff); cls = 'past'; }
    return { text: text, cls: cls, diff: diff };
  }

  function getAnnivSolarDate(a) {
    if (a.calendar === 'lunar') {
      var parts = a.date.split('-');
      var y = parseInt(parts[0]), m = parseInt(parts[1]), d = parseInt(parts[2]);
      var solar = lunarToSolar(y, m, d);
      if (solar) return solar.year + '-' + String(solar.month).padStart(2,'0') + '-' + String(solar.day).padStart(2,'0');
    }
    return a.date;
  }

  var ANNIV_TYPE_ICONS = {birthday:'🎂', wedding:'💍', meeting:'💑'};
  var ANNIV_LIVED_LABELS = {birthday:'태어난 지', wedding:'결혼한 지', meeting:'만난 지'};

  function getBirthdayDisplayInfo(a) {
    var parts = a.date.split('-');
    var by = parseInt(parts[0]), bm = parseInt(parts[1]), bd = parseInt(parts[2]);
    var bc = a.calendar;
    var now = new Date(); var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    var thisYearBday, bdayLabel;
    if (bc === 'lunar') {
      var solar = lunarToSolar(now.getFullYear(), bm, bd);
      thisYearBday = new Date(solar.year, solar.month - 1, solar.day);
      bdayLabel = now.getFullYear() + '년 ' + solar.month + '월 ' + solar.day + '일 (음력 ' + bm + '월 ' + bd + '일)';
    } else {
      thisYearBday = new Date(now.getFullYear(), bm - 1, bd);
      bdayLabel = now.getFullYear() + '년 ' + bm + '월 ' + bd + '일';
    }
    var nextBday = thisYearBday;
    if (thisYearBday < today) {
      if (bc === 'lunar') {
        var solarNext = lunarToSolar(now.getFullYear() + 1, bm, bd);
        nextBday = new Date(solarNext.year, solarNext.month - 1, solarNext.day);
        bdayLabel = (now.getFullYear() + 1) + '년 ' + solarNext.month + '월 ' + solarNext.day + '일 (음력 ' + bm + '월 ' + bd + '일)';
      } else {
        nextBday = new Date(now.getFullYear() + 1, bm - 1, bd);
        bdayLabel = (now.getFullYear() + 1) + '년 ' + bm + '월 ' + bd + '일';
      }
    }
    var diffMs = nextBday.getTime() - today.getTime();
    var daysLeft = Math.round(diffMs / 86400000);
    var ddayText, ddayCls;
    if (daysLeft === 0) { ddayText = 'D-DAY'; ddayCls = 'today'; }
    else { ddayText = 'D-' + daysLeft; ddayCls = 'future'; }
    var birthSolar;
    if (bc === 'lunar') {
      var bs = lunarToSolar(by, bm, bd);
      birthSolar = new Date(bs.year, bs.month - 1, bs.day);
    } else {
      birthSolar = new Date(by, bm - 1, bd);
    }
    var livedDays = Math.floor((today.getTime() - birthSolar.getTime()) / 86400000);
    return { bdayLabel: bdayLabel, ddayText: ddayText, ddayCls: ddayCls, livedDays: livedDays, daysLeft: daysLeft };
  }

  function renderAnniversaries() {
    var list = document.getElementById('anniversaryList');
    var addRow = document.getElementById('anniversaryAddRow');
    if (!list) return;
    if (anniversaries.length === 0) {
      list.innerHTML = '<div class="anniversary-empty">' +
        (annivLoggedUser ? '기념일을 추가해보세요 (최대 5개)' : '로그인 후 기념일을 관리하세요') + '</div>';
    } else {
      list.innerHTML = anniversaries.map(function(a, i) {
        var bInfo = getBirthdayDisplayInfo(a);
        var icon = (a.type && ANNIV_TYPE_ICONS[a.type]) ? ANNIV_TYPE_ICONS[a.type] : '📅';
        var livedLabel = (a.type && ANNIV_LIVED_LABELS[a.type]) ? ANNIV_LIVED_LABELS[a.type] : '기념일로부터';
        return '<div class="anniversary-item bday-anniv">' +
          '<span class="anniv-type-icon">' + icon + '</span>' +
          '<span class="anniv-name">' + a.name.replace(/</g,'&lt;') + '</span>' +
          '<span class="anniv-bday-date">' + bInfo.bdayLabel + '</span>' +
          '<span class="anniv-bday-sep">|</span>' +
          '<span class="anniv-dday ' + bInfo.ddayCls + '">' + bInfo.ddayText + '</span>' +
          '<span class="anniv-bday-sep">|</span>' +
          '<span class="anniv-bday-lived">' + livedLabel + ' ' + bInfo.livedDays.toLocaleString() + '일</span>' +
          '<button class="anniv-del" onclick="removeAnniversary(' + i + ')" title="삭제">&times;</button>' +
          '</div>';
      }).join('');
    }
    if (addRow) {
      addRow.classList.toggle('hidden', anniversaries.length >= 5);
    }
  }

  // Dashboard
  function renderDashboardList() {
    var dashList = document.getElementById('dashAnnivList');
    var dashAddRow = document.getElementById('dashAddRow');
    if (anniversaries.length === 0) {
      dashList.innerHTML = '<div class="dashboard-empty">기념일을 추가해보세요</div>';
    } else {
      var sorted = anniversaries.map(function(a, i) {
        var bInfo = getBirthdayDisplayInfo(a);
        return { name: a.name, type: a.type, diff: bInfo.daysLeft, idx: i, bInfo: bInfo };
      }).sort(function(a, b) {
        if (a.diff >= 0 && b.diff >= 0) return a.diff - b.diff;
        if (a.diff >= 0) return -1;
        if (b.diff >= 0) return 1;
        return b.diff - a.diff;
      });
      var nearestIdx = sorted[0].idx;
      dashList.innerHTML = sorted.map(function(s) {
        var icon = (s.type && ANNIV_TYPE_ICONS[s.type]) ? ANNIV_TYPE_ICONS[s.type] : '📅';
        var livedLabel = (s.type && ANNIV_LIVED_LABELS[s.type]) ? ANNIV_LIVED_LABELS[s.type] : '기념일로부터';
        var isNearest = (s.idx === nearestIdx && s.diff >= 0) ? ' nearest' : '';
        return '<div class="dashboard-anniv-item bday-anniv' + isNearest + '">' +
          '<span class="anniv-type-icon">' + icon + '</span>' +
          '<span class="dash-name">' + s.name.replace(/</g,'&lt;') + '</span>' +
          '<span class="anniv-bday-date">' + s.bInfo.bdayLabel + '</span>' +
          '<span class="anniv-bday-sep">|</span>' +
          '<span class="dash-dday ' + s.bInfo.ddayCls + '">' + s.bInfo.ddayText + '</span>' +
          '<span class="anniv-bday-sep">|</span>' +
          '<span class="anniv-bday-lived">' + livedLabel + ' ' + s.bInfo.livedDays.toLocaleString() + '일</span>' +
          '<button class="dash-del" onclick="removeAnniversaryFromDash(' + s.idx + ')" title="삭제">&times;</button>' +
          '</div>';
      }).join('');
    }
    if (dashAddRow) dashAddRow.classList.toggle('hidden', anniversaries.length >= 5);
  }

  async function openDashboard() {
    if (!annivLoggedUser) return;
    var users = await loadAnnivUsers();
    var userData = users[annivLoggedUser] || {};
    var email = typeof userData === 'string' ? '' : (userData.email || '');
    document.getElementById('dashUserName').textContent = annivLoggedUser;
    document.getElementById('dashUserEmail').textContent = email || '이메일 미등록';
    renderDashboardList();
    document.getElementById('dashboardOverlay').classList.add('visible');
  }

  function closeDashboard() {
    document.getElementById('dashboardOverlay').classList.remove('visible');
  }

  function addAnniversaryFromDash() {
    if (anniversaries.length >= 5) return;
    var nameEl = document.getElementById('dashAnnivNameInput');
    var typeEl = document.getElementById('dashAnnivTypeSelect');
    var yEl = document.getElementById('dashAnnivYearInput');
    var mEl = document.getElementById('dashAnnivMonthInput');
    var dEl = document.getElementById('dashAnnivDayInput');
    var calEl = document.getElementById('dashAnnivCalSelect');
    var name = nameEl.value.trim();
    var type = typeEl ? typeEl.value : 'birthday';
    var y = parseInt(yEl.value), m = parseInt(mEl.value), d = parseInt(dEl.value);
    var cal = calEl ? calEl.value : 'solar';
    if (!name || !y || !m || !d || m<1||m>12||d<1||d>31) return;
    var date = y+'-'+String(m).padStart(2,'0')+'-'+String(d).padStart(2,'0');
    anniversaries.push({ name: name, type: type, date: date, calendar: cal });
    saveAnniversaries();
    renderAnniversaries();
    renderDashboardList();
    nameEl.value=''; yEl.value=''; mEl.value=''; dEl.value='';
    if(typeEl) typeEl.value='birthday';
    if(calEl) calEl.value='solar';
  }

  function removeAnniversaryFromDash(idx) {
    anniversaries.splice(idx, 1);
    saveAnniversaries();
    renderAnniversaries();
    renderDashboardList();
  }

  // === Power ===
  document.getElementById('powerBtn').addEventListener('click',function(){
    isPowered=!isPowered;
    document.getElementById('powerBtn').classList.toggle('on',isPowered);
    if(!isPowered&&audio){
      audio.pause(); setPlayState(false); currentStation=null;
      document.getElementById('lcdIdle').classList.remove('hidden');
      document.getElementById('lcdActive').classList.remove('visible');
      document.getElementById('antenna').classList.remove('active');
      document.querySelectorAll('.preset-btn').forEach(function(b){b.classList.remove('active');});
      updateSignalBars(false);
      releaseWakeLock();
      updateMediaSession();
    }
  });

  // === Select Station ===
  // === Fortune Engine ===
  var ZODIAC_ANIMALS = ['원숭이','닭','개','돼지','쥐','소','호랑이','토끼','용','뱀','말','양'];
  var ZODIAC_EMOJIS = ['🐵','🐔','🐶','🐷','🐭','🐮','🐯','🐰','🐲','🐍','🐴','🐑'];
  var CONSTELLATIONS = [
    {name:'염소자리',symbol:'♑',s:[12,22],e:[1,19]},
    {name:'물병자리',symbol:'♒',s:[1,20],e:[2,18]},
    {name:'물고기자리',symbol:'♓',s:[2,19],e:[3,20]},
    {name:'양자리',symbol:'♈',s:[3,21],e:[4,19]},
    {name:'황소자리',symbol:'♉',s:[4,20],e:[5,20]},
    {name:'쌍둥이자리',symbol:'♊',s:[5,21],e:[6,21]},
    {name:'게자리',symbol:'♋',s:[6,22],e:[7,22]},
    {name:'사자자리',symbol:'♌',s:[7,23],e:[8,22]},
    {name:'처녀자리',symbol:'♍',s:[8,23],e:[9,22]},
    {name:'천칭자리',symbol:'♎',s:[9,23],e:[10,23]},
    {name:'전갈자리',symbol:'♏',s:[10,24],e:[11,22]},
    {name:'사수자리',symbol:'♐',s:[11,23],e:[12,21]}
  ];
  var FORTUNE_OVERALL = [
    '오늘은 새로운 시작을 위한 좋은 날입니다. 용기를 내어 첫 걸음을 내딛어 보세요.',
    '주변 사람들과의 소통이 행운을 가져다줄 것입니다. 마음을 열어보세요.',
    '오래 미뤄왔던 일을 처리하기에 좋은 날입니다. 하나씩 정리해 나가세요.',
    '작은 변화가 큰 행운으로 이어질 수 있습니다. 일상의 루틴을 바꿔보세요.',
    '직감이 예리해지는 날입니다. 중요한 결정은 첫 느낌을 믿어보세요.',
    '과거의 노력이 결실을 맺기 시작하는 시기입니다. 인내의 보상이 찾아옵니다.',
    '예상치 못한 기회가 찾아올 수 있습니다. 열린 마음으로 받아들이세요.',
    '오늘은 자신을 돌아보는 시간이 필요합니다. 조용한 성찰이 도움이 됩니다.',
    '긍정적인 에너지가 가득한 날입니다. 주변에 좋은 영향을 나눠보세요.',
    '새로운 사람과의 만남이 특별한 인연으로 이어질 수 있습니다.',
    '창의적인 아이디어가 떠오르는 날입니다. 메모하는 습관이 행운을 부릅니다.',
    '꾸준함이 빛을 발하는 시기입니다. 포기하지 말고 계속 나아가세요.',
    '오늘은 감사하는 마음이 더 큰 행복을 가져다줍니다.',
    '자신감을 가지세요. 당신의 능력은 생각보다 훨씬 큽니다.',
    '조급함을 내려놓으면 더 좋은 결과를 얻을 수 있습니다. 여유를 가지세요.',
    '오늘 만나는 사람 중 중요한 조언을 해줄 귀인이 있습니다.',
    '작은 친절이 큰 행운으로 돌아오는 날입니다. 베풀 수 있을 때 베푸세요.',
    '오래된 습관을 바꾸기 좋은 날입니다. 새로운 도전을 시작해 보세요.',
    '마음의 여유가 좋은 판단력으로 이어집니다. 서두르지 마세요.',
    '오늘은 배움의 기회가 많습니다. 호기심을 가지고 새로운 것을 탐구해 보세요.'
  ];
  var FORTUNE_WEALTH = [
    '예상치 못한 곳에서 재물이 들어올 수 있습니다. 기회를 놓치지 마세요.',
    '불필요한 지출을 줄이면 좋은 결과가 있을 것입니다.',
    '투자보다는 저축에 집중하는 것이 현명한 날입니다.',
    '금전적인 행운이 따르는 날입니다. 적극적으로 움직여 보세요.',
    '오늘은 큰 소비를 자제하고 소소한 행복에 집중하세요.',
    '주변의 재정 조언에 귀를 기울이면 도움이 됩니다.',
    '오랫동안 기다리던 금전적 소식이 도착할 수 있습니다.',
    '새로운 수입원을 탐색하기 좋은 날입니다.',
    '계획적인 소비가 장기적으로 큰 도움이 되는 시기입니다.',
    '작은 투자가 큰 수익으로 이어질 수 있습니다. 신중하게 판단하세요.',
    '지갑을 열기 전에 한 번 더 생각하면 후회가 없을 것입니다.',
    '재물운이 상승하는 시기입니다. 자신의 가치를 높이는 데 투자하세요.',
    '오늘은 나눔이 더 큰 재물을 가져다주는 날입니다.',
    '금전 관련 서류를 꼼꼼히 확인하면 이득이 있을 것입니다.',
    '안정적인 재정 관리가 마음의 평화로 이어집니다.',
    '사업 아이디어가 떠오르면 메모해 두세요. 미래에 도움이 됩니다.',
    '절약과 검소함이 미래의 풍요로움을 만들어 냅니다.',
    '예기치 않은 경비가 발생할 수 있으니 여유 자금을 확보해 두세요.',
    '금전적 결정은 감정보다 이성으로 내리는 것이 좋습니다.',
    '꾸준한 노력이 경제적 안정을 가져다줄 것입니다.'
  ];
  var FORTUNE_LOVE = [
    '사랑하는 사람에게 진심을 표현하기 좋은 날입니다.',
    '작은 관심과 배려가 관계를 더욱 깊게 만들어 줍니다.',
    '오해가 있다면 오늘 풀어보세요. 대화가 해결의 열쇠입니다.',
    '새로운 인연을 만날 수 있는 기회가 있습니다. 외출해 보세요.',
    '상대방의 입장에서 생각하면 더 좋은 관계를 만들 수 있습니다.',
    '오늘은 혼자만의 시간이 오히려 관계에 도움이 됩니다.',
    '감사의 마음을 표현하면 사랑이 더 깊어지는 날입니다.',
    '과거의 상처를 내려놓으면 새로운 사랑이 찾아옵니다.',
    '소중한 사람과 특별한 추억을 만들기 좋은 날입니다.',
    '진정한 소통은 말이 아닌 마음으로 하는 것입니다.',
    '오랜 친구에게 연락하면 좋은 소식을 들을 수 있습니다.',
    '사랑은 완벽함이 아닌 있는 그대로를 받아들이는 것입니다.',
    '오늘은 상대의 장점에 집중하면 행복해지는 날입니다.',
    '가족과의 시간이 마음의 안정을 가져다줍니다.',
    '인연은 때가 되면 자연스럽게 찾아옵니다. 조급해하지 마세요.',
    '따뜻한 한마디가 관계의 온도를 높이는 날입니다.',
    '서로의 다름을 존중하면 더 강한 유대감이 생깁니다.',
    '오늘은 사랑보다 우정에서 더 큰 힘을 얻을 수 있습니다.',
    '진심 어린 미소가 최고의 사랑 표현입니다.',
    '관계에서 여유를 가지면 더 좋은 방향으로 흘러갑니다.'
  ];
  var FORTUNE_HEALTH = [
    '가벼운 운동이 몸과 마음 모두에 활력을 줄 것입니다.',
    '충분한 수분 섭취가 오늘의 건강 비결입니다.',
    '스트레스 관리에 신경 쓰면 좋은 날입니다. 깊은 호흡을 해보세요.',
    '규칙적인 식사가 오늘의 에너지를 지켜줍니다.',
    '과로를 피하고 적절한 휴식을 취하는 것이 중요합니다.',
    '산책이나 자연과의 접촉이 치유의 효과를 줍니다.',
    '오늘은 충분한 수면이 내일의 활력을 만들어 줍니다.',
    '명상이나 요가 같은 정적인 활동이 도움이 되는 날입니다.',
    '좋은 음식이 좋은 기운을 가져다줍니다. 건강식을 챙기세요.',
    '스트레칭으로 하루를 시작하면 에너지가 넘치는 하루가 됩니다.',
    '마음의 건강도 신체 건강만큼 중요합니다. 자신을 돌봐주세요.',
    '오늘은 따뜻한 차 한 잔이 최고의 보약입니다.',
    '무리한 운동보다 꾸준한 걷기가 더 효과적인 날입니다.',
    '좋은 자세를 유지하면 몸의 피로가 줄어듭니다.',
    '웃음이 최고의 명약입니다. 오늘 하루 많이 웃어보세요.',
    '비타민이 풍부한 과일을 섭취하면 면역력이 올라갑니다.',
    '디지털 기기에서 눈을 쉬게 하는 시간이 필요합니다.',
    '오늘은 일찍 자고 일찍 일어나는 것이 건강의 비결입니다.',
    '맑은 공기를 마시며 바깥 활동을 하면 기분이 좋아집니다.',
    '건강한 습관 하나를 오늘부터 시작해 보세요. 미래의 자신에게 선물이 됩니다.'
  ];
  var LUCKY_COLORS = [
    {name:'빨강',hex:'#e74c3c'},{name:'파랑',hex:'#3498db'},{name:'초록',hex:'#2ecc71'},
    {name:'노랑',hex:'#f1c40f'},{name:'보라',hex:'#9b59b6'},{name:'분홍',hex:'#e91e8a'},
    {name:'주황',hex:'#e67e22'},{name:'하늘',hex:'#87ceeb'},{name:'금색',hex:'#d4af69'},
    {name:'은색',hex:'#bdc3c7'},{name:'연두',hex:'#a8e06c'},{name:'남색',hex:'#2c3e80'}
  ];

  function getZodiacAnimal(year){ var idx=year%12; return {name:ZODIAC_ANIMALS[idx],emoji:ZODIAC_EMOJIS[idx],idx:idx}; }

  function getConstellation(month,day){
    for(var i=0;i<CONSTELLATIONS.length;i++){
      var c=CONSTELLATIONS[i],sm=c.s[0],sd=c.s[1],em=c.e[0],ed=c.e[1];
      if(sm>em){if((month===sm&&day>=sd)||(month===em&&day<=ed)||month>sm||month<em)return{name:c.name,symbol:c.symbol,idx:i};}
      else{if((month===sm&&day>=sd)||(month===em&&day<=ed)||(month>sm&&month<em))return{name:c.name,symbol:c.symbol,idx:i};}
    }
    return{name:CONSTELLATIONS[0].name,symbol:CONSTELLATIONS[0].symbol,idx:0};
  }

  function seededRandom(seed){var s=seed;return function(){s=(s*9301+49297)%233280;return s/233280;};}

  function lunarToSolar(ly,lm,ld){
    if(typeof LUNAR_DATA==='undefined')return{year:ly,month:lm,day:ld};
    var baseDate=new Date(1900,0,31);var dayOffset=0;
    for(var i=LUNAR_START_YEAR;i<ly;i++)dayOffset+=lunarYearDays(i);
    var leap=leapMonthInLunarYear(ly);var isLeapMonth=false;
    for(var m=1;m<lm;m++){
      if(leap>0&&m===leap)dayOffset+=leapDaysInLunarYear(ly);
      dayOffset+=lunarMonthDays(ly,m);
    }
    dayOffset+=ld-1;
    var result=new Date(baseDate.getTime()+dayOffset*86400000);
    return{year:result.getFullYear(),month:result.getMonth()+1,day:result.getDate()};
  }

  function generateFortune(userData){
    var by=userData.birthYear,bm=userData.birthMonth,bd=userData.birthDay,bc=userData.birthCalendar;
    var zodiac=getZodiacAnimal(bc==='lunar'?by:by);
    var solarDate=(bc==='lunar')?lunarToSolar(by,bm,bd):{year:by,month:bm,day:bd};
    var constellation=getConstellation(solarDate.month,solarDate.day);
    var now=new Date();var dateNum=now.getFullYear()*10000+(now.getMonth()+1)*100+now.getDate();
    var seed=dateNum*144+zodiac.idx*12+constellation.idx;
    var rng=seededRandom(seed);
    return{
      zodiac:zodiac,constellation:constellation,
      overall:FORTUNE_OVERALL[Math.floor(rng()*FORTUNE_OVERALL.length)],
      wealth:FORTUNE_WEALTH[Math.floor(rng()*FORTUNE_WEALTH.length)],
      love:FORTUNE_LOVE[Math.floor(rng()*FORTUNE_LOVE.length)],
      health:FORTUNE_HEALTH[Math.floor(rng()*FORTUNE_HEALTH.length)],
      luckyNumber:Math.floor(rng()*45)+1,
      luckyColor:LUCKY_COLORS[Math.floor(rng()*LUCKY_COLORS.length)],
      score:Math.floor(rng()*41)+60
    };
  }

  function openFortuneModal(){
    var loggedUser = annivLoggedUser || sessionStorage.getItem('radioUsername');
    if(!loggedUser){
      document.getElementById('fortuneContent').innerHTML=
        '<div class="fortune-login-msg">운세를 확인하려면<br>로그인이 필요합니다.</div>';
      document.getElementById('fortuneOverlay').classList.add('visible');
      return;
    }
    loadAnnivUsers().then(function(users){
      var ud=users[loggedUser];
      if(!ud||!ud.birthYear){
        document.getElementById('fortuneContent').innerHTML=
          '<div class="fortune-login-msg">생년월일이 등록되지 않은 계정입니다.<br><br>index.html에서 재등록하거나<br>관리자에게 문의해주세요.</div>';
        document.getElementById('fortuneOverlay').classList.add('visible');
        return;
      }
      var f=generateFortune(ud);
      var now=new Date();
      var dateStr=now.getFullYear()+'년 '+(now.getMonth()+1)+'월 '+now.getDate()+'일';
      var html='<div class="fortune-date">'+dateStr+'</div>';
      html+='<div class="fortune-zodiac-box">';
      html+='<div class="fortune-zodiac-item"><span class="fortune-zodiac-emoji">'+f.zodiac.emoji+'</span>';
      html+='<span class="fortune-zodiac-name">'+f.zodiac.name+'띠</span>';
      html+='<span class="fortune-zodiac-sub">'+ud.birthYear+'년생</span></div>';
      html+='<div class="fortune-zodiac-item"><span class="fortune-zodiac-emoji">'+f.constellation.symbol+'</span>';
      html+='<span class="fortune-zodiac-name">'+f.constellation.name+'</span>';
      html+='<span class="fortune-zodiac-sub">'+ud.birthMonth+'월 '+ud.birthDay+'일</span></div>';
      html+='</div>';
      html+='<div class="fortune-score-wrap"><div class="fortune-score-label">TODAY\'S SCORE</div>';
      html+='<div class="fortune-score-num">'+f.score+'</div>';
      html+='<div class="fortune-score-bar"><div class="fortune-score-fill" style="width:'+f.score+'%"></div></div></div>';
      html+='<div class="fortune-categories">';
      html+='<div class="fortune-cat-card"><div class="fortune-cat-header"><span class="fortune-cat-icon">⭐</span><span class="fortune-cat-title">총운</span></div><div class="fortune-cat-text">'+f.overall+'</div></div>';
      html+='<div class="fortune-cat-card"><div class="fortune-cat-header"><span class="fortune-cat-icon">💰</span><span class="fortune-cat-title">재물운</span></div><div class="fortune-cat-text">'+f.wealth+'</div></div>';
      html+='<div class="fortune-cat-card"><div class="fortune-cat-header"><span class="fortune-cat-icon">💕</span><span class="fortune-cat-title">애정운</span></div><div class="fortune-cat-text">'+f.love+'</div></div>';
      html+='<div class="fortune-cat-card"><div class="fortune-cat-header"><span class="fortune-cat-icon">💪</span><span class="fortune-cat-title">건강운</span></div><div class="fortune-cat-text">'+f.health+'</div></div>';
      html+='</div>';
      html+='<div class="fortune-lucky-row">';
      html+='<div class="fortune-lucky-card"><div class="fortune-lucky-label">LUCKY NUMBER</div><div class="fortune-lucky-value">'+f.luckyNumber+'</div></div>';
      html+='<div class="fortune-lucky-card"><div class="fortune-lucky-label">LUCKY COLOR</div><div class="fortune-lucky-value"><span class="fortune-lucky-color-dot" style="background:'+f.luckyColor.hex+'"></span>'+f.luckyColor.name+'</div></div>';
      html+='</div>';
      document.getElementById('fortuneContent').innerHTML=html;
      document.getElementById('fortuneOverlay').classList.add('visible');
    });
  }

  function closeFortune(){
    document.getElementById('fortuneOverlay').classList.remove('visible');
  }

  // === Tarot Engine ===
  var TAROT_CARDS = [
    {num:0,name:'바보',symbol:'🃏',meaning:'새로운 시작, 순수함, 모험',
     past:['과거에 두려움 없이 새로운 길을 선택한 경험이 지금의 당신을 만들었습니다.','순수한 마음으로 도전했던 과거의 용기가 오늘의 밑거름이 되었습니다.','한때 무모해 보였던 선택이 결국 최고의 결정이었음을 기억하세요.'],
     present:['지금은 틀에 박힌 생각을 내려놓고 자유롭게 행동할 때입니다. 직감을 믿으세요.','계산을 멈추고 마음이 이끄는 대로 움직여 보세요. 뜻밖의 길이 열립니다.','완벽한 준비보다 첫 발걸음이 중요합니다. 가벼운 마음으로 시작하세요.'],
     future:['예상치 못한 새로운 기회가 찾아올 것입니다. 열린 마음으로 받아들이세요.','곧 인생의 새로운 장이 펼쳐질 것입니다. 모험을 두려워하지 마세요.','미지의 세계가 당신을 기다립니다. 호기심을 따라가면 놀라운 발견이 있을 것입니다.']},
    {num:1,name:'마법사',symbol:'🧙',meaning:'창조력, 의지력, 능력',
     past:['당신이 가진 재능과 기술이 과거의 성공을 이끌어왔습니다.','과거에 발휘한 창의력과 집중력이 탄탄한 토대를 만들었습니다.','어려운 상황에서도 지혜롭게 해결해온 경험이 쌓여 있습니다.'],
     present:['지금 가진 자원과 능력을 최대한 활용하세요. 모든 도구가 준비되어 있습니다.','당신 안에 잠든 잠재력을 깨울 시간입니다. 자신의 능력을 과소평가하지 마세요.','창조적 에너지가 최고조인 시기입니다. 아이디어를 행동으로 옮기세요.'],
     future:['당신의 의지와 집중력이 원하는 결과를 만들어낼 것입니다.','숙련된 기술이 빛을 발해 목표를 달성하게 될 것입니다.','당신만의 독창적인 방법으로 큰 성과를 이루게 됩니다.']},
    {num:2,name:'여사제',symbol:'🌙',meaning:'직관, 지혜, 내면의 목소리',
     past:['과거에 느꼈던 직감이 옳았음을 깨닫게 될 것입니다.','조용히 관찰하며 쌓아온 통찰력이 지금의 지혜가 되었습니다.','감추어진 지식을 탐구했던 과거가 깊은 이해력을 선물했습니다.'],
     present:['논리보다 직감을 따르세요. 내면의 목소리가 정답을 알고 있습니다.','마음을 고요히 하고 내면의 소리에 집중하세요. 답은 이미 안에 있습니다.','겉으로 보이는 것 너머를 살피세요. 숨겨진 의미가 중요합니다.'],
     future:['숨겨진 진실이 곧 드러날 것입니다. 인내심을 가지고 기다리세요.','직관이 당신을 올바른 방향으로 이끌 것입니다. 내면의 지혜를 신뢰하세요.','아직 보이지 않는 기회가 서서히 모습을 드러낼 것입니다.']},
    {num:3,name:'여황제',symbol:'👑',meaning:'풍요, 모성, 자연의 축복',
     past:['사랑과 돌봄을 받았던 경험이 당신의 따뜻한 마음을 키웠습니다.','풍요로운 환경에서 자란 감성이 삶의 아름다움을 느끼게 해줍니다.','과거에 베풀었던 사랑이 씨앗이 되어 지금 열매를 맺고 있습니다.'],
     present:['주변 사람들에게 따뜻함을 나누세요. 베풀수록 더 많이 돌아옵니다.','자연과 교감하는 시간을 가지세요. 치유와 영감을 얻게 됩니다.','창의적인 프로젝트를 시작하기에 최적의 시기입니다. 감성이 꽃피고 있습니다.'],
     future:['풍요롭고 안정적인 시기가 다가오고 있습니다. 감사하는 마음을 잊지 마세요.','사랑과 행복이 가득한 시간이 찾아올 것입니다.','당신이 가꾸어온 것들이 아름답게 결실을 맺을 것입니다.']},
    {num:4,name:'황제',symbol:'🏛️',meaning:'권위, 안정, 리더십',
     past:['규율과 질서를 중시했던 경험이 탄탄한 기반을 만들었습니다.','과거에 보여준 책임감과 리더십이 주변의 신뢰를 얻었습니다.','체계적으로 쌓아온 경험과 실력이 든든한 자산이 되었습니다.'],
     present:['지금은 체계적으로 계획하고 실행할 때입니다. 리더십을 발휘하세요.','확고한 결단력이 필요한 시기입니다. 흔들림 없이 나아가세요.','주도적으로 상황을 이끌어가세요. 당신의 판단을 믿어도 됩니다.'],
     future:['노력의 결실로 안정적인 지위를 얻게 될 것입니다.','당신의 리더십이 인정받아 더 큰 역할을 맡게 될 것입니다.','견고한 기반 위에 성공을 쌓아갈 수 있는 때가 옵니다.']},
    {num:5,name:'교황',symbol:'🙏',meaning:'전통, 가르침, 영적 성장',
     past:['멘토나 스승의 가르침이 당신의 성장에 큰 영향을 주었습니다.','전통과 가치관이 삶의 나침반이 되어왔습니다.','공동체 안에서 배운 교훈이 지혜의 원천이 되었습니다.'],
     present:['배움의 자세를 유지하세요. 좋은 조언자를 만날 수 있는 시기입니다.','마음을 열고 주변의 지혜로운 목소리에 귀 기울이세요.','영적인 성장을 추구하면 일상에서도 평화를 찾게 됩니다.'],
     future:['정신적 성장과 깨달음이 찾아올 것입니다.','당신의 경험이 누군가에게 소중한 가르침이 될 것입니다.','신념을 지켜나가면 삶의 의미를 더 깊이 발견하게 됩니다.']},
    {num:6,name:'연인',symbol:'💑',meaning:'사랑, 조화, 선택',
     past:['중요한 선택의 순간이 지금의 관계를 만들어냈습니다.','과거의 사랑과 유대가 마음 깊은 곳에 아름다운 기억으로 남아있습니다.','진심을 다해 관계를 맺어온 경험이 깊은 유대감을 형성했습니다.'],
     present:['마음의 소리에 귀 기울이세요. 진정한 사랑과 조화를 추구할 때입니다.','중요한 선택의 기로에 서 있습니다. 가슴이 원하는 방향을 따르세요.','소중한 사람과 더 깊이 소통하면 관계가 한 단계 성장합니다.'],
     future:['의미 있는 인연이 더욱 깊어지거나 새로운 인연이 찾아올 것입니다.','사랑과 조화가 당신의 삶에 큰 기쁨을 가져다줄 것입니다.','마음을 열면 운명적인 만남이나 화합의 순간이 찾아옵니다.']},
    {num:7,name:'전차',symbol:'⚡',meaning:'승리, 전진, 결단력',
     past:['강한 의지로 장애물을 극복해온 당신의 노력이 빛나고 있습니다.','포기하지 않고 달려온 과거의 추진력이 오늘의 성과를 만들었습니다.','방향을 정하고 돌진했던 결단력이 큰 변화를 이끌어냈습니다.'],
     present:['망설이지 말고 과감하게 전진하세요. 승리가 가까이 있습니다.','지금이 최대한 속도를 내야 할 때입니다. 집중력을 발휘하세요.','장애물이 있어도 멈추지 마세요. 돌파할 힘이 당신 안에 있습니다.'],
     future:['목표를 향한 끈기가 큰 성과로 이어질 것입니다.','곧 중요한 승리의 순간이 찾아옵니다. 자신감을 잃지 마세요.','빠른 진전과 함께 원하는 목적지에 도달하게 될 것입니다.']},
    {num:8,name:'힘',symbol:'🦁',meaning:'용기, 인내, 내면의 강인함',
     past:['어려운 시기를 견뎌낸 경험이 당신을 더 강하게 만들었습니다.','부드럽지만 단단한 의지로 역경을 이겨낸 과거가 있습니다.','감정을 다스리며 성숙해온 과정이 내면의 힘을 키웠습니다.'],
     present:['부드러운 힘으로 상황을 다스리세요. 인내가 최고의 무기입니다.','강압이 아닌 이해와 공감으로 문제를 풀어가세요.','자신의 감정을 먼저 돌보세요. 내면이 평화로우면 외부도 안정됩니다.'],
     future:['내면의 강인함이 외부의 도전을 극복하게 해줄 것입니다.','꾸준한 인내가 결국 가장 큰 힘임을 증명하게 될 것입니다.','어떤 시련이 와도 당신은 충분히 이겨낼 수 있습니다.']},
    {num:9,name:'은둔자',symbol:'🏔️',meaning:'성찰, 내면 탐구, 지혜',
     past:['혼자만의 시간이 깊은 깨달음을 가져다주었습니다.','고독 속에서 자신을 마주했던 경험이 지혜를 선물했습니다.','남들과 다른 길을 걸으며 얻은 통찰이 소중한 자산입니다.'],
     present:['잠시 멈추고 자신을 돌아보는 시간이 필요합니다. 명상이 도움됩니다.','소음에서 벗어나 조용한 공간에서 생각을 정리하세요.','혼자만의 시간이 지금 가장 필요한 치유입니다.'],
     future:['내면의 탐구가 인생의 방향을 밝혀줄 것입니다.','고요한 성찰 끝에 삶의 진정한 목적을 발견하게 됩니다.','지혜로운 판단이 미래의 중요한 전환점을 만들 것입니다.']},
    {num:10,name:'운명의 수레바퀴',symbol:'🎡',meaning:'변화, 순환, 행운',
     past:['인생의 부침을 경험하며 성장해왔습니다.','과거의 우연한 사건들이 연결되어 지금의 자리로 이끌었습니다.','좋은 때와 힘든 때를 모두 겪으며 단단해졌습니다.'],
     present:['변화의 흐름에 몸을 맡기세요. 운명이 좋은 방향으로 돌아가고 있습니다.','지금 일어나는 변화를 저항하지 말고 자연스럽게 받아들이세요.','예상치 못한 전환점이 다가오고 있습니다. 유연하게 대처하세요.'],
     future:['행운의 바퀴가 돌아 좋은 기회가 찾아올 것입니다.','운명의 흐름이 당신에게 유리하게 바뀌고 있습니다.','순환의 법칙대로 힘든 시기가 지나면 풍요로운 때가 옵니다.']},
    {num:11,name:'정의',symbol:'⚖️',meaning:'공정, 진실, 균형',
     past:['올바른 판단과 공정한 행동이 신뢰를 쌓아왔습니다.','양심에 따라 행동했던 과거가 오늘의 평판을 만들었습니다.','공과 사를 구분하며 살아온 태도가 존경을 받고 있습니다.'],
     present:['어떤 결정이든 진실과 공정함을 기준으로 삼으세요.','균형 잡힌 시각으로 상황을 판단하면 최선의 답을 찾을 수 있습니다.','지금은 감정보다 이성적 판단이 더 나은 결과를 가져옵니다.'],
     future:['정직한 노력에 대한 정당한 보상이 찾아올 것입니다.','진실은 반드시 밝혀지고, 올바른 것이 승리하게 됩니다.','공정한 결과가 당신에게 유리하게 작용할 것입니다.']},
    {num:12,name:'매달린 사람',symbol:'🔮',meaning:'인내, 새로운 관점, 희생',
     past:['포기하고 싶었던 순간에도 견딘 것이 현명한 선택이었습니다.','기꺼이 희생했던 과거가 더 큰 가치를 만들어냈습니다.','멈춤의 시간이 새로운 시각을 선물해준 경험이 있습니다.'],
     present:['상황을 다른 각도에서 바라보세요. 새로운 관점이 해답을 줍니다.','지금은 행동보다 기다림이 더 현명한 시기입니다.','익숙한 방식을 잠시 내려놓으면 전혀 다른 가능성이 보입니다.'],
     future:['잠시 기다림의 시간이 더 큰 보상으로 이어질 것입니다.','지금의 인내가 미래에 큰 전환점을 만들어줄 것입니다.','다른 관점에서 본 세상이 새로운 기회를 열어줄 것입니다.']},
    {num:13,name:'죽음',symbol:'🦋',meaning:'변환, 끝과 시작, 재탄생',
     past:['과거의 한 장이 끝나면서 새로운 시작이 열렸습니다.','큰 변화를 겪으며 완전히 새로운 사람으로 성장했습니다.','과거를 보내준 용기가 지금의 자유를 선물했습니다.'],
     present:['낡은 것을 과감히 놓아주세요. 끝은 곧 새로운 시작입니다.','변화를 받아들이세요. 나비가 되려면 고치를 벗어야 합니다.','지금 무언가를 끝내야 할 시점입니다. 미련을 내려놓으세요.'],
     future:['큰 변화가 찾아오지만 그것은 더 나은 미래를 위한 것입니다.','끝이라 생각했던 곳에서 전혀 새로운 시작이 펼쳐질 것입니다.','재탄생의 에너지가 당신의 삶을 완전히 새롭게 바꿀 것입니다.']},
    {num:14,name:'절제',symbol:'🌊',meaning:'균형, 조화, 절도',
     past:['균형 잡힌 삶의 태도가 안정을 가져다주었습니다.','과하지도 부족하지도 않게 조절해온 지혜가 빛납니다.','서로 다른 것을 조화시키는 능력이 많은 문제를 해결해왔습니다.'],
     present:['극단을 피하고 중용의 길을 걸으세요. 조화가 답입니다.','급하지 않게 한 걸음씩 나아가세요. 서두를수록 멀어집니다.','다양한 요소들의 균형을 맞추면 최고의 결과가 나옵니다.'],
     future:['인내와 절제가 원하는 결과를 이끌어낼 것입니다.','조화로운 접근이 모든 일을 순조롭게 풀어줄 것입니다.','균형을 유지하면 안정적이고 지속적인 성장을 이루게 됩니다.']},
    {num:15,name:'악마',symbol:'⛓️',meaning:'유혹, 집착, 해방',
     past:['한때 집착했던 것에서 벗어난 경험이 성장의 계기가 되었습니다.','과거의 유혹에 빠졌던 경험이 지금의 분별력을 키워주었습니다.','억눌려 있던 감정을 인정했을 때 비로소 자유를 얻었습니다.'],
     present:['자신을 묶고 있는 것이 무엇인지 직면하세요. 해방의 첫걸음입니다.','두려움이나 집착이 당신을 가두고 있지 않은지 점검하세요.','사슬은 생각보다 느슨합니다. 벗어나려는 의지만 있으면 됩니다.'],
     future:['집착을 내려놓으면 진정한 자유를 얻게 될 것입니다.','속박에서 벗어나 더 넓은 세상을 경험하게 될 것입니다.','내면의 그림자를 받아들이면 더 온전한 자신이 될 수 있습니다.']},
    {num:16,name:'탑',symbol:'🌩️',meaning:'급변, 각성, 진실의 드러남',
     past:['예상치 못한 사건이 삶의 전환점이 되었습니다.','무너졌던 경험이 더 강한 기반을 세우는 계기가 되었습니다.','충격적인 변화가 결국 필요한 각성을 가져다주었습니다.'],
     present:['변화를 두려워하지 마세요. 허물어져야 새로 세울 수 있습니다.','불안정한 것은 무너져야 진짜가 남습니다. 진실을 마주하세요.','지금의 혼란은 더 나은 것을 세우기 위한 과정입니다.'],
     future:['갑작스러운 변화가 오지만 결국 더 나은 상황으로 이끌 것입니다.','파괴 속에서 새로운 가능성이 싹틀 것입니다.','예상 밖의 사건이 진정으로 중요한 것을 깨닫게 해줄 것입니다.']},
    {num:17,name:'별',symbol:'⭐',meaning:'희망, 영감, 치유',
     past:['어둠 속에서도 희망을 잃지 않았던 것이 당신의 강점입니다.','과거에 품었던 꿈이 지금도 내면에서 빛나고 있습니다.','힘든 시기를 지나며 스스로를 치유해온 회복력이 대단합니다.'],
     present:['꿈과 희망을 품으세요. 우주가 당신의 소원을 듣고 있습니다.','영감이 샘솟는 시기입니다. 창작과 표현에 집중하세요.','상처가 치유되고 있습니다. 자신에게 시간을 허락하세요.'],
     future:['밝은 미래가 기다리고 있습니다. 희망의 빛이 가까이 있습니다.','꿈꿔왔던 것이 현실이 되는 아름다운 시간이 올 것입니다.','영감과 평화가 가득한 시기가 곧 찾아옵니다.']},
    {num:18,name:'달',symbol:'🌕',meaning:'환상, 불안, 잠재의식',
     past:['불확실한 시기를 지나오면서 직관력이 강해졌습니다.','과거의 불안했던 경험이 오히려 세심한 감수성을 키워주었습니다.','꿈과 상상의 세계에서 얻은 영감이 창의력의 원천이 되었습니다.'],
     present:['모든 것이 보이는 그대로가 아닐 수 있습니다. 신중하게 판단하세요.','불안한 마음이 들더라도 흔들리지 마세요. 감정의 파도는 지나갑니다.','잠재의식이 보내는 신호에 주의를 기울이세요. 꿈이 힌트를 줍니다.'],
     future:['안개가 걷히면 진실이 드러날 것입니다. 조금만 더 기다리세요.','혼란스러운 시기가 지나면 더욱 선명한 길이 보일 것입니다.','직관이 점점 강해져 올바른 방향을 찾게 될 것입니다.']},
    {num:19,name:'태양',symbol:'☀️',meaning:'성공, 활력, 행복',
     past:['밝고 긍정적인 에너지가 좋은 결과를 가져다주었습니다.','행복했던 순간들이 마음속에 따뜻한 빛으로 남아있습니다.','낙천적인 태도로 어려움을 이겨낸 경험이 빛나고 있습니다.'],
     present:['자신감을 가지세요. 모든 것이 순조롭게 흘러가고 있습니다.','활력이 넘치는 시기입니다. 에너지를 긍정적인 곳에 쏟으세요.','당신의 밝은 에너지가 주변 사람들에게도 행복을 전파하고 있습니다.'],
     future:['큰 성공과 행복이 찾아올 것입니다. 밝은 날이 다가옵니다.','기쁨과 축복이 가득한 시기가 곧 열릴 것입니다.','모든 노력이 빛나는 결과로 돌아오는 화려한 시간이 옵니다.']},
    {num:20,name:'심판',symbol:'📯',meaning:'각성, 부활, 결단',
     past:['인생의 중요한 교훈을 배우며 성장해왔습니다.','과거의 경험을 돌아보며 새로운 깨달음을 얻었습니다.','결정적 순간마다 내린 결단이 지금의 당신을 형성했습니다.'],
     present:['과거를 돌아보고 새로운 결심을 할 때입니다. 진정한 소명을 찾으세요.','지난 일을 정리하고 새 출발을 준비하세요. 부활의 시간입니다.','중요한 결단의 순간입니다. 진심으로 원하는 것이 무엇인지 물어보세요.'],
     future:['새로운 기회가 찾아와 인생의 새 장이 열릴 것입니다.','과거의 경험이 모여 인생의 전환점을 만들게 될 것입니다.','각성의 순간이 오면 삶의 목적이 뚜렷해질 것입니다.']},
    {num:21,name:'세계',symbol:'🌍',meaning:'완성, 성취, 통합',
     past:['오랜 여정의 결과가 하나의 완성으로 이어져왔습니다.','다양한 경험이 통합되어 풍요로운 내면을 만들어왔습니다.','끊임없는 노력이 하나의 큰 성취로 모아져왔습니다.'],
     present:['모든 것이 제자리를 찾아가고 있습니다. 성취의 기쁨을 누리세요.','하나의 순환이 완성되고 있습니다. 지금 이 순간을 축하하세요.','모든 조각이 맞춰지고 있습니다. 큰 그림을 바라보세요.'],
     future:['목표의 완성과 함께 더 큰 세계가 펼쳐질 것입니다.','대단원의 성취 이후 새로운 차원의 여정이 시작될 것입니다.','꿈꿔왔던 완성의 순간이 다가오고 있습니다. 곧 결실을 봅니다.']}
  ];

  function generateTarot(userData){
    var now=new Date();var dateNum=now.getFullYear()*10000+(now.getMonth()+1)*100+now.getDate();
    var userSeed=0;
    if(userData&&userData.birthYear) userSeed=userData.birthYear*100+userData.birthMonth;
    var seed=dateNum*997+userSeed*31+7;
    var rng=seededRandom(seed);

    var deck=[]; for(var i=0;i<22;i++) deck.push(i);
    var cards=[];
    var posFields=['past','present','future'];
    for(var j=0;j<3;j++){
      var idx=Math.floor(rng()*deck.length);
      var card=TAROT_CARDS[deck[idx]];
      var vi=Math.floor(rng()*3);
      cards.push({num:card.num,name:card.name,symbol:card.symbol,meaning:card.meaning,
        reading:card[posFields[j]][vi]});
      deck.splice(idx,1);
    }
    return cards;
  }

  function openTarotModal(){
    var loggedUser=annivLoggedUser||sessionStorage.getItem('radioUsername');
    if(!loggedUser){
      document.getElementById('tarotContent').innerHTML=
        '<div class="tarot-login-msg">타로를 보려면<br>로그인이 필요합니다.</div>';
      document.getElementById('tarotOverlay').classList.add('visible');
      return;
    }
    loadAnnivUsers().then(function(users){
      var ud=users[loggedUser]||{};
      var cards=generateTarot(ud);
      var positions=['PAST','PRESENT','FUTURE'];
      var posKor=['과거','현재','미래'];
      var now=new Date();
      var dateStr=now.getFullYear()+'년 '+(now.getMonth()+1)+'월 '+now.getDate()+'일';
      var html='<div class="tarot-date">'+dateStr+'</div>';
      html+='<div class="tarot-spread">';
      for(var i=0;i<3;i++){
        html+='<div class="tarot-card-slot">';
        html+='<div class="tarot-card">';
        html+='<div class="tarot-card-num">'+positions[i]+'</div>';
        html+='<div class="tarot-card-symbol">'+cards[i].symbol+'</div>';
        html+='<div class="tarot-card-name">'+cards[i].name+'</div>';
        html+='</div>';
        html+='<div class="tarot-card-position">'+posKor[i]+'</div>';
        html+='</div>';
      }
      html+='</div>';
      html+='<div class="tarot-readings">';
      for(var k=0;k<3;k++){
        html+='<div class="tarot-reading-card">';
        html+='<div class="tarot-reading-header">';
        html+='<span class="tarot-reading-pos">'+posKor[k]+'</span>';
        html+='<span class="tarot-reading-name">'+cards[k].symbol+' '+cards[k].name+' — '+cards[k].meaning+'</span>';
        html+='</div>';
        html+='<div class="tarot-reading-text">'+cards[k].reading+'</div>';
        html+='</div>';
      }
      html+='</div>';
      document.getElementById('tarotContent').innerHTML=html;
      document.getElementById('tarotOverlay').classList.add('visible');
    });
  }

  function closeTarot(){
    document.getElementById('tarotOverlay').classList.remove('visible');
  }

  function selectStation(id){
    if(!isPowered){isPowered=true;document.getElementById('powerBtn').classList.add('on');}
    var station=STATIONS.find(function(s){return s.id===id;});
    if(!station||station.empty)return;
    if(station.isFortune){openFortuneModal();return;}
    if(station.isTarot){openTarotModal();return;}
    currentStation=station;
    document.querySelectorAll('.preset-btn').forEach(function(b){b.classList.toggle('active',b.dataset.id===id);});
    document.getElementById('lcdIdle').classList.add('hidden');
    document.getElementById('lcdActive').classList.add('visible');
    document.getElementById('lcdProvider').textContent=station.provider;
    document.getElementById('lcdName').textContent=station.name;
    document.getElementById('lcdFreq').textContent=station.freq;
    document.getElementById('lcdStatusText').innerHTML='LOADING...';
    document.getElementById('antenna').classList.add('active');
    var pos=((station.freqNum-88)/20)*90+5;
    document.getElementById('tuningNeedle').style.left=pos+'%';
    updateSignalBars(true);
    resolveAndLoadStream(station);
  }

  function updateSignalBars(active){
    document.querySelectorAll('.lcd-signal-bar').forEach(function(bar,i){
      if(active) setTimeout(function(){bar.classList.add('active');},i*150);
      else bar.classList.remove('active');
    });
  }

  // === Background Playback Support ===
  var wakeLockSentinel = null;

  function updateMediaSession() {
    if (!('mediaSession' in navigator)) return;
    var stName = currentStation ? currentStation.name : '클라라 라디오카페';
    var stProvider = currentStation ? currentStation.provider : '';
    navigator.mediaSession.metadata = new MediaMetadata({
      title: stName,
      artist: stProvider || '클라라 라디오카페',
      album: '클라라 라디오카페',
      artwork: [
        { src: 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="128" height="128" rx="20" fill="%23333"/><text x="64" y="72" text-anchor="middle" font-size="48" fill="%23ffd700">📻</text></svg>'), sizes: '128x128', type: 'image/svg+xml' }
      ]
    });
    navigator.mediaSession.playbackState = isPlaying ? 'playing' : 'paused';
    navigator.mediaSession.setActionHandler('play', function() {
      if (currentStation && isPowered) {
        loadStream(currentStation.url);
      }
    });
    navigator.mediaSession.setActionHandler('pause', function() {
      if (audio) { audio.pause(); }
      setPlayState(false);
      updateMediaSession();
      document.getElementById('lcdStatusText').innerHTML = 'PAUSED';
    });
    navigator.mediaSession.setActionHandler('stop', function() {
      if (audio) { audio.pause(); audio.src = ''; }
      if (hlsInstance) { hlsInstance.destroy(); hlsInstance = null; }
      setPlayState(false);
      updateMediaSession();
    });
  }

  async function requestWakeLock() {
    if (!('wakeLock' in navigator)) return;
    try {
      wakeLockSentinel = await navigator.wakeLock.request('screen');
      wakeLockSentinel.addEventListener('release', function() {
        wakeLockSentinel = null;
      });
    } catch(e) {}
  }

  function releaseWakeLock() {
    if (wakeLockSentinel) {
      wakeLockSentinel.release();
      wakeLockSentinel = null;
    }
  }

  // === Resolve & Load Stream ===
  function resolveAndLoadStream(station){
    if(station.apiUrl){
      fetch(station.apiUrl).then(function(r){return r.json();}).then(function(data){
        if(data.channel_item&&data.channel_item[0]&&data.channel_item[0].service_url){
          station.url=data.channel_item[0].service_url;
          loadStream(station.url);
        } else { setError('스트림 URL을 가져올 수 없습니다'); setLoadingState(false); }
      }).catch(function(){setError('API 연결 실패');setLoadingState(false);});
    } else {
      loadStream(station.url);
    }
  }

  // === Audio ===
  function loadStream(url){
    setError(null); setLoadingState(true);
    if(hlsInstance){hlsInstance.destroy();hlsInstance=null;}
    if(!audio) {
      audio=new Audio();
      audio.addEventListener('pause', function() {
        if (isPlaying && isPowered && currentStation) {
          audio.play().catch(function(){});
        }
      });
    }
    initAudioContext();
    connectAudioSource();
    if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    audio.pause(); audio.src=''; audio.volume=volume;
    var isHlsUrl = url.includes('.m3u8');
    if(Hls.isSupported()&&isHlsUrl){
      hlsInstance=new Hls(); hlsInstance.loadSource(url); hlsInstance.attachMedia(audio);
      hlsInstance.on(Hls.Events.MANIFEST_PARSED,function(){
        audio.play().catch(function(e){console.error('Playback failed:',e);setPlayState(false);});
        setPlayState(true);setLoadingState(false);
        document.getElementById('lcdStatusText').innerHTML='<span class=\"on-air-dot\"></span>ON AIR';
      });
      hlsInstance.on(Hls.Events.ERROR,function(_,data){
        if(data.fatal){setError('방송을 불러올 수 없습니다');setLoadingState(false);setPlayState(false);
        document.getElementById('lcdStatusText').innerHTML='ERROR';updateSignalBars(false);}
      });
    } else if(audio.canPlayType&&audio.canPlayType('application/vnd.apple.mpegurl')&&isHlsUrl){
      audio.src=url;
      audio.addEventListener('loadedmetadata',function h(){audio.removeEventListener('loadedmetadata',h);
        audio.play().catch(function(e){console.error('Playback failed:',e);setPlayState(false);});
        setPlayState(true);setLoadingState(false);
        document.getElementById('lcdStatusText').innerHTML='<span class=\"on-air-dot\"></span>ON AIR';
      });
    } else {
      audio.src=url;
      audio.addEventListener('canplay',function cp(){audio.removeEventListener('canplay',cp);
        audio.play().catch(function(e){console.error('Playback failed:',e);setPlayState(false);});
        setPlayState(true);setLoadingState(false);
        document.getElementById('lcdStatusText').innerHTML='<span class=\"on-air-dot\"></span>ON AIR';
      });
      audio.addEventListener('error',function er(){audio.removeEventListener('error',er);
        setError('방송을 불러올 수 없습니다');setLoadingState(false);setPlayState(false);
        document.getElementById('lcdStatusText').innerHTML='ERROR';updateSignalBars(false);
      });
      audio.load();
    }
    updateMediaSession();
    requestWakeLock();
  }

  function togglePlay(){
    if(!audio||!currentStation)return;
    if(isPlaying){audio.pause();setPlayState(false);document.getElementById('lcdStatusText').innerHTML='PAUSED';releaseWakeLock();updateMediaSession();}
    else{audio.play().catch(console.error);setPlayState(true);document.getElementById('lcdStatusText').innerHTML='<span class=\"on-air-dot\"></span>ON AIR';requestWakeLock();updateMediaSession();}
  }

  function setPlayState(playing){
    isPlaying=playing;
    document.getElementById('playIcon').style.display=(!playing&&!isLoading)?'block':'none';
    document.getElementById('pauseIcon').style.display=(playing&&!isLoading)?'block':'none';
    document.getElementById('loaderIcon').style.display=isLoading?'block':'none';
    document.getElementById('playBtn').classList.toggle('playing',playing);
    document.querySelectorAll('.eq-bar').forEach(function(b){b.classList.toggle('playing',playing);});
  }

  function setLoadingState(loading){
    isLoading=loading;
    document.getElementById('playIcon').style.display=(!isPlaying&&!loading)?'block':'none';
    document.getElementById('pauseIcon').style.display=(isPlaying&&!loading)?'block':'none';
    document.getElementById('loaderIcon').style.display=loading?'block':'none';
    document.getElementById('playBtn').disabled=loading;
  }

  function setError(msg){
    var el=document.getElementById('errorMsg');
    if(msg){el.textContent=msg;el.classList.add('visible');}
    else{el.textContent='';el.classList.remove('visible');}
  }

  // === Web Audio API - EQ / Woofer / Virtualizer ===
  var audioCtx = null;
  var sourceNode = null;
  var eqFilters = [];
  var bassBoostFilter = null;
  var virtualizerGain = null;
  var virtualizerDelay = null;
  var masterGain = null;
  var EQ_FREQS = [60, 230, 910, 3600, 14000];
  var eqValues = [0,0,0,0,0];
  var wooferValue = 0;
  var virtualizerValue = 0;

  function initAudioContext(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // Create 5-band EQ filters
    EQ_FREQS.forEach(function(freq, i){
      var filter = audioCtx.createBiquadFilter();
      filter.type = 'peaking';
      filter.frequency.value = freq;
      filter.Q.value = 1.4;
      filter.gain.value = 0;
      eqFilters.push(filter);
    });

    // Bass boost (lowshelf)
    bassBoostFilter = audioCtx.createBiquadFilter();
    bassBoostFilter.type = 'lowshelf';
    bassBoostFilter.frequency.value = 100;
    bassBoostFilter.gain.value = 0;

    // Virtualizer (delay-based stereo widening)
    virtualizerDelay = audioCtx.createDelay(0.05);
    virtualizerDelay.delayTime.value = 0;
    virtualizerGain = audioCtx.createGain();
    virtualizerGain.gain.value = 0;

    // Master gain
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 1;

    // Chain: EQ[0] → EQ[1] → ... → EQ[4] → bassBoost → masterGain → destination
    for(var i=0; i<eqFilters.length-1; i++){
      eqFilters[i].connect(eqFilters[i+1]);
    }
    eqFilters[eqFilters.length-1].connect(bassBoostFilter);
    bassBoostFilter.connect(masterGain);

    // Virtualizer: parallel path with delay
    bassBoostFilter.connect(virtualizerDelay);
    virtualizerDelay.connect(virtualizerGain);
    virtualizerGain.connect(masterGain);

    masterGain.connect(audioCtx.destination);

    // Restore saved settings
    restoreEQSettings();
  }

  function connectAudioSource(){
    if(!audio || !audioCtx || sourceNode) return;
    try {
      sourceNode = audioCtx.createMediaElementSource(audio);
      sourceNode.connect(eqFilters[0]);
    } catch(e) { console.log('Audio source already connected'); }
  }

  function updateEQ(band, val){
    val = parseFloat(val);
    eqValues[band] = val;
    if(eqFilters[band]) eqFilters[band].gain.value = val;
    var label = document.getElementById('eqDb'+band);
    if(label) label.textContent = (val>0?'+':'')+val;
    saveEQSettings();
  }

  function updateWoofer(val){
    wooferValue = parseFloat(val);
    if(bassBoostFilter) bassBoostFilter.gain.value = wooferValue;
    document.getElementById('wooferValue').textContent = val;
    saveEQSettings();
  }

  function updateVirtualizer(val){
    virtualizerValue = parseFloat(val);
    if(virtualizerDelay) virtualizerDelay.delayTime.value = (virtualizerValue / 100) * 0.025;
    if(virtualizerGain) virtualizerGain.gain.value = virtualizerValue / 100 * 0.6;
    document.getElementById('virtualizerValue').textContent = val;
    saveEQSettings();
  }

  function resetEQ(){
    eqValues = [0,0,0,0,0];
    wooferValue = 0; virtualizerValue = 0;
    eqFilters.forEach(function(f,i){ f.gain.value = 0; });
    if(bassBoostFilter) bassBoostFilter.gain.value = 0;
    if(virtualizerDelay) virtualizerDelay.delayTime.value = 0;
    if(virtualizerGain) virtualizerGain.gain.value = 0;
    // Reset UI
    document.querySelectorAll('.eq-slider-wrap input').forEach(function(s){ s.value = 0; });
    for(var i=0;i<5;i++){ var l=document.getElementById('eqDb'+i); if(l) l.textContent='0'; }
    document.getElementById('wooferSlider').value = 0;
    document.getElementById('wooferValue').textContent = '0';
    document.getElementById('virtualizerSlider').value = 0;
    document.getElementById('virtualizerValue').textContent = '0';
    saveEQSettings();
  }

  function toggleEqPanel(){
    var panel = document.getElementById('eqPanel');
    var btn = document.getElementById('eqToggleBtn');
    var visible = panel.style.display !== 'none';
    panel.style.display = visible ? 'none' : 'block';
    btn.classList.toggle('active', !visible);
  }

  function saveEQSettings(){
    try {
      localStorage.setItem('radio-eq', JSON.stringify({
        eq: eqValues, woofer: wooferValue, virtualizer: virtualizerValue
      }));
    } catch(e){}
  }

  function restoreEQSettings(){
    try {
      var saved = JSON.parse(localStorage.getItem('radio-eq'));
      if(!saved) return;
      if(saved.eq){
        saved.eq.forEach(function(v,i){
          eqValues[i] = v;
          if(eqFilters[i]) eqFilters[i].gain.value = v;
          var slider = document.querySelector('.eq-slider-wrap input[data-eq="'+i+'"]');
          if(slider) slider.value = v;
          var label = document.getElementById('eqDb'+i);
          if(label) label.textContent = (v>0?'+':'')+v;
        });
      }
      if(saved.woofer !== undefined){
        wooferValue = saved.woofer;
        if(bassBoostFilter) bassBoostFilter.gain.value = wooferValue;
        document.getElementById('wooferSlider').value = wooferValue;
        document.getElementById('wooferValue').textContent = wooferValue;
      }
      if(saved.virtualizer !== undefined){
        virtualizerValue = saved.virtualizer;
        updateVirtualizer(virtualizerValue);
        document.getElementById('virtualizerSlider').value = virtualizerValue;
      }
    } catch(e){}
  }

  // === Photo ===
  var DEFAULT_PHOTOS = ['maltese.jpg','photo1.jpg','photo2.jpg','photo5.jpg','photo3.jpg','photo4.jpg'];




  function showRadioScreen(photos){
    document.getElementById('radioBody').style.display='';
    document.getElementById('themeName').style.display='';
    renderUserPhotos(photos);
    document.getElementById('photoUploadBtn').classList.add('has-photos');
  }

  function reopenPhotoSelect(){
    // 독립 파일에서는 index.html로 이동
    location.href='index.html';
  }

  function renderUserPhotos(photos){
    var bp=document.getElementById('brandPhotos');
    bp.innerHTML='';
    for(var i=0;i<4&&i<photos.length;i++){
      var img=document.createElement('img');
      img.className='brand-mascot';
      img.style.display='block';
      img.src=photos[i]; img.alt='사진'+(i+1);
      img.width=34; img.height=34;
      img.style.cursor='pointer';
      img.onclick=(function(s){return function(){openLightbox(s)}})(photos[i]);
      bp.appendChild(img);
    }
    var cl=document.getElementById('ctrlPhotoLeft');
    cl.innerHTML='';
    if(photos.length>4){
      var il=document.createElement('img');
      il.className='ctrl-mascot';
      il.style.display='block';
      il.src=photos[4]; il.alt='사진5';
      il.style.cursor='pointer';
      il.onclick=(function(s){return function(){openLightbox(s)}})(photos[4]);
      cl.appendChild(il);
    }
    var cr=document.getElementById('ctrlPhotoRight');
    cr.innerHTML='';
    if(photos.length>5){
      var ir=document.createElement('img');
      ir.className='ctrl-mascot';
      ir.style.display='block';
      ir.src=photos[5]; ir.alt='사진6';
      ir.style.cursor='pointer';
      ir.onclick=(function(s){return function(){openLightbox(s)}})(photos[5]);
      cr.appendChild(ir);
    }
  }

  function loadSavedPhotos(){
    var photos = DEFAULT_PHOTOS;
    try{
      var saved=localStorage.getItem('radioUserPhotos');
      if(saved){
        var parsed = JSON.parse(saved);
        if(parsed && parsed.length > 0) photos = parsed;
      }
    }catch(e){}
    renderUserPhotos(photos);
    document.getElementById('photoUploadBtn').classList.add('has-photos');
  }

  // === Photo Lightbox ===
  function openLightbox(src){
    var lb=document.getElementById('photoLightbox');
    document.getElementById('lightboxImg').src=src;
    lb.classList.add('visible');
  }
  function closeLightbox(){
    document.getElementById('photoLightbox').classList.remove('visible');
  }

  // === Volume Knob ===
  function setupKnobDrag(){
    var knob=document.getElementById('volumeKnob');
    var container=document.getElementById('knobContainer');
    var isDragging=false;
    function getAngle(e){
      var r=container.getBoundingClientRect();
      var cx=r.left+r.width/2, cy=r.top+r.height/2;
      var x=e.touches?e.touches[0].clientX:e.clientX;
      var y=e.touches?e.touches[0].clientY:e.clientY;
      return Math.atan2(y-cy,x-cx)*(180/Math.PI)+90;
    }
    function handleMove(e){
      if(!isDragging)return; e.preventDefault();
      var a=getAngle(e); if(a>180)a-=360;
      knobAngle=Math.max(-135,Math.min(135,a));
      volume=(knobAngle+135)/270;
      if(audio)audio.volume=volume;
      updateKnobVisual();
    }
    knob.addEventListener('mousedown',function(e){isDragging=true;e.preventDefault();});
    knob.addEventListener('touchstart',function(){isDragging=true;},{passive:true});
    document.addEventListener('mousemove',handleMove);
    document.addEventListener('touchmove',handleMove,{passive:false});
    document.addEventListener('mouseup',function(){isDragging=false;});
    document.addEventListener('touchend',function(){isDragging=false;});
    container.addEventListener('wheel',function(e){
      e.preventDefault();
      volume=Math.max(0,Math.min(1,volume+(e.deltaY>0?-0.05:0.05)));
      knobAngle=-135+(volume*270);
      if(audio)audio.volume=volume;
      updateKnobVisual();
    },{passive:false});
  }

  function updateKnobVisual(){
    document.getElementById('volumeKnob').style.transform='rotate('+knobAngle+'deg)';
  }


  document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
